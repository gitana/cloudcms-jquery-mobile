/*
Copyright 2010 Gitana Software, Inc.

Licensed under the Apache License, Version 2.0 (the "License"); 
you may not use this file except in compliance with the License. 

You may obtain a copy of the License at 
	http://www.apache.org/licenses/LICENSE-2.0 

Unless required by applicable law or agreed to in writing, software 
distributed under the License is distributed on an "AS IS" BASIS, 
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. 
See the License for the specific language governing permissions and 
limitations under the License. 

For more information, please contact Gitana Software, Inc. at this
address:

  info@gitanasoftware.com
*/


var Base=function(){};Base.extend=function(B,E){var F=Base.prototype.extend;Base._prototyping=true;var D=new this;F.call(D,B);D.base=function(){};delete Base._prototyping;var C=D.constructor;var A=D.constructor=function(){if(!Base._prototyping){if(this._constructing||this.constructor==A){this._constructing=true;C.apply(this,arguments);delete this._constructing}else{if(arguments[0]!=null){return(arguments[0].extend||F).call(arguments[0],D)}}}};A.ancestor=this;A.extend=this.extend;A.forEach=this.forEach;A.implement=this.implement;A.prototype=D;A.toString=this.toString;A.valueOf=function(G){return(G=="object")?A:C.valueOf()};F.call(A,E);if(typeof A.init=="function"){A.init()}return A};Base.prototype={extend:function(B,H){if(arguments.length>1){var E=this[B];if(E&&(typeof H=="function")&&(!E.valueOf||E.valueOf()!=H.valueOf())&&/\bbase\b/.test(H)){var A=H.valueOf();H=function(){var K=this.base||Base.prototype.base;this.base=E;var J=A.apply(this,arguments);this.base=K;return J};H.valueOf=function(J){return(J=="object")?H:A};H.toString=Base.toString}this[B]=H}else{if(B){var G=Base.prototype.extend;if(!Base._prototyping&&typeof this!="function"){G=this.extend||G}var D={toSource:null};var F=["constructor","toString","valueOf"];var C=Base._prototyping?0:1;while(I=F[C++]){if(B[I]!=D[I]){G.call(this,I,B[I])}}for(var I in B){if(!D[I]){G.call(this,I,B[I])}}}}return this}};Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(A,D,C){for(var B in A){if(this.prototype[B]===undefined){D.call(C,A[B],B,A)}}},implement:function(){for(var A=0;A<arguments.length;A++){if(typeof arguments[A]=="function"){arguments[A](this.prototype)}else{this.prototype.extend(arguments[A])}}return this},toString:function(){return String(this.valueOf())}});(function(A){Validator={validate:function(B,C){return Validator._validate(B,C,{changing:false})},checkPropertyChange:function(D,B,C){return Validator._validate(D,B,{changing:C||"property"})},_validate:function(C,G,D){if(!D){D={}}var B=D.changing;var H=[];function F(O,K,S,M){var J;S+=S?typeof M=="number"?"["+M+"]":typeof M=="undefined"?"":"."+M:M;function T(U){H.push({property:S,message:U})}if((typeof K!="object"||K instanceof Array)&&(S||typeof K!="function")&&!(K&&K.type)){if(typeof K=="function"){if(!(O instanceof K)){T("is not an instance of the class/constructor "+K.name)}}else{if(K){T("Invalid schema/property definition "+K)}}return null}if(B&&K.readonly){T("is a readonly field, it can not be changed")}if(K["extends"]){F(O,K["extends"],S,M)}function I(Y,Z){if(Y){if(typeof Y=="string"&&Y!="any"&&(Y=="null"?Z!==null:typeof Z!=Y)&&!(Z instanceof Array&&Y=="array")&&!(Z instanceof Date&&Y=="date")&&!(Y=="integer"&&Z%1===0)){return[{property:S,message:(typeof Z)+" value found, but a "+Y+" is required"}]}if(Y instanceof Array){var X=[];for(var W=0;W<Y.length;W++){if(!(X=I(Y[W],Z)).length){break}}if(X.length){return X}}else{if(typeof Y=="object"){var U=H;H=[];F(Z,Y,S);var V=H;H=U;return V}}}return[]}if(O===undefined){if(K.required){T("is missing and it is required")}}else{H=H.concat(I(K.type,O));if(K.disallow&&!I(K.disallow,O).length){T(" disallowed value was matched")}if(O!==null){if(O instanceof Array){if(K.items){var P=K.items instanceof Array;var R=K.items;for(M=0,J=O.length;M<J;M+=1){if(P){R=K.items[M]}if(D.coerce){O[M]=D.coerce(O[M],R)}H.concat(F(O[M],R,S,M))}}if(K.minItems&&O.length<K.minItems){T("There must be a minimum of "+K.minItems+" in the array")}if(K.maxItems&&O.length>K.maxItems){T("There must be a maximum of "+K.maxItems+" in the array")}}else{if(K.properties||K.additionalProperties){H.concat(E(O,K.properties,S,K.additionalProperties))}}if(K.pattern&&typeof O=="string"&&!O.match(K.pattern)){T("does not match the regex pattern "+K.pattern)}if(K.maxLength&&typeof O=="string"&&O.length>K.maxLength){T("may only be "+K.maxLength+" characters long")}if(K.minLength&&typeof O=="string"&&O.length<K.minLength){T("must be at least "+K.minLength+" characters long")}if(typeof K.minimum!==undefined&&typeof O==typeof K.minimum&&K.minimum>O){T("must have a minimum value of "+K.minimum)}if(typeof K.maximum!==undefined&&typeof O==typeof K.maximum&&K.maximum<O){T("must have a maximum value of "+K.maximum)}if(K["enum"]){var N=K["enum"];J=N.length;var Q;for(var L=0;L<J;L++){if(N[L]===O){Q=1;break}}if(!Q){T("does not have a value in the enumeration "+N.join(", "))}}if(typeof K.maxDecimal=="number"&&(O.toString().match(new RegExp("\\.[0-9]{"+(K.maxDecimal+1)+",}")))){T("may only have "+K.maxDecimal+" digits of decimal places")}}}return null}function E(I,J,O,N){if(typeof J=="object"){if(typeof I!="object"||I instanceof Array){H.push({property:O,message:"an object is required"})}for(var K in J){if(J.hasOwnProperty(K)){var M=I[K];if(M===undefined&&D.existingOnly){continue}var P=J[K];if(M===undefined&&P["default"]){M=I[K]=P["default"]}if(D.coerce&&K in I){M=I[K]=D.coerce(M,P)}F(M,P,O,K)}}}for(K in I){if(I.hasOwnProperty(K)&&!(K.charAt(0)=="_"&&K.charAt(1)=="_")&&J&&!J[K]&&N===false){if(D.filter){delete I[K];continue}else{H.push({property:O,message:(typeof M)+"The property "+K+" is not defined in the schema and the schema does not allow additional properties"})}}var L=J&&J[K]&&J[K].requires;if(L&&!(L in I)){H.push({property:O,message:"the presence of the property "+K+" requires that "+L+" also be present"})}M=I[K];if(N&&(!(J&&typeof J=="object")||!(K in J))){if(D.coerce){M=I[K]=D.coerce(M,N)}F(M,N,O,K)}if(!B&&M&&M.$schema){H=H.concat(F(M,M.$schema,O,K))}}return H}if(G){F(C,G,"",B||"")}if(!B&&C&&C.$schema){F(C,C.$schema,"","")}return{valid:!H.length,errors:H}},mustBeValid:function(B){if(!B.valid){throw new TypeError(B.errors.map(function(C){return"for property "+C.property+": "+C.message}).join(", \n"))}}};String.type="string";Boolean.type="boolean";Number.type="number";Integer={type:"integer"};Object.type="object";Array.type="array";Date.type="date";A.validator=window.Validator=Validator})(jQuery);
/*
 * jQuery Templates Plugin 1.0.0pre
 * http://github.com/jquery/jquery-tmpl
 * Requires jQuery 1.4.2
 *
 * Copyright 2011, Software Freedom Conservancy, Inc.
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 */
(function(I,F){var T=I.fn.domManip,H="_tmplitem",U=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,P={},E={},Y,X={key:0,data:{}},W=0,Q=0,G=[];function K(b,a,d,e){var c={data:e||(e===0||e===false)?e:(a?a.data:{}),_wrap:a?a._wrap:null,tmpl:null,parent:a||null,nodes:[],calls:C,nest:B,wrap:N,html:R,update:Z};if(b){I.extend(c,b,{nodes:[],parent:a})}if(d){c.tmpl=d;c._ctnt=c._ctnt||c.tmpl(I,c);c.key=++W;(G.length?E:P)[W]=c}return c}I.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){I.fn[a]=function(c){var f=[],j=I(c),e,g,d,k,h=this.length===1&&this[0].parentNode;Y=P||{};if(h&&h.nodeType===11&&h.childNodes.length===1&&j.length===1){j[b](this[0]);f=this}else{for(g=0,d=j.length;g<d;g++){Q=g;e=(g>0?this.clone(true):this).get();I(j[g])[b](e);f=f.concat(e)}Q=0;f=this.pushStack(f,a,j.selector)}k=Y;Y=null;I.tmpl.complete(k);return f}});I.fn.extend({tmpl:function(c,b,a){return I.tmpl(this[0],c,b,a)},tmplItem:function(){return I.tmplItem(this[0])},template:function(a){return I.template(a,this[0])},domManip:function(e,h,g,j){if(e[0]&&I.isArray(e[0])){var b=I.makeArray(arguments),a=e[0],f=a.length,c=0,d;while(c<f&&!(d=I.data(a[c++],"tmplItem"))){}if(d&&Q){b[2]=function(i){I.tmpl.afterManip(this,i,g)}}T.apply(this,b)}else{T.apply(this,arguments)}Q=0;if(!Y){I.tmpl.complete(P)}return this}});I.extend({tmpl:function(c,f,e,b){var d,a=!b;if(a){b=X;c=I.template[c]||I.template(null,c);E={}}else{if(!c){c=b.tmpl;P[b.key]=b;b.nodes=[];if(b.wrapped){S(b,b.wrapped)}return I(M(b,null,b.tmpl(I,b)))}}if(!c){return[]}if(typeof f==="function"){f=f.call(b||{})}if(e&&e.wrapped){S(e,e.wrapped)}d=I.isArray(f)?I.map(f,function(g){return g?K(e,b,c,g):null}):[K(e,b,c,f)];return a?I(M(b,null,d)):d},tmplItem:function(b){var a;if(b instanceof I){b=b[0]}while(b&&b.nodeType===1&&!(a=I.data(b,"tmplItem"))&&(b=b.parentNode)){}return a||X},template:function(b,a){if(a){if(typeof a==="string"){a=L(a)}else{if(a instanceof I){a=a[0]||{}}}if(a.nodeType){a=I.data(a,"tmpl")||I.data(a,"tmpl",L(a.innerHTML))}return typeof b==="string"?(I.template[b]=a):a}return b?(typeof b!=="string"?I.template(null,b):(I.template[b]||I.template(null,U.test(b)?b:I(b)))):null},encode:function(a){return(""+a).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});I.extend(I.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(a){P={}},afterManip:function V(c,a,d){var b=a.nodeType===11?I.makeArray(a.childNodes):a.nodeType===1?[a]:[];d.call(c,a);O(b);Q++}});function M(a,e,c){var d,b=c?I.map(c,function(f){return(typeof f==="string")?(a.key?f.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+H+'="'+a.key+'" $2'):f):M(f,a,f._ctnt)}):a;if(e){return b}b=b.join("");b.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(g,h,f,i){d=I(f).get();O(d);if(h){d=A(h).concat(d)}if(i){d=d.concat(A(i))}});return d?d:A(b)}function A(b){var a=document.createElement("div");a.innerHTML=b;return I.makeArray(a.childNodes)}function L(a){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+I.trim(a).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(i,c,g,d,e,j,f){var l=I.tmpl.tag[g],b,h,k;if(!l){throw"Unknown template tag: "+g}b=l._default||[];if(j&&!/\w$/.test(e)){e+=j;j=""}if(e){e=J(e);f=f?(","+J(f)+")"):(j?")":"");h=j?(e.indexOf(".")>-1?e+J(j):("("+e+").call($item"+f)):e;k=j?h:"(typeof("+e+")==='function'?("+e+").call($item):("+e+"))"}else{k=h=b.$1||"null"}d=J(d);return"');"+l[c?"close":"open"].split("$notnull_1").join(e?"typeof("+e+")!=='undefined' && ("+e+")!=null":"true").split("$1a").join(k).split("$1").join(h).split("$2").join(d||b.$2||"")+"__.push('"})+"');}return __;")}function S(b,a){b._wrap=M(b,true,I.isArray(a)?a:[U.test(a)?a:I(a).html()]).join("")}function J(a){return a?a.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function D(a){var b=document.createElement("div");b.appendChild(a.cloneNode(true));return b.innerHTML}function O(g){var j="_"+Q,b,a,e={},f,d,c;for(f=0,d=g.length;f<d;f++){if((b=g[f]).nodeType!==1){continue}a=b.getElementsByTagName("*");for(c=a.length-1;c>=0;c--){h(a[c])}h(b)}function h(o){var l,n=o,m,i,k;if((k=o.getAttribute(H))){while(n.parentNode&&(n=n.parentNode).nodeType===1&&!(l=n.getAttribute(H))){}if(l!==k){n=n.parentNode?(n.nodeType===11?0:(n.getAttribute(H)||0)):0;if(!(i=P[k])){i=E[k];i=K(i,P[n]||E[n]);i.key=++W;P[W]=i}if(Q){p(k)}}o.removeAttribute(H)}else{if(Q&&(i=I.data(o,"tmplItem"))){p(i.key);P[i.key]=i;n=I.data(o.parentNode,"tmplItem");n=n?n.key:0}}if(i){m=i;while(m&&m.key!=n){m.nodes.push(o);m=m.parent}delete i._ctnt;delete i._wrap;I.data(o,"tmplItem",i)}function p(q){q=q+j;i=e[q]=(e[q]||K(i,P[i.parent.key+j]||i.parent))}}}function C(c,a,d,b){if(!c){return G.pop()}G.push({_:c,tmpl:a,item:this,data:d,options:b})}function B(a,c,b){return I.tmpl(I.template(a),c,b,this)}function N(c,a){var b=c.options||{};b.wrapped=a;return I.tmpl(I.template(c.tmpl),c.data,b,c.item)}function R(b,c){var a=this._wrap;return I.map(I(I.isArray(a)?a.join(""):a).filter(b||"*"),function(d){return c?d.innerText||d.textContent:d.outerHTML||D(d)})}function Z(){var a=this.nodes;I.tmpl(null,null,null,this).insertBefore(a[0]);I(a).remove()}})(jQuery);(function(A){jQuery.browser.mobile=/android|avantgo|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(A)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(A.substr(0,4))})(navigator.userAgent||navigator.vendor||window.opera);function hoozit(A){if(A.constructor===String){return"string"}else{if(A.constructor===Boolean){return"boolean"}else{if(A.constructor===Number){if(isNaN(A)){return"nan"}else{return"number"}}else{if(typeof A==="undefined"){return"undefined"}else{if(A===null){return"null"}else{if(A instanceof Array){return"array"}else{if(A instanceof Date){return"date"}else{if(A instanceof RegExp){return"regexp"}else{if(typeof A==="object"){return"object"}else{if(A instanceof Function){return"function"}else{return undefined}}}}}}}}}}}function bindCallbacks(C,B,A){var D=hoozit(C);if(D){if(hoozit(B[D])==="function"){return B[D].apply(B,A)}else{return B[D]}}}var equiv=function(){var B;var C=[];var A=function(){function D(E,F){if(E instanceof F.constructor||F instanceof E.constructor){return F==E}else{return F===E}}return{string:D,"boolean":D,number:D,"null":D,"undefined":D,nan:function(E){return isNaN(E)},date:function(E,F){return hoozit(E)==="date"&&F.valueOf()===E.valueOf()},regexp:function(E,F){return hoozit(E)==="regexp"&&F.source===E.source&&F.global===E.global&&F.ignoreCase===E.ignoreCase&&F.multiline===E.multiline},"function":function(){var E=C[C.length-1];return E!==Object&&typeof E!=="undefined"},array:function(F,G){var H;var E;if(!(hoozit(F)==="array")){return false}E=G.length;if(E!==F.length){return false}for(H=0;H<E;H++){if(!B(G[H],F[H])){return false}}return true},object:function(F,G){var I;var E=true;var H=[],J=[];if(G.constructor!==F.constructor){return false}C.push(G.constructor);for(I in G){H.push(I);if(!B(G[I],F[I])){E=false}}C.pop();for(I in F){J.push(I)}return E&&B(H.sort(),J.sort())}}}();B=function(){var D=Array.prototype.slice.apply(arguments);if(D.length<2){return true}return(function(F,E){if(F===E){return true}else{if(F===null||E===null||typeof F==="undefined"||typeof E==="undefined"||hoozit(F)!==hoozit(E)){return false}else{return bindCallbacks(F,A,[E,F])}}})(D[0],D[1])&&arguments.callee.apply(this,D.splice(1,D.length-1))};return B}();(function(E){var A=0;var B={iframe:"iframe",popup:"popup"};var D={mode:B.iframe,popHt:500,popWd:400,popX:200,popY:200,popTitle:"",popClose:false};var C={};E.fn.printArea=function(N){E.extend(C,D,N);A++;var O="printArea_";E("[id^="+O+"]").remove();var Q=I(E(this));C.id=O+A;var L;var M;switch(C.mode){case B.iframe:var P=new G();L=P.doc;M=P.contentWindow||P;break;case B.popup:M=new K();L=M.doc}L.open();L.write(H()+"<html>"+J()+F(Q)+"</html>");L.close();M.focus();M.print();if(C.mode==B.popup&&C.popClose){M.close()}};function H(){if(C.mode==B.iframe||!C.strict){return""}var L=C.strict==false?" Trasitional":"";var M=C.strict==false?"loose":"strict";return'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01'+L+'//EN" "http://www.w3.org/TR/html4/'+M+'.dtd">'}function J(){var L="<head><title>"+C.popTitle+"</title>";E(document).find("link").filter(function(){return E(this).attr("rel").toLowerCase()=="stylesheet"}).filter(function(){var M=E(this).attr("media");return(M.toLowerCase()==""||M.toLowerCase()=="print")}).each(function(){L+='<link type="text/css" rel="stylesheet" href="'+E(this).attr("href")+'" >'});L+="</head>";return L}function F(L){return'<body><div class="'+E(L).attr("class")+'">'+E(L).html()+"</div></body>"}function I(L){E("input,select,textarea",L).each(function(){var N=E(this).attr("type");if(N=="radio"||N=="checkbox"){if(E(this).is(":not(:checked)")){this.removeAttribute("checked")}else{this.setAttribute("checked",true)}}else{if(N=="text"){this.setAttribute("value",E(this).val())}else{if(N=="select-multiple"||N=="select-one"){E(this).find("option").each(function(){if(E(this).is(":not(:selected)")){this.removeAttribute("selected")}else{this.setAttribute("selected",true)}})}else{if(N=="textarea"){var M=E(this).attr("value");if(E.browser.mozilla){if(this.firstChild){this.firstChild.textContent=M}else{this.textContent=M}}else{this.innerHTML=M}}}}}});return L}function G(){var N=C.id;var L="border:0;position:absolute;width:0px;height:0px;left:0px;top:0px;";var M;try{M=document.createElement("iframe");document.body.appendChild(M);E(M).attr({style:L,id:N,src:""});M.doc=null;M.doc=M.contentDocument?M.contentDocument:(M.contentWindow?M.contentWindow.document:M.document)}catch(O){throw O+". iframes may not be supported in this browser."}if(M.doc==null){throw"Cannot find document."}return M}function K(){var M="location=yes,statusbar=no,directories=no,menubar=no,titlebar=no,toolbar=no,dependent=no";M+=",width="+C.popWd+",height="+C.popHt;M+=",resizable=yes,screenX="+C.popX+",screenY="+C.popY+",personalbar=no,scrollbars=no";var L=window.open("","_blank",M);L.doc=L.document;return L}})(jQuery);(function(B){var C=(B.browser.msie?"paste":"input")+".mask";var A=(window.orientation!=undefined);B.mask={definitions:{"9":"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"}};B.fn.extend({caret:function(E,D){if(this.length==0){return }if(typeof E=="number"){D=(typeof D=="number")?D:E;return this.each(function(){if(this.setSelectionRange){this.focus();this.setSelectionRange(E,D)}else{if(this.createTextRange){var G=this.createTextRange();G.collapse(true);G.moveEnd("character",D);G.moveStart("character",E);G.select()}}})}else{if(this[0].setSelectionRange){E=this[0].selectionStart;D=this[0].selectionEnd}else{if(document.selection&&document.selection.createRange){var F=document.selection.createRange();E=0-F.duplicate().moveStart("character",-100000);D=E+F.text.length}}return{begin:E,end:D}}},unmask:function(){return this.trigger("unmask")},mask:function(E,K){if(!E&&this.length>0){var I=B(this[0]);var H=I.data("tests");return B.map(I.data("buffer"),function(M,L){return H[L]?M:null}).join("")}K=B.extend({placeholder:"_",completed:null},K);var D=B.mask.definitions;var H=[];var J=E.length;var F=null;var G=E.length;B.each(E.split(""),function(L,M){if(M=="?"){G--;J=L}else{if(D[M]){H.push(new RegExp(D[M]));if(F==null){F=H.length-1}}else{H.push(null)}}});return this.each(function(){var L=B(this);var Q=B.map(E.split(""),function(X,Y){if(X!="?"){return D[X]?K.placeholder:X}});var P=false;var M=L.val();L.data("buffer",Q).data("tests",H);function T(X){while(++X<=G&&!H[X]){}return X}function V(X){while(!H[X]&&--X>=0){}for(var Z=X;Z<G;Z++){if(H[Z]){Q[Z]=K.placeholder;var Y=T(Z);if(Y<G&&H[Z].test(Q[Y])){Q[Z]=Q[Y]}else{break}}}W();L.caret(Math.max(F,X))}function U(b){for(var Y=b,Z=K.placeholder;Y<G;Y++){if(H[Y]){var a=T(Y);var X=Q[Y];Q[Y]=Z;if(a<G&&H[a].test(X)){Z=X}else{break}}}}function R(Z){var X=B(this).caret();var Y=Z.keyCode;P=(Y<16||(Y>16&&Y<32)||(Y>32&&Y<41));if((X.begin-X.end)!=0&&(!P||Y==8||Y==46)){S(X.begin,X.end)}if(Y==8||Y==46||(A&&Y==127)){V(X.begin+(Y==46?0:-1));return false}else{if(Y==27){L.val(M);L.caret(0,N());return false}}}function O(c){if(P){P=false;return(c.keyCode==8)?false:null}c=c||window.event;var a=c.charCode||c.keyCode||c.which;var Z=B(this).caret();if(c.ctrlKey||c.altKey||c.metaKey){return true}else{if((a>=32&&a<=125)||a>186){var Y=T(Z.begin-1);if(Y<G){var X=String.fromCharCode(a);if(H[Y].test(X)){U(Y);Q[Y]=X;W();var b=T(Y);B(this).caret(b);if(K.completed&&b==G){K.completed.call(L)}}}}}return false}function S(X,Z){for(var Y=X;Y<Z&&Y<G;Y++){if(H[Y]){Q[Y]=K.placeholder}}}function W(){return L.val(Q.join("")).val()}function N(c){var a=L.val();var Z=-1;for(var b=0,Y=0;b<G;b++){if(H[b]){Q[b]=K.placeholder;while(Y++<a.length){var X=a.charAt(Y-1);if(H[b].test(X)){Q[b]=X;Z=b;break}}if(Y>a.length){break}}else{if(Q[b]==a[Y]&&b!=J){Y++;Z=b}}}if(!c&&Z+1<J){L.val("");S(0,G)}else{if(c||Z+1>=J){W();if(!c){L.val(L.val().substring(0,Z+1))}}}return(J?b:F)}if(!L.attr("readonly")){L.one("unmask",function(){L.unbind(".mask").removeData("buffer").removeData("tests")}).bind("focus.mask",function(){M=L.val();var X=N();W();setTimeout(function(){if(X==E.length){L.caret(0,X)}else{L.caret(X)}},0)}).bind("blur.mask",function(){N();if(L.val()!=M){L.change()}}).bind("keydown.mask",R).bind("keypress.mask",O).bind(C,function(){setTimeout(function(){L.caret(N(true))},0)})}N()})}})})(jQuery);(function(C){var A=window.console?window.console:{log:C.noop,error:function(E){C.error(E)}};var B=(("prop" in C.fn)&&("removeProp" in C.fn));function D(){this.controls={bold:{groupIndex:0,visible:true,tags:["b","strong"],css:{fontWeight:"bold"},tooltip:"Bold",hotkey:{ctrl:1,key:66}},copy:{groupIndex:8,visible:false,tooltip:"Copy"},createLink:{groupIndex:6,visible:true,exec:function(){var E=this;if(C.wysiwyg.controls&&C.wysiwyg.controls.link){C.wysiwyg.controls.link.init(this)}else{if(C.wysiwyg.autoload){C.wysiwyg.autoload.control("wysiwyg.link.js",function(){E.controls.createLink.exec.apply(E)})}else{A.error("$.wysiwyg.controls.link not defined. You need to include wysiwyg.link.js file")}}},tags:["a"],tooltip:"Create link"},unLink:{groupIndex:6,visible:true,exec:function(){this.editorDoc.execCommand("unlink",false,null)},tooltip:"Remove link"},cut:{groupIndex:8,visible:false,tooltip:"Cut"},decreaseFontSize:{groupIndex:9,visible:false,tags:["small"],tooltip:"Decrease font size",exec:function(){this.decreaseFontSize()}},h1:{groupIndex:7,visible:true,className:"h1",command:(C.browser.msie||C.browser.safari)?"FormatBlock":"heading","arguments":(C.browser.msie||C.browser.safari)?"<h1>":"h1",tags:["h1"],tooltip:"Header 1"},h2:{groupIndex:7,visible:true,className:"h2",command:(C.browser.msie||C.browser.safari)?"FormatBlock":"heading","arguments":(C.browser.msie||C.browser.safari)?"<h2>":"h2",tags:["h2"],tooltip:"Header 2"},h3:{groupIndex:7,visible:true,className:"h3",command:(C.browser.msie||C.browser.safari)?"FormatBlock":"heading","arguments":(C.browser.msie||C.browser.safari)?"<h3>":"h3",tags:["h3"],tooltip:"Header 3"},highlight:{tooltip:"Highlight",className:"highlight",groupIndex:1,visible:false,css:{backgroundColor:"rgb(255, 255, 102)"},exec:function(){var H,G,F,E;if(C.browser.msie||C.browser.safari){H="backcolor"}else{H="hilitecolor"}if(C.browser.msie){G=this.getInternalRange().parentElement()}else{F=this.getInternalSelection();G=F.extentNode||F.focusNode;while(G.style===undefined){G=G.parentNode;if(G.tagName&&G.tagName.toLowerCase()==="body"){return }}}if(G.style.backgroundColor==="rgb(255, 255, 102)"||G.style.backgroundColor==="#ffff66"){E="#ffffff"}else{E="#ffff66"}this.editorDoc.execCommand(H,false,E)}},html:{groupIndex:10,visible:false,exec:function(){var E;if(this.options.resizeOptions&&C.fn.resizable){E=this.element.height()}if(this.viewHTML){this.setContent(this.original.value);C(this.original).hide();this.editor.show();if(this.options.resizeOptions&&C.fn.resizable){if(E===this.element.height()){this.element.height(E+this.editor.height())}this.element.resizable(C.extend(true,{alsoResize:this.editor},this.options.resizeOptions))}this.ui.toolbar.find("li").each(function(){var F=C(this);if(F.hasClass("html")){F.removeClass("active")}else{F.removeClass("disabled")}})}else{this.saveContent();C(this.original).css({width:this.element.outerWidth()-6,height:this.element.height()-this.ui.toolbar.height()-6,resize:"none"}).show();this.editor.hide();if(this.options.resizeOptions&&C.fn.resizable){if(E===this.element.height()){this.element.height(this.ui.toolbar.height())}this.element.resizable("destroy")}this.ui.toolbar.find("li").each(function(){var F=C(this);if(F.hasClass("html")){F.addClass("active")}else{if(false===F.hasClass("fullscreen")){F.removeClass("active").addClass("disabled")}}})}this.viewHTML=!(this.viewHTML)},tooltip:"View source code"},increaseFontSize:{groupIndex:9,visible:false,tags:["big"],tooltip:"Increase font size",exec:function(){this.increaseFontSize()}},indent:{groupIndex:2,visible:true,tooltip:"Indent"},insertHorizontalRule:{groupIndex:6,visible:true,tags:["hr"],tooltip:"Insert Horizontal Rule"},insertImage:{groupIndex:6,visible:true,exec:function(){var E=this;if(C.wysiwyg.controls&&C.wysiwyg.controls.image){C.wysiwyg.controls.image.init(this)}else{if(C.wysiwyg.autoload){C.wysiwyg.autoload.control("wysiwyg.image.js",function(){E.controls.insertImage.exec.apply(E)})}else{A.error("$.wysiwyg.controls.image not defined. You need to include wysiwyg.image.js file")}}},tags:["img"],tooltip:"Insert image"},insertOrderedList:{groupIndex:5,visible:true,tags:["ol"],tooltip:"Insert Ordered List"},insertTable:{groupIndex:6,visible:true,exec:function(){var E=this;if(C.wysiwyg.controls&&C.wysiwyg.controls.table){C.wysiwyg.controls.table(this)}else{if(C.wysiwyg.autoload){C.wysiwyg.autoload.control("wysiwyg.table.js",function(){E.controls.insertTable.exec.apply(E)})}else{A.error("$.wysiwyg.controls.table not defined. You need to include wysiwyg.table.js file")}}},tags:["table"],tooltip:"Insert table"},insertUnorderedList:{groupIndex:5,visible:true,tags:["ul"],tooltip:"Insert Unordered List"},italic:{groupIndex:0,visible:true,tags:["i","em"],css:{fontStyle:"italic"},tooltip:"Italic",hotkey:{ctrl:1,key:73}},justifyCenter:{groupIndex:1,visible:true,tags:["center"],css:{textAlign:"center"},tooltip:"Justify Center"},justifyFull:{groupIndex:1,visible:true,css:{textAlign:"justify"},tooltip:"Justify Full"},justifyLeft:{visible:true,groupIndex:1,css:{textAlign:"left"},tooltip:"Justify Left"},justifyRight:{groupIndex:1,visible:true,css:{textAlign:"right"},tooltip:"Justify Right"},ltr:{groupIndex:10,visible:false,exec:function(){var E=this.dom.getElement("p");if(!E){return false}C(E).attr("dir","ltr");return true},tooltip:"Left to Right"},outdent:{groupIndex:2,visible:true,tooltip:"Outdent"},paragraph:{groupIndex:7,visible:false,className:"paragraph",command:"FormatBlock","arguments":(C.browser.msie||C.browser.safari)?"<p>":"p",tags:["p"],tooltip:"Paragraph"},paste:{groupIndex:8,visible:false,tooltip:"Paste"},redo:{groupIndex:4,visible:true,tooltip:"Redo"},removeFormat:{groupIndex:10,visible:true,exec:function(){this.removeFormat()},tooltip:"Remove formatting"},rtl:{groupIndex:10,visible:false,exec:function(){var E=this.dom.getElement("p");if(!E){return false}C(E).attr("dir","rtl");return true},tooltip:"Right to Left"},strikeThrough:{groupIndex:0,visible:true,tags:["s","strike"],css:{textDecoration:"line-through"},tooltip:"Strike-through"},subscript:{groupIndex:3,visible:true,tags:["sub"],tooltip:"Subscript"},superscript:{groupIndex:3,visible:true,tags:["sup"],tooltip:"Superscript"},underline:{groupIndex:0,visible:true,tags:["u"],css:{textDecoration:"underline"},tooltip:"Underline",hotkey:{ctrl:1,key:85}},undo:{groupIndex:4,visible:true,tooltip:"Undo"},code:{visible:true,groupIndex:6,tooltip:"Code snippet",exec:function(){var E=this.getInternalRange(),F=C(E.commonAncestorContainer),G=E.commonAncestorContainer.nodeName.toLowerCase();if(F.parent("code").length){F.unwrap()}else{if(G!=="body"){F.wrap("<code/>")}}}},cssWrap:{visible:false,groupIndex:6,tooltip:"CSS Wrapper",exec:function(){C.wysiwyg.controls.cssWrap.init(this)}}};this.defaults={html:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" style="margin:0"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body style="margin:0;">INITIAL_CONTENT</body></html>',debug:false,controls:{},css:{},events:{},autoGrow:false,autoSave:true,brIE:true,formHeight:270,formWidth:440,iFrameClass:null,initialContent:"",maxHeight:10000,maxLength:0,messages:{nonSelection:"Select the text you wish to link"},toolbarHtml:'<ul role="menu" class="toolbar"></ul>',removeHeadings:false,replaceDivWithP:false,resizeOptions:false,rmUnusedControls:false,rmUnwantedBr:true,tableFiller:"Lorem ipsum",initialMinHeight:null,controlImage:{forceRelativeUrls:false},controlLink:{forceRelativeUrls:false},plugins:{autoload:false,i18n:false,rmFormat:{rmMsWordMarkup:false}},dialog:"default"};this.availableControlProperties=["arguments","callback","className","command","css","custom","exec","groupIndex","hotkey","icon","tags","tooltip","visible"];this.editor=null;this.editorDoc=null;this.element=null;this.options={};this.original=null;this.savedRange=null;this.timers=[];this.validKeyCodes=[8,9,13,16,17,18,19,20,27,33,34,35,36,37,38,39,40,45,46];this.isDestroyed=false;this.dom={ie:{parent:null},w3c:{parent:null}};this.dom.parent=this;this.dom.ie.parent=this.dom;this.dom.w3c.parent=this.dom;this.ui={};this.ui.self=this;this.ui.toolbar=null;this.ui.initialHeight=null;this.dom.getAncestor=function(E,F){F=F.toLowerCase();while(E&&typeof E.tagName!="undefined"&&"body"!==E.tagName.toLowerCase()){if(F===E.tagName.toLowerCase()){return E}E=E.parentNode}if(!E.tagName&&(E.previousSibling||E.nextSibling)){if(E.previousSibling){if(E.previousSibling.tagName.toLowerCase()==F){return E.previousSibling}}if(E.nextSibling){if(E.nextSibling.tagName.toLowerCase()==F){return E.nextSibling}}}return null};this.dom.getElement=function(F){var E=this;F=F.toLowerCase();if(window.getSelection){return E.w3c.getElement(F)}else{return E.ie.getElement(F)}};this.dom.ie.getElement=function(I){var H=this.parent,G=H.parent.getInternalSelection(),E=G.createRange(),F;if("Control"===G.type){if(1===E.length){F=E.item(0)}else{return null}}else{F=E.parentElement()}return H.getAncestor(F,I)};this.dom.w3c.getElement=function(H){var G=this.parent,E=G.parent.getInternalRange(),F;if(!E){return null}F=E.commonAncestorContainer;if(3===F.nodeType){F=F.parentNode}if(F===E.startContainer){F=F.childNodes[E.startOffset]}if(!F.tagName&&(F.previousSibiling||F.nextSibling)){if(F.previousSibiling){if(F.previousSibiling.tagName.toLowerCase()==H){return F.previousSibiling}}if(F.nextSibling){if(F.nextSibling.tagName.toLowerCase()==H){return F.nextSibling}}}return G.getAncestor(F,H)};this.ui.addHoverClass=function(){C(this).addClass("wysiwyg-button-hover")};this.ui.appendControls=function(){var J=this,M=this.self,L=M.parseControls(),K=true,E=[],F={},G,H,I=function(O,N){if(N.groupIndex&&H!==N.groupIndex){H=N.groupIndex;K=false}if(!N.visible){return }if(!K){J.appendItemSeparator();K=true}if(N.custom){J.appendItemCustom(O,N)}else{J.appendItem(O,N)}};C.each(L,function(O,P){var N="empty";if(undefined!==P.groupIndex){if(""===P.groupIndex){N="empty"}else{N=P.groupIndex}}if(undefined===F[N]){E.push(N);F[N]={}}F[N][O]=P});E.sort(function(O,N){if("number"===typeof (O)&&typeof (O)===typeof (N)){return(O-N)}else{O=O.toString();N=N.toString();if(O>N){return 1}if(O===N){return 0}return -1}});if(0<E.length){H=E[0]}for(G=0;G<E.length;G+=1){C.each(F[E[G]],I)}};this.ui.appendItem=function(F,I){var E=this.self,G=I.className||I.command||F||"empty",H=I.tooltip||I.command||F||"";return C('<li role="menuitem" unselectable="on">'+(G)+"</li>").addClass(G).attr("title",H).hover(this.addHoverClass,this.removeHoverClass).click(function(K){if(C(this).hasClass("disabled")){return false}E.triggerControl.apply(E,[F,I]);var J=C(K.target);for(var L in E.controls){if(J.hasClass(L)){E.ui.toolbar.find("."+L).toggleClass("active");E.editorDoc.rememberCommand=true;break}}this.blur();E.ui.returnRange();E.ui.focus();return true}).appendTo(E.ui.toolbar)};this.ui.appendItemCustom=function(F,H){var E=this.self,G=H.tooltip||H.command||F||"";if(H.callback){C(window).bind("trigger-"+F+".wysiwyg",H.callback)}return C('<li role="menuitem" unselectable="on" style="background: url(\''+H.icon+"') no-repeat;\"></li>").addClass("custom-command-"+F).addClass("wysiwyg-custom-command").addClass(F).attr("title",G).hover(this.addHoverClass,this.removeHoverClass).click(function(){if(C(this).hasClass("disabled")){return false}E.triggerControl.apply(E,[F,H]);this.blur();E.ui.returnRange();E.ui.focus();E.triggerControlCallback(F);return true}).appendTo(E.ui.toolbar)};this.ui.appendItemSeparator=function(){var E=this.self;return C('<li role="separator" class="separator"></li>').appendTo(E.ui.toolbar)};this.autoSaveFunction=function(){this.saveContent()};this.ui.checkTargets=function(F){var E=this.self;C.each(E.options.controls,function(H,L){var K=L.className||L.command||H||"empty",G,N,I,J,M=function(P,O){var Q;if("function"===typeof (O)){Q=O;if(Q(J.css(P).toString().toLowerCase(),E)){E.ui.toolbar.find("."+K).addClass("active")}}else{if(J.css(P).toString().toLowerCase()===O){E.ui.toolbar.find("."+K).addClass("active")}}};if("fullscreen"!==K){E.ui.toolbar.find("."+K).removeClass("active")}if(L.tags||(L.options&&L.options.tags)){G=L.tags||(L.options&&L.options.tags);N=F;while(N){if(N.nodeType!==1){break}if(C.inArray(N.tagName.toLowerCase(),G)!==-1){E.ui.toolbar.find("."+K).addClass("active")}N=N.parentNode}}if(L.css||(L.options&&L.options.css)){I=L.css||(L.options&&L.options.css);J=C(F);while(J){if(J[0].nodeType!==1){break}C.each(I,M);J=J.parent()}}})};this.ui.designMode=function(){var F=3,E=this.self,G;G=function(H){if("on"===E.editorDoc.designMode){if(E.timers.designMode){window.clearTimeout(E.timers.designMode)}if(E.innerDocument()!==E.editorDoc){E.ui.initFrame()}return }try{E.editorDoc.designMode="on"}catch(I){}H-=1;if(H>0){E.timers.designMode=window.setTimeout(function(){G(H)},100)}};G(F)};this.destroy=function(){this.isDestroyed=true;var F,E=this.element.closest("form");for(F=0;F<this.timers.length;F+=1){window.clearTimeout(this.timers[F])}E.unbind(".wysiwyg");this.element.remove();C.removeData(this.original,"wysiwyg");C(this.original).show();return this};this.getRangeText=function(){var E=this.getInternalRange();if(E.toString){E=E.toString()}else{if(E.text){E=E.text}}return E};this.execute=function(F,E){if(typeof (E)==="undefined"){E=null}this.editorDoc.execCommand(F,false,E)};this.extendOptions=function(F){var E={};if("object"===typeof F.controls){E=F.controls;delete F.controls}F=C.extend(true,{},this.defaults,F);F.controls=C.extend(true,{},E,this.controls,E);if(F.rmUnusedControls){C.each(F.controls,function(G){if(!E[G]){delete F.controls[G]}})}return F};this.ui.focus=function(){var E=this.self;E.editor.get(0).contentWindow.focus();return E};this.ui.returnRange=function(){var E=this.self,F;if(E.savedRange!==null){if(window.getSelection){F=window.getSelection();if(F.rangeCount>0){F.removeAllRanges()}try{F.addRange(E.savedRange)}catch(G){A.error(G)}}else{if(window.document.createRange){window.getSelection().addRange(E.savedRange)}else{if(window.document.selection){E.savedRange.select()}}}E.savedRange=null}};this.increaseFontSize=function(){if(C.browser.mozilla||C.browser.opera){this.editorDoc.execCommand("increaseFontSize",false,null)}else{if(C.browser.safari){var H=this.getInternalRange(),G=this.getInternalSelection(),F=this.editorDoc.createElement("big");if(true===H.collapsed&&3===H.commonAncestorContainer.nodeType){var I=H.commonAncestorContainer.nodeValue.toString(),J=I.lastIndexOf(" ",H.startOffset)+1,E=(-1===I.indexOf(" ",H.startOffset))?I:I.indexOf(" ",H.startOffset);H.setStart(H.commonAncestorContainer,J);H.setEnd(H.commonAncestorContainer,E);H.surroundContents(F);G.addRange(H)}else{H.surroundContents(F);G.removeAllRanges();G.addRange(H)}}else{A.error("Internet Explorer?")}}};this.decreaseFontSize=function(){if(C.browser.mozilla||C.browser.opera){this.editorDoc.execCommand("decreaseFontSize",false,null)}else{if(C.browser.safari){var H=this.getInternalRange(),G=this.getInternalSelection(),F=this.editorDoc.createElement("small");if(true===H.collapsed&&3===H.commonAncestorContainer.nodeType){var I=H.commonAncestorContainer.nodeValue.toString(),J=I.lastIndexOf(" ",H.startOffset)+1,E=(-1===I.indexOf(" ",H.startOffset))?I:I.indexOf(" ",H.startOffset);H.setStart(H.commonAncestorContainer,J);H.setEnd(H.commonAncestorContainer,E);H.surroundContents(F);G.addRange(H)}else{H.surroundContents(F);G.removeAllRanges();G.addRange(H)}}else{A.error("Internet Explorer?")}}};this.getContent=function(){if(this.viewHTML){this.setContent(this.original.value)}return this.events.filter("getContent",this.editorDoc.body.innerHTML)};this.events={_events:{},bind:function(E,F){if(typeof (this._events.eventName)!=="object"){this._events[E]=[]}this._events[E].push(F)},trigger:function(E,F){if(typeof (this._events.eventName)==="object"){var G=this.editor;C.each(this._events[E],function(I,H){if(typeof (H)==="function"){H.apply(G,F)}})}},filter:function(E,H){if(typeof (this._events[E])==="object"){var G=this.editor,F=Array.prototype.slice.call(arguments,1);C.each(this._events[E],function(J,I){if(typeof (I)==="function"){H=I.apply(G,F)}})}return H}};this.getElementByAttributeValue=function(G,E,H){var F,J,I=this.editorDoc.getElementsByTagName(G);for(F=0;F<I.length;F+=1){J=I[F].getAttribute(E);if(C.browser.msie){J=J.substr(J.length-H.length)}if(J===H){return I[F]}}return false};this.getInternalRange=function(){var E=this.getInternalSelection();if(!E){return null}if(E.rangeCount&&E.rangeCount>0){return E.getRangeAt(0)}else{if(E.createRange){return E.createRange()}}return null};this.getInternalSelection=function(){if(this.editor.get(0).contentWindow){if(this.editor.get(0).contentWindow.getSelection){return this.editor.get(0).contentWindow.getSelection()}if(this.editor.get(0).contentWindow.selection){return this.editor.get(0).contentWindow.selection}}if(this.editorDoc.getSelection){return this.editorDoc.getSelection()}if(this.editorDoc.selection){return this.editorDoc.selection}return null};this.getRange=function(){var E=this.getSelection();if(!E){return null}if(E.rangeCount&&E.rangeCount>0){E.getRangeAt(0)}else{if(E.createRange){return E.createRange()}}return null};this.getSelection=function(){return(window.getSelection)?window.getSelection():window.document.selection};this.ui.grow=function(){var F=this.self,I=C(F.editorDoc.body),H=C.browser.msie?I[0].scrollHeight:I.height()+2+20,G=F.ui.initialHeight,E=Math.max(H,G);E=Math.min(E,F.options.maxHeight);F.editor.attr("scrolling",E<F.options.maxHeight?"no":"auto");I.css("overflow",E<F.options.maxHeight?"hidden":"");F.editor.get(0).height=E;return F};this.init=function(I,H){var G=this,F=C(I).closest("form"),K=(I.width||I.clientWidth||0),J=(I.height||I.clientHeight||0);this.options=this.extendOptions(H);this.original=I;this.ui.toolbar=C(this.options.toolbarHtml);if(C.browser.msie&&parseInt(C.browser.version,10)<8){this.options.autoGrow=false}if(K===0&&I.cols){K=(I.cols*8)+21}if(J===0&&I.rows){J=(I.rows*16)+16}this.editor=C(window.location.protocol==="https:"?'<iframe src="javascript:false;"></iframe>':"<iframe></iframe>").attr("frameborder","0");if(this.options.iFrameClass){this.editor.addClass(this.options.iFrameClass)}else{this.editor.css({minHeight:(J-6).toString()+"px",width:(K>50)?(K-8).toString()+"px":""});if(C.browser.msie&&parseInt(C.browser.version,10)<7){this.editor.css("height",J.toString()+"px")}}if(I.id){var E=I.id+"-wysiwyg-iframe";if(!document.getElementById(E)){this.editor.attr("id",E)}}this.editor.attr("tabindex",C(I).attr("tabindex"));this.element=C("<div/>").addClass("wysiwyg");if(!this.options.iFrameClass){this.element.css({width:(K>0)?K.toString()+"px":"100%"})}C(I).hide().before(this.element);this.viewHTML=false;this.initialContent=C(I).val();this.ui.initFrame();if(this.options.resizeOptions&&C.fn.resizable){this.element.resizable(C.extend(true,{alsoResize:this.editor},this.options.resizeOptions))}if(this.options.autoSave){F.bind("submit.wysiwyg",function(){G.autoSaveFunction()})}F.bind("reset.wysiwyg",function(){G.resetFunction()})};this.ui.initFrame=function(){var E=this.self,G,I,F;E.ui.appendControls();E.element.append(E.ui.toolbar).append(C("<div><!-- --></div>").css({clear:"both"})).append(E.editor);E.editorDoc=E.innerDocument();if(E.isDestroyed){return null}E.ui.designMode();E.editorDoc.open();E.editorDoc.write(E.options.html.replace(/INITIAL_CONTENT/,function(){return E.wrapInitialContent()}));E.editorDoc.close();C.wysiwyg.plugin.bind(E);C(E.editorDoc).trigger("initFrame.wysiwyg");C(E.editorDoc).bind("click.wysiwyg",function(J){E.ui.checkTargets(J.target?J.target:J.srcElement)});setInterval(function(){var L=null;try{var J=E.getInternalRange();if(J){L={range:J,parent:C.browser.msie?J.parentElement():J.endContainer.parentNode,width:(C.browser.msie?J.boundingWidth:J.startOffset-J.endOffset)||0}}}catch(K){A.error(K)}if(L&&L.width==0&&!E.editorDoc.rememberCommand){E.ui.checkTargets(L.parent)}},400);C(E.original).focus(function(){if(C(this).filter(":visible").length===0){return }E.ui.focus()});C(E.editorDoc).keydown(function(J){var K;if(J.keyCode===8){K=/^<([\w]+)[^>]*>(<br\/?>)?<\/\1>$/;if(K.test(E.getContent())){J.stopPropagation();return false}}E.editorDoc.rememberCommand=false;return true});if(!C.browser.msie){C(E.editorDoc).keydown(function(J){var K;if(J.ctrlKey||J.metaKey){for(K in E.controls){if(E.controls[K].hotkey&&E.controls[K].hotkey.ctrl){if(J.keyCode===E.controls[K].hotkey.key){E.triggerControl.apply(E,[K,E.controls[K]]);return false}}}}return true})}else{if(E.options.brIE){C(E.editorDoc).keydown(function(K){if(K.keyCode===13){var J=E.getRange();J.pasteHTML("<br/>");J.collapse(false);J.select();return false}return true})}}if(E.options.plugins.rmFormat.rmMsWordMarkup){C(E.editorDoc).bind("keyup.wysiwyg",function(J){if(J.ctrlKey||J.metaKey){if(86===J.keyCode){if(C.wysiwyg.rmFormat){if("object"===typeof (E.options.plugins.rmFormat.rmMsWordMarkup)){C.wysiwyg.rmFormat.run(E,{rules:{msWordMarkup:E.options.plugins.rmFormat.rmMsWordMarkup}})}else{C.wysiwyg.rmFormat.run(E,{rules:{msWordMarkup:{enabled:true}}})}}}}})}if(E.options.autoSave){C(E.editorDoc).keydown(function(){E.autoSaveFunction()}).keyup(function(){E.autoSaveFunction()}).mousedown(function(){E.autoSaveFunction()}).bind(C.support.noCloneEvent?"input.wysiwyg":"paste.wysiwyg",function(){E.autoSaveFunction()})}if(E.options.autoGrow){if(E.options.initialMinHeight!==null){E.ui.initialHeight=E.options.initialMinHeight}else{E.ui.initialHeight=C(E.editorDoc).height()}C(E.editorDoc.body).css("border","1px solid white");I=function(){E.ui.grow()};C(E.editorDoc).keyup(I);C(E.editorDoc).bind("editorRefresh.wysiwyg",I);E.ui.grow()}if(E.options.css){if(String===E.options.css.constructor){if(C.browser.msie){G=E.editorDoc.createStyleSheet(E.options.css);C(G).attr({media:"all"})}else{G=C("<link/>").attr({href:E.options.css,media:"all",rel:"stylesheet",type:"text/css"});C(E.editorDoc).find("head").append(G)}}else{E.timers.initFrame_Css=window.setTimeout(function(){C(E.editorDoc.body).css(E.options.css)},0)}}if(E.initialContent.length===0){if("function"===typeof (E.options.initialContent)){E.setContent(E.options.initialContent())}else{E.setContent(E.options.initialContent)}}if(E.options.maxLength>0){C(E.editorDoc).keydown(function(J){if(C(E.editorDoc).text().length>=E.options.maxLength&&C.inArray(J.which,E.validKeyCodes)===-1){J.preventDefault()}})}C.each(E.options.events,function(J,K){C(E.editorDoc).bind(J+".wysiwyg",function(L){K.apply(E.editorDoc,[L,E])})});if(C.browser.msie){C(E.editorDoc).bind("beforedeactivate.wysiwyg",function(){E.savedRange=E.getInternalRange()})}else{C(E.editorDoc).bind("blur.wysiwyg",function(){E.savedRange=E.getInternalRange()})}C(E.editorDoc.body).addClass("wysiwyg");if(E.options.events&&E.options.events.save){F=E.options.events.save;C(E.editorDoc).bind("keyup.wysiwyg",F);C(E.editorDoc).bind("change.wysiwyg",F);if(C.support.noCloneEvent){C(E.editorDoc).bind("input.wysiwyg",F)}else{C(E.editorDoc).bind("paste.wysiwyg",F);C(E.editorDoc).bind("cut.wysiwyg",F)}}if(E.options.xhtml5&&E.options.unicode){var H={ne:8800,le:8804,para:182,xi:958,darr:8595,nu:957,oacute:243,Uacute:218,omega:969,prime:8242,pound:163,igrave:236,thorn:254,forall:8704,emsp:8195,lowast:8727,brvbar:166,alefsym:8501,nbsp:160,delta:948,clubs:9827,lArr:8656,Omega:937,Auml:196,cedil:184,and:8743,plusmn:177,ge:8805,raquo:187,uml:168,equiv:8801,laquo:171,rdquo:8221,Epsilon:917,divide:247,fnof:402,chi:967,Dagger:8225,iacute:237,rceil:8969,sigma:963,Oslash:216,acute:180,frac34:190,lrm:8206,upsih:978,Scaron:352,part:8706,exist:8707,nabla:8711,image:8465,prop:8733,zwj:8205,omicron:959,aacute:225,Yuml:376,Yacute:221,weierp:8472,rsquo:8217,otimes:8855,kappa:954,thetasym:977,harr:8596,Ouml:214,Iota:921,ograve:242,sdot:8901,copy:169,oplus:8853,acirc:226,sup:8835,zeta:950,Iacute:205,Oacute:211,crarr:8629,Nu:925,bdquo:8222,lsquo:8216,apos:39,Beta:914,eacute:233,egrave:232,lceil:8968,Kappa:922,piv:982,Ccedil:199,ldquo:8220,Xi:926,cent:162,uarr:8593,hellip:8230,Aacute:193,ensp:8194,sect:167,Ugrave:217,aelig:230,ordf:170,curren:164,sbquo:8218,macr:175,Phi:934,Eta:919,rho:961,Omicron:927,sup2:178,euro:8364,aring:229,Theta:920,mdash:8212,uuml:252,otilde:245,eta:951,uacute:250,rArr:8658,nsub:8836,agrave:224,notin:8713,ndash:8211,Psi:936,Ocirc:212,sube:8838,szlig:223,micro:181,not:172,sup1:185,middot:183,iota:953,ecirc:234,lsaquo:8249,thinsp:8201,sum:8721,ntilde:241,scaron:353,cap:8745,atilde:227,lang:10216,__replacement:65533,isin:8712,gamma:947,Euml:203,ang:8736,upsilon:965,Ntilde:209,hearts:9829,Alpha:913,Tau:932,spades:9824,dagger:8224,THORN:222,"int":8747,lambda:955,Eacute:201,Uuml:220,infin:8734,rlm:8207,Aring:197,ugrave:249,Egrave:200,Acirc:194,rsaquo:8250,ETH:208,oslash:248,alpha:945,Ograve:210,Prime:8243,mu:956,ni:8715,real:8476,bull:8226,beta:946,icirc:238,eth:240,prod:8719,larr:8592,ordm:186,perp:8869,Gamma:915,reg:174,ucirc:251,Pi:928,psi:968,tilde:732,asymp:8776,zwnj:8204,Agrave:192,deg:176,AElig:198,times:215,Delta:916,sim:8764,Otilde:213,Mu:924,uArr:8657,circ:710,theta:952,Rho:929,sup3:179,diams:9830,tau:964,Chi:935,frac14:188,oelig:339,shy:173,or:8744,dArr:8659,phi:966,iuml:239,Lambda:923,rfloor:8971,iexcl:161,cong:8773,ccedil:231,Icirc:206,frac12:189,loz:9674,rarr:8594,cup:8746,radic:8730,frasl:8260,euml:235,OElig:338,hArr:8660,Atilde:195,Upsilon:933,there4:8756,ouml:246,oline:8254,Ecirc:202,yacute:253,auml:228,permil:8240,sigmaf:962,iquest:191,empty:8709,pi:960,Ucirc:219,supe:8839,Igrave:204,yen:165,rang:10217,trade:8482,lfloor:8970,minus:8722,Zeta:918,sub:8834,epsilon:949,yuml:255,Sigma:931,Iuml:207,ocirc:244};E.events.bind("getContent",function(J){return J.replace(/&(?:amp;)?(?!amp|lt|gt|quot)([a-z][a-z0-9]*);/gi,function(M,L){if(!H[L]){L=L.toLowerCase();if(!H[L]){L="__replacement"}}var K=H[L];return String.fromCharCode(K)})})}C(E.original).trigger("ready.jwysiwyg",[E.editorDoc,E])};this.innerDocument=function(){var E=this.editor.get(0);if(E.nodeName.toLowerCase()==="iframe"){if(E.contentDocument){return E.contentDocument}else{if(E.contentWindow){return E.contentWindow.document}}if(this.isDestroyed){return null}A.error("Unexpected error in innerDocument")}return E};this.insertHtml=function(E){var G,F;if(!E||E.length===0){return this}if(C.browser.msie){this.ui.focus();this.editorDoc.execCommand("insertImage",false,"#jwysiwyg#");G=this.getElementByAttributeValue("img","src","#jwysiwyg#");if(G){C(G).replaceWith(E)}}else{if(C.browser.mozilla){if(1===C(E).length){F=this.getInternalRange();F.deleteContents();F.insertNode(C(E).get(0))}else{this.editorDoc.execCommand("insertHTML",false,E)}}else{if(!this.editorDoc.execCommand("insertHTML",false,E)){this.editor.focus();this.editorDoc.execCommand("insertHTML",false,E)}}}this.saveContent();return this};this.parseControls=function(){var E=this;C.each(this.options.controls,function(G,F){C.each(F,function(H){if(-1===C.inArray(H,E.availableControlProperties)){throw G+'["'+H+'"]: property "'+H+'" not exists in Wysiwyg.availableControlProperties'}})});if(this.options.parseControls){return this.options.parseControls.call(this)}return this.options.controls};this.removeFormat=function(){if(C.browser.msie){this.ui.focus()}if(this.options.removeHeadings){this.editorDoc.execCommand("formatBlock",false,"<p>")}this.editorDoc.execCommand("removeFormat",false,null);this.editorDoc.execCommand("unlink",false,null);if(C.wysiwyg.rmFormat&&C.wysiwyg.rmFormat.enabled){if("object"===typeof (this.options.plugins.rmFormat.rmMsWordMarkup)){C.wysiwyg.rmFormat.run(this,{rules:{msWordMarkup:this.options.plugins.rmFormat.rmMsWordMarkup}})}else{C.wysiwyg.rmFormat.run(this,{rules:{msWordMarkup:{enabled:true}}})}}return this};this.ui.removeHoverClass=function(){C(this).removeClass("wysiwyg-button-hover")};this.resetFunction=function(){this.setContent(this.initialContent)};this.saveContent=function(){if(this.viewHTML){return }if(this.original){var F,E;F=this.getContent();if(this.options.rmUnwantedBr){F=F.replace(/<br\/?>$/,"")}if(this.options.replaceDivWithP){E=C("<div/>").addClass("temp").append(F);E.children("div").each(function(){var H=C(this),I=H.find("p"),G;if(0===I.length){I=C("<p></p>");if(this.attributes.length>0){for(G=0;G<this.attributes.length;G+=1){I.attr(this.attributes[G].name,H.attr(this.attributes[G].name))}}I.append(H.html());H.replaceWith(I)}});F=E.html()}C(this.original).val(F);if(this.options.events&&this.options.events.save){this.options.events.save.call(this)}}return this};this.setContent=function(E){this.editorDoc.body.innerHTML=E;this.saveContent();return this};this.triggerControl=function(F,I){var G=I.command||F,E=I["arguments"]||[];if(I.exec){I.exec.apply(this)}else{this.ui.focus();this.ui.withoutCss();try{this.editorDoc.execCommand(G,false,E)}catch(H){A.error(H)}}if(this.options.autoSave){this.autoSaveFunction()}};this.triggerControlCallback=function(E){C(window).trigger("trigger-"+E+".wysiwyg",[this])};this.ui.withoutCss=function(){var E=this.self;if(C.browser.mozilla){try{E.editorDoc.execCommand("styleWithCSS",false,false)}catch(G){try{E.editorDoc.execCommand("useCSS",false,true)}catch(F){}}}return E};this.wrapInitialContent=function(){var E=this.initialContent,F=E.match(/<\/?p>/gi);if(!F){return E}else{}return E}}C.wysiwyg={messages:{noObject:"Something goes wrong, check object"},addControl:function(F,E,G){return F.each(function(){var H=C(this).data("wysiwyg"),J={},I;if(!H){return this}J[E]=C.extend(true,{visible:true,custom:true},G);C.extend(true,H.options.controls,J);I=C(H.options.toolbarHtml);H.ui.toolbar.replaceWith(I);H.ui.toolbar=I;H.ui.appendControls()})},clear:function(E){return E.each(function(){var F=C(this).data("wysiwyg");if(!F){return this}F.setContent("")})},console:A,destroy:function(E){return E.each(function(){var F=C(this).data("wysiwyg");if(!F){return this}F.destroy()})},document:function(F){var E=F.data("wysiwyg");if(!E){return undefined}return C(E.editorDoc)},getContent:function(F){var E=F.data("wysiwyg");if(!E){return undefined}return E.getContent()},getSelection:function(F){var E=F.data("wysiwyg");if(!E){return undefined}return E.getRangeText()},init:function(F,E){return F.each(function(){var G=C.extend(true,{},E),H;if(("textarea"!==this.nodeName.toLowerCase())||C(this).data("wysiwyg")){return }H=new D();H.init(this,G);C.data(this,"wysiwyg",H);C(H.editorDoc).trigger("afterInit.wysiwyg")})},insertHtml:function(F,E){return F.each(function(){var G=C(this).data("wysiwyg");if(!G){return this}G.insertHtml(E)})},plugin:{listeners:{},bind:function(F){var E=this;C.each(this.listeners,function(J,G){var H,I;for(H=0;H<G.length;H+=1){I=E.parseName(G[H]);C(F.editorDoc).bind(J+".wysiwyg",{plugin:I},function(K){C.wysiwyg[K.data.plugin.name][K.data.plugin.method].apply(C.wysiwyg[K.data.plugin.name],[F])})}})},exists:function(E){var F;if("string"!==typeof (E)){return false}F=this.parseName(E);if(!C.wysiwyg[F.name]||!C.wysiwyg[F.name][F.method]){return false}return true},listen:function(G,E){var F;F=this.parseName(E);if(!C.wysiwyg[F.name]||!C.wysiwyg[F.name][F.method]){return false}if(!this.listeners[G]){this.listeners[G]=[]}this.listeners[G].push(E);return true},parseName:function(E){var F;if("string"!==typeof (E)){return false}F=E.split(".");if(2>F.length){return false}return{name:F[0],method:F[1]}},register:function(E){if(!E.name){A.error("Plugin name missing")}C.each(C.wysiwyg,function(F){if(F===E.name){A.error("Plugin with name '"+E.name+"' was already registered")}});C.wysiwyg[E.name]=E;return true}},removeFormat:function(E){return E.each(function(){var F=C(this).data("wysiwyg");if(!F){return this}F.removeFormat()})},save:function(E){return E.each(function(){var F=C(this).data("wysiwyg");if(!F){return this}F.saveContent()})},selectAll:function(G){var E=G.data("wysiwyg"),F,I,H;if(!E){return this}F=E.editorDoc.body;if(window.getSelection){H=E.getInternalSelection();H.selectAllChildren(F)}else{I=F.createTextRange();I.moveToElementText(F);I.select()}},setContent:function(F,E){return F.each(function(){var G=C(this).data("wysiwyg");if(!G){return this}G.setContent(E)})},triggerControl:function(E,F){return E.each(function(){var G=C(this).data("wysiwyg");if(!G){return this}if(!G.controls[F]){A.error("Control '"+F+"' not exists")}G.triggerControl.apply(G,[F,G.controls[F]])})},support:{prop:B},utils:{extraSafeEntities:[["<",">","'",'"'," "],[32]],encodeEntities:function(H){var F=this,E,G=[];if(this.extraSafeEntities[1].length===0){C.each(this.extraSafeEntities[0],function(I,J){F.extraSafeEntities[1].push(J.charCodeAt(0))})}E=H.split("");C.each(E,function(I){var J=E[I].charCodeAt(0);if(C.inArray(J,F.extraSafeEntities[1])&&(J<65||J>127||(J>90&&J<97))){G.push("&#"+J+";")}else{G.push(E[I])}});return G.join("")}}};C.wysiwyg.dialog=function(F,H){var J=(F&&F.options&&F.options.dialog)?F.options.dialog:(H.theme?H.theme:"default"),I=new C.wysiwyg.dialog.createDialog(J),G=this,E=C(G);this.options={modal:true,draggable:true,title:"Title",content:"Content",width:"auto",height:"auto",zIndex:2000,open:false,close:false};this.isOpen=false;C.extend(this.options,H);this.object=I;this.open=function(){this.isOpen=true;I.init.apply(G,[]);var K=I.show.apply(G,[]);E.trigger("afterOpen",[K])};this.show=function(){this.isOpen=true;E.trigger("beforeShow");var K=I.show.apply(G,[]);E.trigger("afterShow")};this.hide=function(){this.isOpen=false;E.trigger("beforeHide");var K=I.hide.apply(G,[]);E.trigger("afterHide",[K])};this.close=function(){this.isOpen=false;var K=I.hide.apply(G,[]);E.trigger("beforeClose",[K]);I.destroy.apply(G,[]);E.trigger("afterClose",[K])};if(this.options.open){E.bind("afterOpen",this.options.open)}if(this.options.close){E.bind("afterClose",this.options.close)}return this};C.extend(true,C.wysiwyg.dialog,{_themes:{},_theme:"",register:function(E,F){C.wysiwyg.dialog._themes[E]=F},deregister:function(E){delete C.wysiwyg.dialog._themes[E]},createDialog:function(E){return new (C.wysiwyg.dialog._themes[E])},getDimensions:function(){var F=document.body.scrollWidth,E=document.body.scrollHeight;if(C.browser.opera){E=Math.max(C(document).height(),C(window).height(),document.documentElement.clientHeight)}return[F,E]}});C(function(){if(jQuery.ui){C.wysiwyg.dialog.register("jqueryui",function(){var E=this;this._$dialog=null;this.init=function(){var I=this,G=this.options.content;if(typeof G==="object"){if(typeof G.html==="function"){G=G.html()}else{if(typeof G.toString==="function"){G=G.toString()}}}E._$dialog=C("<div></div>").attr("title",this.options.title).html(G);var F=this.options.height=="auto"?300:this.options.height,H=this.options.width=="auto"?450:this.options.width;E._$dialog.dialog({modal:this.options.modal,draggable:this.options.draggable,height:F,width:H});return E._$dialog};this.show=function(){E._$dialog.dialog("open");return E._$dialog};this.hide=function(){E._$dialog.dialog("close");return E._$dialog};this.destroy=function(){E._$dialog.dialog("destroy");return E._$dialog}})}C.wysiwyg.dialog.register("default",function(){var E=this;this._$dialog=null;this.init=function(){var L=this,I=this.options.content;if(typeof I==="object"){if(typeof I.html==="function"){I=I.html()}else{if(typeof I.toString==="function"){I=I.toString()}}}E._$dialog=C('<div class="wysiwyg-dialog"></div>').css({"z-index":this.options.zIndex});var H=C('<div class="wysiwyg-dialog-topbar"><div class="wysiwyg-dialog-close-wrapper"></div><div class="wysiwyg-dialog-title">'+this.options.title+"</div></div>");var F=C('<a href="#" class="wysiwyg-dialog-close-button">X</a>');F.click(function(){L.close()});H.find(".wysiwyg-dialog-close-wrapper").prepend(F);var K=C('<div class="wysiwyg-dialog-content">'+I+"</div>");E._$dialog.append(H).append(K);var G=this.options.height=="auto"?300:this.options.height,J=this.options.width=="auto"?450:this.options.width;E._$dialog.hide().css({width:J,height:G,left:((C(window).width()-J)/2),top:((C(window).height()-G)/3)});C("body").append(E._$dialog);return E._$dialog};this.show=function(){if(this.options.modal){var G=C.wysiwyg.dialog.getDimensions(),H=C('<div class="wysiwyg-dialog-modal-div"></div>').css({width:G[0],height:G[1]});E._$dialog.wrap(H)}if(this.options.draggable){var F=false;E._$dialog.find("div.wysiwyg-dialog-topbar").bind("mousedown",function(L){L.preventDefault();C(this).css({cursor:"move"});var J=C(this),K=C(this).parents(".wysiwyg-dialog"),I=(L.pageX-parseInt(K.css("left"),10)),M=(L.pageY-parseInt(K.css("top"),10));F=true;C(this).css({cursor:"move"});C(document).bind("mousemove",function(N){N.preventDefault();if(F){K.css({top:(N.pageY-M),left:(N.pageX-I)})}}).bind("mouseup",function(N){N.preventDefault();F=false;J.css({cursor:"auto"});C(document).unbind("mousemove").unbind("mouseup")})})}E._$dialog.show();return E._$dialog};this.hide=function(){E._$dialog.hide();return E._$dialog};this.destroy=function(){if(this.options.modal){E._$dialog.unwrap()}if(this.options.draggable){E._$dialog.find("div.wysiwyg-dialog-topbar").unbind("mousedown")}E._$dialog.remove();return E._$dialog}})});C.fn.wysiwyg=function(G){var E=arguments,F;if("undefined"!==typeof C.wysiwyg[G]){E=Array.prototype.concat.call([E[0]],[this],Array.prototype.slice.call(E,1));return C.wysiwyg[G].apply(C.wysiwyg,Array.prototype.slice.call(E,1))}else{if("object"===typeof G||!G){Array.prototype.unshift.call(E,this);return C.wysiwyg.init.apply(C.wysiwyg,E)}else{if(C.wysiwyg.plugin.exists(G)){F=C.wysiwyg.plugin.parseName(G);E=Array.prototype.concat.call([E[0]],[this],Array.prototype.slice.call(E,1));return C.wysiwyg[F.name][F.method].apply(C.wysiwyg[F.name],Array.prototype.slice.call(E,1))}else{A.error("Method '"+G+"' does not exist on jQuery.wysiwyg.\nTry to include some extra controls or plugins")}}}};C.fn.getWysiwyg=function(){return this.data("wysiwyg")}})(jQuery);(function(B){var A;A=function(){var F=A.makeArray(arguments);if(F.length==0){alert("No arguments - no supported");return null}var E=F[0];var U=null;var J=null;var N=null;var M=null;var K=null;var G=null;var L=null;var C=null;var I=false;if(F.length==1){var O=B(E).find(":first");var D=null;for(var R=0;R<O.length;R++){var T=O[R];var Q=B(T).attr("alpaca-field-id");if(Q){var P=A.fieldInstances[Q];if(P){D=P}}}if(D!=null){return D}else{var H=B(E).html();B(E).html("");U=H}}if(F.length>=2){if(A.isObject(F[1])){U=F[1].data;N=F[1].schema;J=F[1].options;M=F[1].view;K=F[1].render;G=F[1].postRender;L=F[1].error;C=F[1].connector;if(!A.isEmpty(F[1].notTopLevel)){I=F[1].notTopLevel}}else{U=F[1];if(A.isFunction(U)){U=U()}}}if(A.isEmpty(L)){L=function(V){alert(V.message)}}if(A.isEmpty(C)){C=new A.Connector("default")}if(A.isEmpty(U)){if(A.isEmpty(N)&&(A.isEmpty(J)||A.isEmpty(J.type))){if(A.isEmpty(J)){U="";J="text"}else{if(J&&A.isObject(J)){U="";J.type="text"}}}}if(E){if(A.isString(E)){E=B("#"+E)}}var S=C;if(I){S=new A.Connector("default")}S.loadAll({data:U,options:J,schema:N,view:M},function(V,W,X,Y){return A.init(E,V,W,X,Y,K,G,C,L)},function(V){L(V);return null})};A.Fields={};A.Connectors={};B.extend(A,{VERSION:"0.1.0",makeArray:function(C){return Array.prototype.slice.call(C)},isFunction:function(C){return Object.prototype.toString.call(C)==="[object Function]"},isString:function(C){return(typeof C=="string")},isObject:function(C){return B.isPlainObject(C)},isNumber:function(C){return(typeof C=="number")},isArray:function(C){return Object.prototype.toString.call(C)==="[object Array]"},isBoolean:function(C){return(typeof C=="boolean")},isUndefined:function(C){return(typeof C=="undefined")},isEmpty:function(C){return A.isUndefined(C)||C==null},spliceIn:function(C,D,E){return C.substring(0,D)+E+C.substring(D,C.length)},compactArray:function(C){var F=[],D=C.length,E;for(E=0;E<D;E++){if(!lang.isNull(C[E])&&!lang.isUndefined(C[E])){F.push(C[E])}}return F},removeAccents:function(C){return C.replace(/[]/g,"a").replace(/[]/g,"e").replace(/[]/g,"i").replace(/[]/g,"o").replace(/[]/g,"u").replace(/[]/g,"y").replace(/[]/g,"n").replace(/[]/g,"c").replace(/[]/g,"oe").replace(/[]/g,"ae")},indexOf:function(G,C,F){var D=C.length,E;if(!A.isFunction(F)){F=function(H,I){return H===I}}for(E=0;E<D;E++){if(F.call({},G,C[E])){return E}}return -1},log:function(C){if(!(typeof console=="undefined")){console.log(C)}},uniqueIdCounter:0,defaultLocale:"en_US",setDefaultLocale:function(C){this.defaultLocale=C},defaultSchemaFieldMapping:{},registerDefaultSchemaFieldMapping:function(D,C){if(D&&C){this.defaultSchemaFieldMapping[D]=C}},defaultFormatFieldMapping:{},registerDefaultFormatFieldMapping:function(D,C){if(D&&C){this.defaultFormatFieldMapping[D]=C}},getSchemaType:function(C){if(A.isEmpty(C)){return"string"}if(A.isObject(C)){return"object"}if(A.isString(C)){return"string"}if(A.isNumber(C)){return"number"}if(A.isArray(C)){return"array"}if(A.isBoolean(C)){return"boolean"}if(typeof C=="object"){return"object"}},views:{},viewIdPrefix:"VIEW::",isValidViewId:function(C){return A.startsWith(C,this.viewIdPrefix)},generateViewId:function(){return this.viewIdPrefix+"VIEW_"+this.generateId()},registerView:function(C){var H=C.id;if(!A.isEmpty(H)&&this.isValidViewId(H)){if(this.views[H]){var E=this.views[H];if(C.description){E.description=C.description}if(C.type){E.type=C.type}if(C.id){E.id=C.id}if(C.templates){if(!E.templates){E.templates={}}A.merge(E.templates,C.templates)}if(C.messages){if(!E.messages){E.messages={}}A.merge(E.messages,C.messages)}}else{this.views[H]=C}var D=A.cloneObject(C.templates);for(var F in D){var G=C.templates[F];if(A.isString(G)&&!A.startsWith(G,C.id)){C.templates[C.id+"_"+F+"_src"]=G;if(G&&!A.isUri(G)){B.template(C.id+"_"+F,G);C.templates[F]=C.id+"_"+F}else{C.templates[F]=G}}}}else{alert("Invalid View ID (must starts with "+this.viewIdPrefix+")")}return H},defaultView:"VIEW::WEB_EDIT",getView:function(C){if(C&&this.views.hasOwnProperty(C)){return this.views[C]}else{return this.views[this.defaultView]}},getViewType:function(C){if(A.isString(C)){C=this.getView(C)}if(A.isObject(C)){if(C.type){return C.type}else{if(C.parent){return this.getViewType(C.parent)}else{return null}}}},setDefaultView:function(C){if(C&&this.views.hasOwnProperty(C)){this.defaultView=C}},registerTemplate:function(E,F,C){var D=this.getView(C);if(!D){if(C){D=this.views[C]={}}else{D=this.views[this.defaultView]={}}}if(D){if(!D.templates){D.templates={}}if(F&&!A.isUri(F)){B.template(D.id+"_"+E,F);D.templates[E]=D.id+"_"+E}else{D.templates[E]=F}}},registerTemplates:function(E,C){for(var D in E){this.registerTemplate(D,E[D],C)}},registerMessage:function(E,F,C){var D=this.getView(C);if(!D){if(C){this.views[C]={};D=this.views[C]}else{this.views[this.defaultView]={};D=this.views[this.defaultView]}}if(D){if(!D.messages){D.messages={}}D.messages[E]=F}},registerMessages:function(E,C){for(var D in E){if(E.hasOwnProperty(D)){this.registerMessage(D,E[D],C)}}},fieldTemplatePostfix:{controlFieldMessageContainer:"-controlfield-message-container",controlFieldLabel:"-controlfield-label",controlFieldContainer:"-controlfield-container",controlFieldHelper:"-controlfield-helper",fieldSetLegend:"-fieldset-legend",fieldSetItemsContainer:"-fieldset-items-container",fieldSetHelper:"-fieldset-helper",fieldSetOuterEl:"-fieldset",formButtonsContainer:"-form-buttons-container",formFieldsContainer:"-form-fields-container"},fieldTemplate:function(E,D,G){if(!D){D="controlFieldLabel"}var F=this.getTemplate(D,E.data);if(G){if(this.getTemplate(F+"_src",E.data)){F=this.getTemplate(F+"_src",E.data)}if(B(".alpaca"+this.fieldTemplatePostfix[D],B(F)).length==0){if(this.fieldTemplatePostfix[D]){F=B(F).addClass("alpaca"+this.fieldTemplatePostfix[D]).outerHTML(true)}else{F=B(F).outerHTML(true)}}return F}else{var C=B.tmpl(F,E.data);if(C){if(this.fieldTemplatePostfix[D]){if(B(".alpaca"+this.fieldTemplatePostfix[D],C).length==0){C.addClass("alpaca"+this.fieldTemplatePostfix[D])}if(!C.attr("id")){C.attr("id",E.data.id+this.fieldTemplatePostfix[D])}}return C.outerHTML(true)}else{return""}}},getTemplate:function(D,F){var C=F.view;if(A.isObject(C)){var E=this._getTemplate(D,C,F.path);if(!A.isEmpty(E)){return E}C=this.defaultView}if(A.isString(C)){C=this.getView(C);return this._getTemplate(D,C,F.path)}return null},_getTemplate:function(D,C,E){if(C&&C.fields&&C.fields[E]&&C.fields[E].templates&&C.fields[E].templates[D]){return C.fields[E].templates[D]}if(C&&C.templates&&C.templates[D]){return C.templates[D]}else{if(C&&C.parent){return this._getTemplate(D,this.views[C.parent],E)}else{return null}}},defaultDateFormat:"mm/dd/yy",regexps:{email:/^[a-z0-9!\#\$%&'\*\-\/=\?\+\-\^_`\{\|\}~]+(?:\.[a-z0-9!\#\$%&'\*\-\/=\?\+\-\^_`\{\|\}~]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z]{2,6}$/i,url:/^(http|https):\/\/[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(\:[0-9]{1,5})?(([0-9]{1,5})?\/.*)?$/i,password:/^[0-9a-zA-Z\x20-\x7E]*$/,date:/^(0[1-9]|1[012])[- /.](0[1-9]|[12][0-9]|3[01])[- /.]\d\d$/,integer:/^([\+\-]?([1-9]\d*)|0)$/,number:/^([\+\-]?((([0-9]+(\.)?)|([0-9]*\.[0-9]+))([eE][+-]?[0-9]+)?))$/,phone:/^(\D?(\d{3})\D?\D?(\d{3})\D?(\d{4}))?$/,ipv4:/^(?:1\d?\d?|2(?:[0-4]\d?|[6789]|5[0-5]?)?|[3-9]\d?|0)(?:\.(?:1\d?\d?|2(?:[0-4]\d?|[6789]|5[0-5]?)?|[3-9]\d?|0)){3}$/},fieldInstances:{},fieldClassRegistry:{},registerFieldClass:function(C,D){this.fieldClassRegistry[C]=D},getFieldClass:function(C){return this.fieldClassRegistry[C]},getFieldClassType:function(D){for(var C in this.fieldClassRegistry){if(this.fieldClassRegistry.hasOwnProperty(C)){if(this.fieldClassRegistry[C]==D){return C}}}return null},connectorClassRegistry:{},registerConnectorClass:function(D,C){this.connectorClassRegistry[D]=C},getConnectorClass:function(C){return this.connectorClassRegistry[C]},replaceAll:function(E,C,D){return E.replace(new RegExp(C,"g"),D)},element:function(C,E,D,G){var F=B("<"+C+"/>");if(E){F.attr(E)}if(D){F.css(D)}if(G){for(className in G){F.addClass(className)}}},elementFromTemplate:function(D,E){var C=D;if(E){for(x in E){C=A.replaceAll(C,"${"+x+"}",E[x])}}return B(C)},generateId:function(){A.uniqueIdCounter++;return"alpaca"+A.uniqueIdCounter},later:function(J,D,K,F,G){J=J||0;D=D||{};var E=K,I=B.makeArray(F),H,C;if(typeof K==="string"){E=D[K]}if(!E){throw {name:"TypeError",message:"The function is undefined."}}H=function(){E.apply(D,I)};C=(G)?setInterval(H,J):setTimeout(H,J);return{id:C,interval:G,cancel:function(){if(this.interval){clearInterval(C)}else{clearTimeout(C)}}}},endsWith:function(D,C){return D.indexOf(C,D.length-C.length)!==-1},startsWith:function(D,C){return D.substr(0,C.length)===C},isUri:function(C){return A.isString(C)&&(A.startsWith(C,"http://")||A.startsWith(C,"https://")||A.startsWith(C,"/")||A.startsWith(C,"./")||A.startsWith(C,"../"))},traverseObject:function(C,G,F){if(A.isString(G)){G=G.split(".")}var E=null;var H=C;var D=null;do{D=G.shift();if(F&&D==F){D=G.shift()}if(!A.isEmpty(H[D])){H=H[D];if(G.length==0){E=H}}else{G=[]}}while(G.length>0);return E},each:function(F,E){if(A.isArray(F)){for(var D=0;D<F.length;D++){E.apply(F[D])}}else{if(A.isObject(F)){for(var C in F){E.apply(F[C])}}}},merge:function(G,F,D){if(!G){G={}}for(var C in F){var E=true;if(D){E=D(C)}if(E){if(A.isEmpty(F[C])){G[C]=F[C]}else{if(A.isObject(F[C])){if(!G[C]){G[C]={}}G[C]=A.merge(G[C],F[C])}else{G[C]=F[C]}}}}return G},mergeObject:function(E,D){if(!E){E={}}for(var C in D){if(!A.isFunction(D[C])){if(A.isValEmpty(D[C])){if(!A.isEmpty(E[C])){E[C]=D[C]}}else{if(A.isObject(D[C])){if(!E[C]){E[C]={}}E[C]=A.mergeObject(E[C],D[C])}else{E[C]=D[C]}}}}return E},cloneObject:function(D){var E;if(A.isObject(D)){E={};for(var C in D){if(D.hasOwnProperty(C)){if(A.isObject(D[C])||A.isArray(D[C])){E[C]=A.cloneObject(D[C])}else{E[C]=D[C]}}}}else{if(A.isArray(D)){E=[];for(var C=0;C<D.length;C++){if(A.isObject(D[C])||A.isArray(D[C])){E.push(A.cloneObject(D[C]))}else{E.push(D[C])}}}else{E=D}}return E},substituteTokens:function(H,D){if(!A.isEmpty(H)){for(var G=0;G<D.length;G++){var F="{"+G+"}";var C=H.indexOf(F);if(C>-1){var E=H.substring(0,C)+D[G]+H.substring(C+3);H=E}}}return H},compareObject:function(D,C){return equiv(D,C)},compareArrayContent:function(D,C){var E=D&&C&&(D.length==C.length);if(E){B.each(D,function(G,F){if(!E){return false}if(B.inArray(F,C)==-1){E=false}else{E=true}})}return E},isValEmpty:function(D){var C=false;if(A.isEmpty(D)){C=true}else{if(A.isString(D)&&D==""){C=true}if(A.isObject(D)&&B.isEmptyObject(D)){C=true}if(A.isArray(D)&&D.length==0){C=true}if(A.isNumber(D)&&isNaN(D)){C=true}}return C},init:function(C,F,L,E,I,K,H,D,G){var J=A.createFieldInstance(C,F,L,E,I,D,G);A.fieldInstances[J.getId()]=J;if(A.isEmpty(K)){K=J.view.render}if(A.isEmpty(H)){H=J.view.postRender}if(K!=null){K(J,H)}else{J.render(H)}J.callback=K;J.renderedCallback=H;return J},createFieldInstance:function(C,F,K,E,J,D,G){if(A.isValEmpty(K)){K={}}if(A.isValEmpty(E)){E={}}if(K&&A.isString(K)){var H=K;K={};K.type=H}if(!K.type){if(!E.type){E.type=A.getSchemaType(F)}if(E&&E["enum"]){if(E["enum"].length>3){K.type="select"}else{K.type="radio"}}else{K.type=A.defaultSchemaFieldMapping[E.type]}if(E.format&&A.defaultFormatFieldMapping[E.format]){K.type=A.defaultFormatFieldMapping[E.format]}}var I=A.getFieldClass(K.type);if(!I){G({message:"Unable to find field class for type: "+K.type,reason:"FIELD_INSTANTIATION_ERROR"});return null}return new I(C,F,K,E,J,D)}});B.alpaca=window.Alpaca=A;B.fn.alpaca=function(){var D=A.makeArray(arguments);var C=[].concat(this,D);return A.apply(this,C)};B.fn.outerHTML=function(C){if(C){return B("<div></div>").append(this).html()}else{return B("<div></div>").append(this.clone()).html()}};B.fn.swapWith=function(C){return this.each(function(){var D=B(C).clone();var E=B(this).clone();B(C).replaceWith(E);B(this).replaceWith(D)})};B.fn.filestyle=function(C){var D={width:250};if(C){B.extend(D,C)}return this.each(function(){var F=this;var H=B("<div>").addClass("alpaca-filefield-button");var E=B("<input/>").addClass("alpaca-filefield-control").addClass(B(F).attr("class"));var G=E.width;B(F).before(E);B(F).wrap(H);B(F).css({position:"relative",height:H.css("height"),width:D.width+"px",display:"inline",cursor:"pointer",opacity:"0.0"});if(B.browser.mozilla){if(/Win/.test(navigator.platform)){B(F).css("margin-left","-142px")}else{B(F).css("margin-left","-168px")}}else{B(F).css("margin-left",H.width-G+"px")}B(F).bind("change",function(){E.val(B(F).val())})})};B.fn.customFileInput=function(){return B(this).each(function(){var E=B(this).addClass("alpaca-controlfield-file-custom-input").focus(function(){E.data("val",E.val())}).blur(function(){B(this).trigger("checkChange")}).bind("disable",function(){E.attr("disabled",true);D.addClass("alpaca-controlfield-file-custom-disabled")}).bind("enable",function(){E.removeAttr("disabled");D.removeClass("alpaca-controlfield-file-custom-disabled")}).bind("checkChange",function(){if(E.val()&&E.val()!=E.data("val")){E.trigger("change")}}).bind("change",function(){var J=B(this).val().split(/\\/).pop();var I="customfile-ext-"+J.split(".").pop().toLowerCase();F.text(J).data("fileExt",I);B(".ui-icon",F.parent()).remove();var H=J.split(".").pop().toLowerCase();var G="ui-icon-document";if(H=="jpg"||H=="gif"||H=="png"||H=="jpeg"||H=="bmp"){G="ui-icon-image"}if(H=="mp3"||H=="mp4"||H=="swf"||H=="mov"||H=="wav"||H=="m4v"){G="ui-icon-video"}if(H=="json"||H=="js"){G="ui-icon-script"}F.before('<span class="ui-icon '+G+'" style="float:left;margin-top:0.3em"></span>')}).click(function(){E.data("val",E.val());setTimeout(function(){E.trigger("checkChange")},100)});var D=B('<div class="ui-widget-header ui-corner-all alpaca-controlfield-file-custom"></div>');var C=B('<span class="" aria-hidden="true" style="float:right">Browse...</span>').button({text:true}).appendTo(D);var F=B('<span class="alpaca-controlfield-file-custom-feedback" aria-hidden="true">No file selected...</span>').appendTo(D);if(E.is("[disabled]")){E.trigger("disable")}D.mousemove(function(G){E.css({left:G.pageX-D.offset().left-E.outerWidth()+20,top:G.pageY-D.offset().top-B(window).scrollTop()-3})}).insertAfter(E);E.appendTo(D);D.wrap("<small/>")})}})(jQuery);(function(B){var A=B.alpaca;A.registerView({id:"VIEW::WEB_DISPLAY",title:"Default Web Display View",description:"Default web edit view which goes though field hierarchy.",type:"view",platform:"web",displayReadonly:true,templates:{controlField:'<div class="alpaca-data-container">{{if options.label}}<div class="alpaca-data-label">${options.label}</div>{{/if}}<div class="alpaca-data">&nbsp;${data}</div></div>',fieldSetOuterEl:'<div class="ui-widget ui-widget-content">{{html this.html}}</div>',fieldSetLegend:'{{if options.label}}<div class="{{if options.labelClass}}${options.labelClass}{{/if}}">${options.label}</div>{{/if}}',fieldSetItemsContainer:"<div>{{html this.html}}</div>",fieldSet:'{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetOuterEl",true)}}{{html Alpaca.fieldTemplate(this,"fieldSetLegend")}}{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetItemsContainer",true)}}{{/wrap}}{{/wrap}}'}});A.registerView({id:"VIEW::WEB_EDIT",title:"Default Web Edit View",description:"Default web edit view which goes though field hierarchy.",type:"edit",platform:"web",displayReadonly:true,templates:{controlFieldOuterEl:"<span>{{html this.html}}</span>",controlFieldMessage:'<div><span class="ui-icon ui-icon-alert"></span><span class="alpaca-controlfield-message-text">${message}</span></div>',controlFieldLabel:'{{if options.label}}<div class="{{if options.labelClass}}${options.labelClass}{{/if}}"><div>${options.label}</div></div>{{/if}}',controlFieldHelper:'{{if options.helper}}<div class="{{if options.helperClass}}${options.helperClass}{{/if}}"><span class="ui-icon ui-icon-info"></span><span class="alpaca-controlfield-helper-text">${options.helper}</span></div>{{/if}}',controlFieldContainer:"<div>{{html this.html}}</div>",controlField:'{{wrap(null, {}) Alpaca.fieldTemplate(this,"controlFieldOuterEl",true)}}{{html Alpaca.fieldTemplate(this,"controlFieldLabel")}}{{wrap(null, {}) Alpaca.fieldTemplate(this,"controlFieldContainer",true)}}{{html Alpaca.fieldTemplate(this,"controlFieldHelper")}}{{/wrap}}{{/wrap}}',fieldSetOuterEl:"<fieldset>{{html this.html}}</fieldset>",fieldSetMessage:'<div><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span><span>${message}</span></div>',fieldSetLegend:'{{if options.label}}<legend class="{{if options.labelClass}}${options.labelClass}{{/if}}">${options.label}</legend>{{/if}}',fieldSetHelper:'{{if options.helper}}<div class="{{if options.helperClass}}${options.helperClass}{{/if}}">${options.helper}</div>{{/if}}',fieldSetItemsContainer:"<div>{{html this.html}}</div>",fieldSet:'{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetOuterEl",true)}}{{html Alpaca.fieldTemplate(this,"fieldSetLegend")}}{{html Alpaca.fieldTemplate(this,"fieldSetHelper")}}{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetItemsContainer",true)}}{{/wrap}}{{/wrap}}',fieldSetItemContainer:"<div></div>",formFieldsContainer:"<div>{{html this.html}}</div>",formButtonsContainer:"<div>{{html this.html}}</div>",form:'<form>{{html Alpaca.fieldTemplate(this,"formFieldsContainer")}}{{html Alpaca.fieldTemplate(this,"formButtonsContainer")}}</form>',wizardStep:'<div class="alpaca-clear"></div>',wizardNavBar:"<div></div>",wizardPreButton:"<button>Back</button>",wizardNextButton:"<button>Next</button>",wizardStatusBar:'<ol id="${id}">{{each(i,v) titles}}<li id="stepDesc${i}"><div><strong><span>${v.title}</span>${v.description}</strong></div></li>{{/each}}</ol>'},messages:{empty:"",required:"This field is required",valid:"",invalid:"This field is invalid",months:["January","February","March","April","May","June","July","August","September","October","November","December"],timeUnits:{SECOND:"seconds",MINUTE:"minutes",HOUR:"hours",DAY:"days",MONTH:"months",YEAR:"years"}}});A.registerView({id:"VIEW::WEB_CREATE",parent:"VIEW::WEB_EDIT",title:"Default Web Create View",description:"Default web create view which doesn't bind initial data.",type:"create",displayReadonly:false})})(jQuery);(function(B){var A=B.alpaca;A.registerView({id:"VIEW::WEB_EDIT_LIST",parent:"VIEW::WEB_EDIT",title:"Web Edit View List Style",description:"Web edit view based on list styles.",type:"edit",displayReadonly:true,collapsible:true,legendStyle:"link",templates:{controlFieldOuterEl:'<span class="alpaca-view-web-edit-list">{{html this.html}}</span>',controlFieldMessage:'<div><span class="ui-icon ui-icon-alert"></span><span class="alpaca-controlfield-message-text">${message}</span></div>',controlFieldLabel:'{{if options.label}}<label for="${id}" class="{{if options.labelClass}}${options.labelClass}{{/if}}">${options.label}</label>{{/if}}',controlFieldHelper:'{{if options.helper}}<div class="{{if options.helperClass}}${options.helperClass}{{/if}}"><span class="ui-icon ui-icon-info"></span><span class="alpaca-controlfield-helper-text">${options.helper}</span></div>{{/if}}',controlFieldContainer:"<div>{{html this.html}}</div>",controlField:'{{wrap(null, {}) Alpaca.fieldTemplate(this,"controlFieldOuterEl",true)}}{{html Alpaca.fieldTemplate(this,"controlFieldLabel")}}{{wrap(null, {}) Alpaca.fieldTemplate(this,"controlFieldContainer",true)}}{{html Alpaca.fieldTemplate(this,"controlFieldHelper")}}{{/wrap}}{{/wrap}}',fieldSetOuterEl:'<fieldset class="alpaca-view-web-edit-list">{{html this.html}}</fieldset>',fieldSetMessage:'<div><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span><span>${message}</span></div>',fieldSetLegend:'{{if options.label}}<legend class="{{if options.labelClass}}${options.labelClass}{{/if}}">${options.label}</legend>{{/if}}',fieldSetHelper:'{{if options.helper}}<div class="{{if options.helperClass}}${options.helperClass}{{/if}}">${options.helper}</div>{{/if}}',fieldSetItemsContainer:"<ol>{{html this.html}}</ol>",fieldSet:'{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetOuterEl",true)}}{{html Alpaca.fieldTemplate(this,"fieldSetLegend")}}{{html Alpaca.fieldTemplate(this,"fieldSetHelper")}}{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetItemsContainer",true)}}{{/wrap}}{{/wrap}}',fieldSetItemContainer:'<li style="list-style:none;"></li>',itemLabel:'{{if options.itemLabel}}<label for="${id}" class="alpaca-controlfield-label" style="width:100px;display:inline-block;vertical-align:top;padding-top:0.5em;"><span style="width:100px;display:inline-block;vertical-align:top;;padding-top:0.25em">${options.itemLabel}{{if index}} <span class="alpaca-item-label-counter">${index}</span></span>{{/if}}</label>{{/if}}'},styles:{},fields:{"/":{templates:{fieldSetOuterEl:'<fieldset style="border:none">{{html this.html}}</fieldset>',fieldSetMessage:'<div><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span><span>${message}</span></div>',fieldSetLegend:'{{if options.label}}<legend class="{{if options.labelClass}}${options.labelClass}{{/if}}" style="padding-top:2em;border:none;">${options.label}</legend>{{/if}}',fieldSetHelper:'{{if options.helper}}<div class="{{if options.helperClass}}${options.helperClass}{{/if}}">${options.helper}</div>{{/if}}',fieldSetItemsContainer:'<ol style="padding-left :0;">{{html this.html}}</ol>',fieldSet:'{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetOuterEl",true)}}{{html Alpaca.fieldTemplate(this,"fieldSetLegend")}}{{html Alpaca.fieldTemplate(this,"fieldSetHelper")}}{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetItemsContainer",true)}}{{/wrap}}{{/wrap}}',fieldSetItemContainer:'<li style="list-style:none;"></li>'}}}})})(jQuery);(function(B){var A=B.alpaca;A.registerView({id:"VIEW::MOBILE_DISPLAY",parent:"VIEW::WEB_DISPLAY",title:"Mobile DISPLAY View",description:"Mobile display view using JQuery Mobile Library",type:"view",platform:"mobile",legendStyle:"link",toolbarStyle:"link",buttonType:"link",templates:{controlField:'<ul data-role="listview"><li>{{if options.label}}<h4>${options.label}</h4>{{/if}}<p><strong>${data}</strong></p></li></ul>',fieldSetOuterEl:'<fieldset data-role="collapsible" id="${id}">{{html this.html}}</fieldset>',fieldSetMessage:"<div>* ${message}</div>",fieldSetLegend:'{{if options.label}}<legend for="${id}" class="{{if options.labelClass}}${options.labelClass}{{/if}}">${options.label}</legend>{{/if}}',fieldSetHelper:'{{if options.helper}}<h3 class="{{if options.helperClass}}${options.helperClass}{{/if}}">${options.helper}</h3>{{/if}}',fieldSetItemsContainer:'<div data-role="controlgroup">{{html this.html}}</div>',fieldSet:'{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetOuterEl",true)}}{{html Alpaca.fieldTemplate(this,"fieldSetLegend")}}{{html Alpaca.fieldTemplate(this,"fieldSetHelper")}}{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetItemsContainer",true)}}{{/wrap}}{{/wrap}}',fieldSetItemContainer:"<div></div>"},messages:{required:"Required Field",invalid:"Invalid Field"},render:function(C,D){if(C.container.attr("id").indexOf("-mobile-page")==-1){B('<div data-role="page" data-header="'+C.container.attr("data-header")+'" data-theme="'+C.container.attr("data-theme")+'" id="'+C.id+'-mobile-page"><div data-role="header" data-theme="'+C.container.attr("data-theme")+'"><h1>'+C.container.attr("data-header")+"</h1></div></div>").hide().appendTo(C.container);C.container=B("#"+C.id+"-mobile-page",C.container)}else{}C.render(D)},postRender:function(C){C.container.page().show();C.container.find(".ui-select").find('[role="button"]').addClass("ui-corner-all");B(".ui-collapsible-heading",C.container).css("margin","0")}});A.registerView({id:"VIEW::MOBILE_EDIT",parent:"VIEW::WEB_EDIT",title:"Mobile Edit View",description:"Mobile edit view using JQuery Mobile Library",type:"edit",platform:"mobile",legendStyle:"link",toolbarStyle:"link",buttonType:"link",templates:{controlFieldOuterEl:'<div data-role="fieldcontain">{{html this.html}}</div>',controlFieldMessage:"<div>* ${message}</div>",controlFieldLabel:'{{if options.label}}<label for="${id}" class="{{if options.labelClass}}${options.labelClass}{{/if}}">${options.label}</label>{{/if}}',controlFieldHelper:'{{if options.helper}}<div class="{{if options.helperClass}}${options.helperClass}{{/if}}">${options.helper}</div>{{/if}}',controlFieldContainer:'<div data-replace="true">{{html this.html}}</div>',controlField:'{{wrap(null, {}) Alpaca.fieldTemplate(this,"controlFieldOuterEl",true)}}{{html Alpaca.fieldTemplate(this,"controlFieldLabel")}}{{wrap(null, {}) Alpaca.fieldTemplate(this,"controlFieldContainer",true)}}{{/wrap}}{{html Alpaca.fieldTemplate(this,"controlFieldHelper")}}{{/wrap}}',fieldSetOuterEl:'<fieldset data-role="collapsible" id="${id}">{{html this.html}}</fieldset>',fieldSetMessage:"<div>* ${message}</div>",fieldSetLegend:'{{if options.label}}<legend for="${id}" class="{{if options.labelClass}}${options.labelClass}{{/if}}">${options.label}</legend>{{/if}}',fieldSetHelper:'{{if options.helper}}<h3 class="{{if options.helperClass}}${options.helperClass}{{/if}}">${options.helper}</h3>{{/if}}',fieldSetItemsContainer:'<div data-role="controlgroup">{{html this.html}}</div>',fieldSet:'{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetOuterEl",true)}}{{html Alpaca.fieldTemplate(this,"fieldSetLegend")}}{{html Alpaca.fieldTemplate(this,"fieldSetHelper")}}{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetItemsContainer",true)}}{{/wrap}}{{/wrap}}',fieldSetItemContainer:"<div></div>",formFieldsContainer:'<div data-role="content">{{html this.html}}</div>',formButtonsContainer:'<fieldset class="ui-grid-a">{{html this.html}}</fieldset>',form:'<form>{{html Alpaca.fieldTemplate(this,"formFieldsContainer")}}{{html Alpaca.fieldTemplate(this,"formButtonsContainer")}}</form>',controlFieldRadio:'<fieldset data-role="controlgroup" id="${id}">{{each selectOptions}}<input type="radio" {{if options.readonly}}readonly="readonly"{{/if}} name="${formName}" id="${id}-${$index}}" value="${value}" {{if value == data}}checked="checked"{{/if}}/><label for="${id}-${$index}}">${text}</label>{{/each}}</fieldset>',controlFieldCheckbox:'<fieldset data-role="controlgroup" id="${id}-0"><input type="checkbox" id="${id}-1" name="${id}-1" {{if options.readonly}}readonly="readonly"{{/if}} {{if options.name}}name="${options.name}"{{/if}} {{each options.data}}data-${fieldId}="${value}"{{/each}}/>{{if options.rightLabel}}<label for="${id}-1">${options.rightLabel}</label>{{else}}{{if options.label}}<label for="${id}-1">${options.label}?</label>{{/if}}{{/if}}</fieldset>',arrayItemToolbar:'<div class="alpaca-fieldset-array-item-toolbar" data-role="controlgroup" data-type="horizontal"><span class="alpaca-fieldset-array-item-toolbar-add" data-role="button" data-icon="add" data-iconpos="notext">Add</span><span class="alpaca-fieldset-array-item-toolbar-remove" data-role="button" data-icon="delete" data-iconpos="notext">Delete</span><span class="alpaca-fieldset-array-item-toolbar-up" data-role="button" data-icon="arrow-u" data-iconpos="notext">Up</span><span class="alpaca-fieldset-array-item-toolbar-down" data-role="button" data-icon="arrow-d" data-iconpos="notext">Down</span></div>',arrayToolbar:'<div class="alpaca-fieldset-array-toolbar" data-role="controlgroup"><span class="alpaca-fieldset-array-toolbar-icon alpaca-fieldset-array-toolbar-add" data-role="button" data-icon="add" data-inline="true" title="Add">Add</span></div>'},messages:{required:"Required Field",invalid:"Invalid Field"},render:function(C,D){if(C.container.attr("id").indexOf("-mobile-page")==-1){B('<div data-role="page" data-header="'+C.container.attr("data-header")+'" data-theme="'+C.container.attr("data-theme")+'" id="'+C.id+'-mobile-page"><div data-role="header" data-theme="'+C.container.attr("data-theme")+'"><h1>'+C.container.attr("data-header")+"</h1></div></div>").hide().appendTo(C.container);C.container=B("#"+C.id+"-mobile-page",C.container)}else{}C.render(D)},postRender:function(C){C.container.page().show();C.container.find(".ui-select").find('[role="button"]').addClass("ui-corner-all");B(".ui-collapsible-heading",C.container).css("margin","0")}})})(jQuery);(function(B){var A=B.alpaca;A.registerView({id:"VIEW::WEB_EDIT",templates:{twoColumnLayout:'<div class="alpaca-layout-two-column-mask">{{if options.label}}<h3>${options.label}</h3>{{/if}}{{if options.helper}}<h4>${options.helper}</h4>{{/if}}<div class="alpaca-layout-two-column-left alpaca-layout-region"  id="leftcolumn"></div><div class="alpaca-layout-two-column-right alpaca-layout-region" id="rightcolumn"></div></div>'}});A.registerView({id:"VIEW::WEB_EDIT_LAYOUT_TWO_COLUMN",parent:"VIEW::WEB_EDIT",title:"Web Edit View with Two-Column Layout",description:"Web edit default view with two-column layout.",layout:{template:"twoColumnLayout"}});A.registerView({id:"VIEW::WEB_EDIT_LIST_LAYOUT_TWO_COLUMN",parent:"VIEW::WEB_EDIT_LIST",title:"Web List Edit View with Two-Column Layout",description:"Web edit list view with two-column layout.",layout:{template:"twoColumnLayout"}})})(jQuery);(function(B){var A=B.alpaca;A.View=Base.extend({constructor:function(C,D){this.field=D;this.setView(C)},setView:function(C){this.viewObject=A.isObject(C)?C:A.getView(C);if(A.isObject(C)&&A.isEmpty(this.viewObject.parent)&&A.isEmpty(this.viewObject.id)){this.viewObject.parent=A.defaultView;if(this.getGlobalTemplate()){this.viewObject.parent="VIEW::WEB_DISPLAY"}}this.id=this.viewObject.id;this.parent=this.viewObject.parent;this.type=this.getViewParam("type");this.displayReadonly=this.getViewParam("displayReadonly");this.platform=this.getViewParam("platform");this.device=this.getViewParam("device");this.render=this.getViewParam("render");this.postRender=this.getViewParam("postRender");this.collapsible=this.getViewParam("collapsible");this.legendStyle=this.getViewParam("legendStyle");this.toolbarStyle=this.getViewParam("toolbarStyle");this.buttonStyle=this.getViewParam("buttonStyle")},getWizard:function(){return this.getViewParam("wizard")},getGlobalTemplate:function(){var D=this.getViewParam("globalTemplate");var C=this.getTemplate(D);if(!A.isEmpty(C)){D=C}return D},getLayout:function(){var D=this.getViewParam(["layout","template"],true);var C=this.getTemplate(D);if(!A.isEmpty(C)){D=C}return{template:D,bindings:this.getViewParam(["layout","bindings"],true)}},getStyles:function(){var C=[];var E=this.viewObject;while(E){C.push(E);E=A.views[E.parent]}var F={};for(var D=C.length-1;D>=0;D--){if(C[D].styles){A.mergeObject(F,C[D].styles)}if(this.field.path&&C[D].fields&&C[D].fields[this.field.path]&&C[D].fields[this.field.path].styles){A.mergeObject(F,C[D].fields[this.field.path].styles)}}return F},getTemplate:function(D){var C=this.getViewParam(["templates",D]);if(B(C)[0]&&B(C)[0].tagName.toLowerCase()=="script"&&B(C).attr("type")=="text/x-jquery-tmpl"){C=B(C).html()}return C},getMessage:function(C){var D=this.getViewParam(["messages",A.defaultLocale,C]);return A.isEmpty(D)?this.getViewParam(["messages",C]):D},getViewParam:function(F,D){var C=this.field.path;if(this.viewObject.fields&&this.viewObject.fields[C]){var E=this._getConfigVal(this.viewObject.fields[C],F);if(!A.isEmpty(E)){return E}}if(C&&C.indexOf("[")!=-1&&C.indexOf("]")!=-1){C=C.replace(/\[\d+\]/g,"[*]");if(this.viewObject.fields&&this.viewObject.fields[C]){var E=this._getConfigVal(this.viewObject.fields[C],F);if(!A.isEmpty(E)){return E}}}if(!A.isEmpty(D)&&D&&this.field.path!="/"){return null}return this._getViewParam(this.viewObject,F)},_getViewParam:function(C,E){var D=this._getConfigVal(C,E);if(C&&!A.isEmpty(D)){return D}else{if(C&&C.parent){return this._getViewParam(A.views[C.parent],E)}else{return null}}},_getConfigVal:function(D,E){if(A.isArray(E)){for(var C=0;C<E.length&&!A.isEmpty(D);C++){D=D[E[C]]}}else{D=D[E]}return D}})})(jQuery);(function(B){var A=B.alpaca;A.Field=Base.extend({constructor:function(E,I,G,H,D,C,F){this.initializing=true;this.container=E;this.parent=null;this.data=I;this.options=G;this.schema=H;this.connector=C;this.errorCallback=F;this.singleLevelRendering=false;this.view=new A.View(D,this);if(!this.options){this.options={}}this.id=this.options.id;this.type=this.options.type;if(!this.id){this.id=A.generateId()}if(!this.schema){this.schema={}}if(!this.options.label&&this.schema.title){this.options.label=this.schema.title}if(!this.options.helper&&this.schema.description){this.options.helper=this.schema.description}if(A.isEmpty(this.options.readonly)&&!A.isEmpty(this.schema.readonly)){this.options.readonly=this.schema.readonly}if(A.isValEmpty(this.data)&&!A.isEmpty(this.schema["default"])){this.data=this.schema["default"]}this.path="/";this.validation={};this.backupData=A.cloneObject(this.data)},getDefaultFieldTemplateId:function(){return"controlField"},setDefaultTemplate:function(){var D=this.view.getGlobalTemplate();var C=this.view.getLayout().template;if(D){this.setTemplate(D);this.singleLevelRendering=true}else{if(C){this.setTemplate(C)}else{this.setTemplate(this.view.getTemplate(this.getDefaultFieldTemplateId()))}}},setup:function(){if(!this.initializing){this.data=this.getValue()}this.setDefaultTemplate();if(A.isUndefined(this.schema.required)){this.schema.required=false}if(A.isUndefined(this.options.validate)){this.options.validate=true}if(A.isUndefined(this.options.disabled)){this.options.disabled=false}if(A.isUndefined(this.options.showMessages)){this.options.showMessages=true}},bindData:function(){if(!A.isEmpty(this.data)){this.setValue(this.data)}},render:function(C,D){if(C&&(A.isString(C)||A.isObject(C))){this.view.setView(C)}else{if(A.isEmpty(D)&&A.isFunction(C)){D=C}}this.setup();this._render(D)},_render:function(E){var D=this;if(this.getEl()){this.getEl().remove()}if(this.options.renderForm){this.options.form.viewType=this.view.type;var C=this.form;if(!C){C=new A.Form(this.container,this.options.form,this.view.viewObject,this.connector,this.errorCallback)}C.render(function(F){D._processRender(F.formFieldsContainer,function(){D.getEl().appendTo(F.formFieldsContainer);F.topControl=D;if(D.view.type&&D.view.type!="view"){F.initEvents()}D.form=F;D.postRender();if(E&&A.isFunction(E)){E(D)}})})}else{this._processRender(this.container,function(){D.getEl().appendTo(D.container);D.postRender();if(E&&A.isFunction(E)){E(D)}})}},_processRender:function(D,E){var F=this;var C=this.getTemplate();this.connector.loadTemplate(C,function(H){var G=H;if(B(G)[0]&&B(G)[0].tagName.toLowerCase()=="script"&&B(G).attr("type")=="text/x-jquery-tmpl"){H=B(G).html()}F._renderLoadedTemplate(D,H,E)},function(G){F.errorCallback(G)})},_renderLoadedTemplate:function(C,E,F){var D=B.tmpl(E,{id:this.getId(),options:this.options,schema:this.schema,data:this.data,view:this.view.viewObject,path:this.path},{});D.appendTo(C);this.setEl(D);if(!this.singleLevelRendering){this.renderField(F)}else{if(F){F(this)}}},renderField:function(C){},postRender:function(){if(this.view.type!="view"){this.getEl().addClass("ui-widget alpaca-field");if(this.getEl().attr("id")==null){this.getEl().attr("id",this.getId()+"-field-outer")}if(this.getEl().attr("alpaca-field-id")==null){this.getEl().attr("alpaca-field-id",this.getId())}if(this.schema.required){this.getEl().addClass("alpaca-field-required")}else{this.getEl().addClass("alpaca-field-optional")}if(this.options.readonly){this.getEl().addClass("alpaca-field-readonly");B(":input",this.getEl()).attr("readonly","readonly");B("select",this.getEl()).attr("disabled","disabled");B(":radio",this.getEl()).attr("disabled","disabled");B(":checkbox",this.getEl()).attr("disabled","disabled")}if(this.options.hidden){this.getEl().hide()}var E=this.options.fieldClass;if(E){this.getEl().addClass(E)}var D=this.view.getStyles();if(D){for(var C in D){B(C,this.container).css(D[C])}}if(this.labelDiv&&this.schema.required){B('<span class="ui-icon ui-icon-star"></span>').prependTo(this.labelDiv)}if(this.options.disabled){this.disable()}if(this.view.type&&this.view.type=="edit"){this.bindData()}if(this.view.type&&this.view.type!="view"){this.initEvents()}}this.initializing=false;this.hideInitValidationError=A.isValEmpty(this.options.hideInitValidationError)?false:this.options.hideInitValidationError;if(this.view.type!="view"){this.renderValidationState()}this.hideInitValidationError=false;if(!this.view.displayReadonly){B(".alpaca-field-readonly",this.getEl()).hide()}if(this.options.postRender){this.options.postRender(this)}},getEl:function(){return this.outerEl},setEl:function(C){this.outerEl=C},getId:function(){return this.id},getParent:function(){return this.parent},isTopLevel:function(){return A.isEmpty(this.parent)},getValue:function(){return this.data},setValue:function(C){this.data=C},setDefault:function(){},getTemplate:function(){return this.template},setTemplate:function(C){if(A.isFunction(C)){C=C()}C=B.trim(C);this.template=C},displayMessage:function(D,C){var E=this;if(C==false){B("#[id^='"+E.getId()+"-field-message']",E.getEl()).remove()}if(D&&D.length>0){B.each(D,function(F,G){if(G.length>0){var H=E.view.getTemplate("controlFieldMessage");if(H){E.messageElement=B.tmpl(H,{message:G});if(E.hideInitValidationError){E.messageElement.addClass("ui-state-error-text alpaca-controlfield-message-hidden")}else{E.messageElement.addClass("ui-state-error-text alpaca-controlfield-message")}E.messageElement.attr("id",E.getId()+"-field-message-"+F);if(B(".alpaca-controlfield-message-container",E.getEl()).length){E.messageElement.appendTo(B(".alpaca-controlfield-message-container",E.getEl()))}else{E.messageElement.appendTo(E.getEl())}}}})}},renderValidationState:function(){if(this.options.validate){this.getEl().removeClass("alpaca-field-invalid ui-state-error alpaca-field-invalid-hidden");this.getEl().removeClass("alpaca-field-valid");var C=this.isValid();if(this.validate()){this.getEl().addClass("alpaca-field-valid")}else{if(!this.hideInitValidationError){this.getEl().addClass("ui-state-error alpaca-field-invalid")}else{this.getEl().addClass("alpaca-field-invalid-hidden")}}var G=this.isValid();if(this.options.showMessages&&!this.hideInitValidationError){if(!this.initializing){var F=[];for(var D in this.validation){if(!this.validation[D]["status"]){F.push(this.validation[D]["message"])}}this.displayMessage(F,C)}}var H=false;var E=this.parent;while(E){if(E.options&&E.options.forceRevalidation){H=true}E=E.parent}if((C!=G&&this.parent&&this.parent.renderValidationState)||H){this.parent.renderValidationState()}this._validateCustomValidator()}},showHiddenMessages:function(){B(".alpaca-field-invalid-hidden",this.outerEl).removeClass("alpaca-field-invalid-hidden").addClass("ui-state-error alpaca-field-invalid");B(".alpaca-controlfield-message-hidden",this.outerEl).removeClass("alpaca-controlfield-message-hidden").addClass("alpaca-controlfield-message")},updateValidationState:function(G,D){if(this.options.validate){var C=this.isValid();this.validation[G]=D;if(D&&!D.status){this.getEl().removeClass("alpaca-field-valid");this.getEl().addClass("ui-state-error alpaca-field-invalid")}this.validation[G]=D;if(this.options.showMessages){if(!this.initializing){var F=[];for(var E in this.validation){if(!this.validation[E]["status"]){F.push(this.validation[E]["message"])}}this.displayMessage(F,C)}}if(this.isValid()&&this.parent&&this.parent.renderValidationState){this.parent.renderValidationState()}}},validate:function(){var C=true;if(!this.initializing&&this.options.validate){C=this.handleValidate()}return C},handleValidate:function(){var D=this.validation;var C=this._validateOptional();D.notOptional={message:C?"":this.view.getMessage("notOptional"),status:C};C=this._validateDisallow();D.disallowValue={message:C?"":A.substituteTokens(this.view.getMessage("disallowValue"),[this.schema.disallow.join(",")]),status:C};return D.notOptional["status"]&&D.disallowValue["status"]},_validateCustomValidator:function(){var C=this;if(this.options.validator&&A.isFunction(this.options.validator)){this.options.validator(this,function(D){C.updateValidationState("customValidator",D)})}},_validateOptional:function(){if(this.schema.required&&this.isEmpty()){return false}return true},_validateDisallow:function(){if(!A.isValEmpty(this.schema.disallow)){var E=this.getValue();var D=this.schema.disallow;if(A.isArray(D)){var C=true;B.each(D,function(F,G){if((A.isObject(E)||A.isArray(E))&&A.isString(G)){G=B.parseJSON(G)}if(A.compareObject(E,G)){C=false}});return C}else{if((A.isObject(E)||A.isArray(E))&&A.isString(D)){D=B.parseJSON(D)}return !A.compareObject(E,D)}}return true},triggerUpdate:function(){this.getEl().trigger("fieldupdate")},disable:function(){},enable:function(){},focus:function(){},destroy:function(){this.getEl().remove()},show:function(){if(this.options&&this.options.hidden){return }else{this.getEl().css({display:""})}},hide:function(){this.getEl().css({display:"none"})},print:function(){if(this.container.printArea){this.container.printArea()}},reload:function(){this.initializing=true;if(this.callback!=null){this.callback(this,this.renderedCallback)}else{this.render(this.renderedCallback)}},clear:function(){var C=null;if(this.data){C=this.data}this.setValue(C)},isEmpty:function(){return A.isValEmpty(this.getValue())},isValid:function(C){if(B.isEmptyObject(this.validation)){return true}else{for(var E in this.validation){if(!this.validation[E].status){return false}}if(this.children&&C){for(var D=0;D<this.children.length;D++){var F=this.children[D];if(!F.isValid(C)){return false}}}return true}},initEvents:function(){var C=this;this.field.change(function(D){C.onChange(D)});this.field.focus(function(D){C.onFocus(D)});this.field.blur(function(D){C.onBlur(D)})},onFocus:function(C){this.getEl().removeClass("alpaca-field-empty");this.getEl().addClass("alpaca-field-focused")},onBlur:function(C){this.getEl().removeClass("alpaca-field-focused");this.renderValidationState()},onChange:function(C){this.data=this.getValue();this.triggerUpdate()},getControlByPath:function(F){var D=this;if(F){var E=F.split("/");for(var C=0;C<E.length;C++){if(!A.isValEmpty(E[C])){if(D&&D.childrenByPropertyId){if(D.childrenByPropertyId[E[C]]){D=D.childrenByPropertyId[E[C]]}else{return null}}else{return null}}else{return null}}return D}},getFieldType:function(){},getType:function(){},isContainer:function(){return false},getTitle:function(){},getDescription:function(){},getSchemaOfSchema:function(){var C={title:this.getTitle(),description:this.getDescription(),type:"object",properties:{title:{title:"Title",description:"Property short description",type:"string"},description:{title:"Description",description:"Property detailed description",type:"string"},readonly:{title:"Readonly",description:"Property will be read only if true",type:"boolean","default":false},required:{title:"Required",description:"Property value must be set if true",type:"boolean","default":false},"default":{title:"Default",description:"Property default value",type:"any"},type:{title:"Type",description:"Property data type",type:"string",readonly:true},format:{title:"Format",description:"Property data format",type:"string"},disallow:{title:"Disallow",description:"Disallowed values for the property",type:"array"},dependencies:{title:"Dependencies",description:"Property Dependencies",type:"array"}}};if(this.getType&&!A.isValEmpty(this.getType())){C.properties.type["default"]=this.getType();C.properties.type["enum"]=[this.getType()]}return C},getOptionsForSchema:function(){return{fields:{title:{helper:"Field short description",type:"text"},description:{helper:"Field detailed description",type:"textarea"},readonly:{helper:"Field will be read only if checked",rightLabel:"Is this field read only ?",type:"checkbox"},required:{helper:"Field value must be set if checked",rightLabel:"Is this field required ?",type:"checkbox"},"default":{helper:"Field default value",type:"textarea"},type:{helper:"Field data type",type:"text"},format:{type:"select",dataSource:function(D,E){for(var C in A.defaultFormatFieldMapping){D.selectOptions.push({value:C,text:C})}if(E){E()}}},disallow:{helper:"Disallowed values for the field",itemLabel:"Value",type:"array"},dependencies:{helper:"Field Dependencies",multiple:true,size:3,type:"select",dataSource:function(D,E){if(D.parent&&D.parent.schemaParent&&D.parent.schemaParent.parent){for(var C in D.parent.schemaParent.parent.childrenByPropertyId){if(C!=D.parent.schemaParent.propertyId){D.selectOptions.push({value:C,text:C})}}}if(E){E()}}}}}},getSchemaOfOptions:function(){var C={title:"Options for "+this.getTitle(),description:this.getDescription()+" (Options)",type:"object",properties:{renderForm:{},form:{},id:{title:"Field Id",description:"Unique field id. Auto-generated if not provided.",type:"string"},type:{title:"Field Type",description:"Field type",type:"string","default":this.getFieldType(),readonly:true},validate:{title:"Validation",description:"Field validation is required if true",type:"boolean","default":true},showMessages:{title:"Show Messages",description:"Display validation messages if true",type:"boolean","default":true},disabled:{title:"Disabled",description:"Field disabled if true",type:"boolean","default":false},readonly:{title:"Readonly",description:"Field will be read only if true",type:"boolean","default":false},hidden:{title:"Hidden",description:"Field will be read only if true",type:"boolean","default":false},label:{title:"Label",description:"Field label",type:"string"},helper:{title:"Helper",description:"Field help message",type:"string"},fieldClass:{title:"Style Class",description:"Additional field style class",type:"string"},hideInitValidationError:{title:"Hide Initial Validation Errors",description:"Hide initial validation errors.",type:"boolean"}}};if(this.isTopLevel()){C.properties.renderForm={title:"Render Form",description:"Render form tag as container for rest of fields.",type:"boolean","default":false};C.properties.form={title:"Form",description:"Options for form",type:"object",dependencies:"renderForm",properties:{attributes:{title:"Form Attributes",description:"Form attributes",type:"object",properties:{id:{title:"Id",description:"Unique form id. Auto-generated if not provided.",type:"string"},action:{title:"Action",description:"Form submission endpoint",type:"string"},method:{title:"Method",description:"Form submission method","enum":["post","get"],type:"string"},name:{title:"Name",description:"Form name",type:"string"}}},buttons:{title:"Button Options",description:"Button options",type:"object",properties:{submit:{title:"Submit Button",description:"Render submit button.",type:"boolean","default":true},reset:{title:"Reset Button",description:"Render reset button.",type:"boolean","default":true},save:{title:"Save Button",description:"Render save button.",type:"boolean"},reload:{title:"Reload Button",description:"Render reload button.",type:"boolean"},print:{title:"Print Button",description:"Render print button.",type:"boolean"},switchView:{title:"View Switch Button",description:"Render view switch button.",type:"boolean"}}}}}}else{delete C.properties.renderForm;delete C.properties.form}return C},getOptionsForOptions:function(){var C={type:"object",fields:{id:{type:"text",readonly:true},type:{type:"text"},validate:{rightLabel:"Is validation enforced ?",type:"checkbox"},showMessages:{rightLabel:"Show validation messages ?",type:"checkbox"},disabled:{rightLabel:"Disable this field ?",type:"checkbox"},label:{type:"text"},helper:{type:"textarea"},fieldClass:{type:"text"},hideInitValidationError:{rightLabel:"Hide initial validation errors ?",type:"checkbox"}}};if(this.isTopLevel()){C.fields.renderForm={type:"checkbox",rightLabel:"Yes"};C.fields.form={type:"object",dependencies:{renderForm:true},fields:{attributes:{type:"object",fields:{id:{type:"text",readonly:true},action:{type:"text"},method:{type:"select"},name:{type:"text"}}},buttons:{type:"object",fields:{submit:{rightLabel:"Yes",type:"checkbox"},reset:{rightLabel:"Yes",type:"checkbox"},save:{rightLabel:"Yes",type:"checkbox"},reload:{rightLabel:"Yes",type:"checkbox"},print:{rightLabel:"Yes",type:"checkbox"},viewSwitch:{rightLabel:"Yes",type:"checkbox"}}}}}}return C}});A.registerMessages({disallowValue:"{0} are disallowed values.",notOptional:"This field is not optional."})})(jQuery);(function(B){var A=B.alpaca;A.ControlField=A.Field.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setDefault:function(){var C=A.isEmpty(this.schema["default"])?"":this.schema["default"];this.setValue(C)},renderField:function(C){},injectField:function(E){var D=B(".alpaca-controlfield-container",this.outerEl);if(D.length){this.fieldContainer=D}else{this.fieldContainer=this.outerEl}var C=B(".alpaca-field-container-field",this.fieldContainer);if(C.length>0){if(C.attr("data-replace")=="true"){C.replaceWith(E)}else{E.appendTo(C)}}else{if(this.fieldContainer.attr("data-replace")=="true"){this.fieldContainer.replaceWith(E)}else{E.prependTo(this.fieldContainer)}}},postRender:function(){var D=B(".alpaca-controlfield-label",this.outerEl);if(D.length){this.labelDiv=D}var C=B(".alpaca-controlfield-helper",this.outerEl);if(C.length){this.helperDiv=C}this.base();this.outerEl.addClass("alpaca-controlfield")},_validateEnum:function(){if(this.schema["enum"]){var C=this.data;if(!this.schema.required&&A.isValEmpty(C)){return true}if(B.inArray(C,this.schema["enum"])>-1){return true}else{return false}}else{return true}},handleValidate:function(){var E=this.base();var D=this.validation;var C=this._validateEnum();D.invalidValueOfEnum={message:C?"":A.substituteTokens(this.view.getMessage("invalidValueOfEnum"),[this.schema["enum"].join(",")]),status:C};return E&&D.invalidValueOfEnum["status"]},initEvents:function(){this.base();var C=this;this.field.keypress(function(D){C.onKeyPress(D)});this.field.keyup(function(D){C.onKeyUp(D)});this.field.click(function(D){C.onClick(D)})},onKeyPress:function(C){},onKeyUp:function(C){},onClick:function(C){},getSchemaOfSchema:function(){return A.merge(this.base(),{properties:{"enum":{title:"Enumeration",description:"List of property value options",type:"array"}}})},getOptionsForSchema:function(){return A.merge(this.base(),{fields:{"enum":{itemLabel:"Value",type:"array"}}})},getSchemaOfOptions:function(){return A.merge(this.base(),{properties:{name:{title:"Field name",description:"Field name",type:"string"}}})},getOptionsForOptions:function(){return A.merge(this.base(),{fields:{name:{type:"text"}}})}});A.registerMessages({invalidValueOfEnum:"This field should have one of the values in {0}."})})(jQuery);(function(B){var A=B.alpaca;A.ContainerField=A.Field.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();var C=true;if(!A.isEmpty(this.view.collapsible)){C=this.view.collapsible}if(!A.isEmpty(this.options.collapsible)){C=this.options.collapsible}this.options.collapsible=C;var D="button";if(!A.isEmpty(this.view.legendStyle)){D=this.view.legendStyle}this.options.legendStyle=D;this.lazyLoading=false;if(!A.isEmpty(this.options.lazyLoading)){this.lazyLoading=this.options.lazyLoading}this.children=[];this.childrenById=[];this.childrenByPropertyId=[]},getDefaultFieldTemplateId:function(){return"fieldSet"},setDefaultTemplate:function(){this.base()},addChild:function(D,C){if(!A.isEmpty(C)){this.children.splice(C,0,D)}else{this.children.push(D)}this.childrenById[D.getId()]=D;if(D.propertyId){this.childrenByPropertyId[D.propertyId]=D}D.parent=this},initEvents:function(){var D=this;if(this.labelDiv){if(this.options.collapsible){this.labelDiv.addClass("legend-expanded");this.fieldSetDiv.addClass("fieldset-expanded");var C="ui-icon-circle-arrow-s";if(!A.isEmpty(this.options.collapsed)&&this.options.collapsed){C="ui-icon-circle-arrow-e";this.labelDiv.nextAll(".alpaca-fieldset-helper").slideToggle(500);this.labelDiv.nextAll(".alpaca-fieldset-items-container").slideToggle(500);this.labelDiv.nextAll(".alpaca-fieldset-array-toolbar").slideToggle(500);this.fieldSetDiv.toggleClass("fieldset-expanded");this.fieldSetDiv.toggleClass("fieldset-collapsed");this.labelDiv.toggleClass("legend-expanded");this.labelDiv.toggleClass("legend-collapsed")}if(this.options.legendStyle=="link"){B('<span class="ui-icon '+C+'" style="float:left;margin-right:0.3em;"></span>').prependTo(this.labelDiv);this.labelDiv.click(function(){D.fieldSetDiv.toggleClass("fieldset-collapsed");D.fieldSetDiv.toggleClass("fieldset-expanded");B(this).toggleClass("legend-collapsed");B(this).toggleClass("legend-expanded");B(".ui-icon",this).toggleClass("ui-icon-circle-arrow-e").toggleClass("ui-icon-circle-arrow-s");B(this).nextAll(".alpaca-fieldset-helper").slideToggle(500);B(this).nextAll(".alpaca-fieldset-items-container").slideToggle(500);B(this).nextAll(".alpaca-fieldset-array-toolbar").slideToggle(500)})}if(this.options.legendStyle=="button"){this.labelDiv.button({icons:{primary:C}}).click(function(){D.fieldSetDiv.toggleClass("fieldset-collapsed");D.fieldSetDiv.toggleClass("fieldset-expanded");B(this).toggleClass("legend-collapsed");B(this).toggleClass("legend-expanded");B(".ui-icon",this).toggleClass("ui-icon-circle-arrow-e").toggleClass("ui-icon-circle-arrow-s");B(this).nextAll(".alpaca-fieldset-helper").slideToggle(500);B(this).nextAll(".alpaca-fieldset-items-container").slideToggle(500);B(this).nextAll(".alpaca-fieldset-array-toolbar").slideToggle(500)})}}}},clear:function(C){A.each(this.children,function(){this.clear(false)});if(!C){this.triggerUpdate()}},setDefault:function(){if(A.isEmpty(this.schema["default"])){A.each(this.children,function(){this.setDefault()})}else{this.setValue(this.schema["default"])}},destroy:function(){A.each(this.children,function(){this.destroy()});this.base()},renderItemContainer:function(G,F,I){var E=this.view.getTemplate("fieldSetItemContainer");if(E){var C=B.tmpl(E,{});if(C.attr("data-replace")=="true"){return this.fieldContainer}else{if(G){B("#"+G+"-item-container",this.outerEl).after(C)}else{var D=this.fieldContainer;var J=this.view.getLayout().bindings;if(J){var H=J[I];if(H&&B("#"+H,D).length>0){D=B("#"+H,D)}}C.appendTo(D)}}return C}else{return this.fieldContainer}},renderField:function(F){var G=this;this.outerEl.addClass("ui-widget-content");var D=B(".alpaca-fieldset-legend",this.outerEl);if(D.length){this.labelDiv=D}var C=B(".alpaca-fieldset",this.outerEl);if(C.length){this.fieldSetDiv=C}else{this.fieldSetDiv=this.outerEl}var E=B(".alpaca-fieldset-items-container",this.outerEl);if(E.length){this.fieldContainer=E}else{this.fieldContainer=this.outerEl}if(!this.singleLevelRendering&&!this.lazyLoading){this.renderItems()}if(this.lazyLoading){if(this.labelDiv){B(this.labelDiv).click(function(){if(G.lazyLoading){G.renderItems();G.lazyLoading=false}})}}if(F){F()}},renderItems:function(C){},isContainer:function(){return true},getSchemaOfOptions:function(){return A.merge(this.base(),{properties:{collapsible:{title:"Collapsible",description:"Field set is collapsible if true",type:"boolean","default":true},collapsed:{title:"Collapsed",description:"Field set is initially collapsibled if true",type:"boolean","default":false},legendStyle:{title:"Legend Style",description:"Field set legend style",type:"string","enum":["button","link"],"default":"button"}}})},getOptionsForOptions:function(){return A.merge(this.base(),{fields:{collapsible:{rightLabel:"Field set collapsible ?",helper:"Field set is collapsible if checked",type:"checkbox"},collapsed:{rightLabel:"Field set initially collapsed ?",description:"Field set is initially collapsed if checked",type:"checkbox"},legendStyle:{type:"select"}}})}})})(jQuery);(function(B){var A=B.alpaca;A.Form=Base.extend({constructor:function(E,G,D,C,F){var H=this;this.container=E;this.parent=null;this.connector=C;this.errorCallback=F;this.options=G;if(this.options.attributes){this.attributes=this.options.attributes}else{this.attributes={}}if(this.attributes.id){this.id=this.attributes.id}else{this.id=A.generateId();this.attributes.id=this.id}this.viewType=G.viewType;if(this.options.buttons){this.buttonOptions=this.options.buttons}else{this.buttonOptions={}}if(A.isEmpty(this.buttonOptions.submit)){this.buttonOptions.submit=true}if(A.isEmpty(this.buttonOptions.reset)){this.buttonOptions.reset=true}this.view=new A.View(D,this);this.buttons=[]},render:function(C){var D=this;this.template=this.view.getTemplate("form");if(this.outerEl){this.outerEl.remove()}this.processRender(this.container,function(){D.outerEl.appendTo(D.container);D.outerEl.addClass("alpaca-form");D.addButtons();if(C){C(D)}})},processRender:function(D,E){var F=this;var C=this.getTemplate();this.connector.loadTemplate(C,function(G){F._renderLoadedTemplate(D,G,E)},function(G){alert(G)});if(E){E()}},_renderLoadedTemplate:function(D,F,G){var C={id:this.getId(),options:this.options,view:this.view.viewObject};var E=B.tmpl(F,C,{});E.appendTo(D);this.outerEl=E;if(A.isEmpty(this.outerEl.attr("id"))){this.outerEl.attr("id",this.getId()+"-form-outer")}if(A.isEmpty(this.outerEl.attr("alpaca-field-id"))){this.outerEl.attr("alpaca-field-id",this.getId())}if(B(".alpaca-form-fields-container",this.outerEl)){this.formFieldsContainer=B(".alpaca-form-fields-container",this.outerEl)}else{this.formFieldsContainer=this.outerEl}this.field=B("form",this.container);if(this.field){this.field.attr(this.attributes)}},addButton:function(D){var F=this;if(D){var C=D.options?D.options:{};C.form=this;var E=D.postRender;C.type=C.type?C.type:"button";this.formButtonsContainer.alpaca({data:D.data,options:C,postRender:function(G){F.buttons.push(G);if(E&&A.isFunction(E)){E(G)}}})}},addButtons:function(){var C=this;if(B(".alpaca-form-buttons-container",this.outerEl)){this.formButtonsContainer=B(".alpaca-form-buttons-container",this.outerEl)}else{this.formButtonsContainer=this.outerEl}if(this.buttonOptions.print){this.addButton({options:{type:"printbutton"},postRender:function(D){C.printButton=D}})}if(this.buttonOptions.switchView){this.addButton({options:{type:"switchviewbutton"},postRender:function(D){C.switchViewButton=D}})}if(this.buttonOptions.reload&&this.viewType!="view"){this.addButton({options:{type:"reloadbutton"},postRender:function(D){C.reloadButton=D}})}if(this.buttonOptions.save&&this.viewType!="view"){this.addButton({options:{type:"savebutton"},postRender:function(D){C.saveButton=D}})}if(this.buttonOptions.submit&&this.viewType!="view"){this.addButton({options:{type:"button",buttonType:"submit"},data:"Submit",postRender:function(D){C.submitButton=D}})}if(this.buttonOptions.reset&&this.viewType!="view"){this.addButton({options:{type:"button",buttonType:"reset"},data:"Reset",postRender:function(D){C.resetButton=D}})}this.formButtonsContainer.addClass("ui-widget-header ui-corner-all")},getEl:function(){return this.outerEl},getId:function(){return this.id},getType:function(){return this.type},getParent:function(){return this.parent},getValue:function(){return this.topControl.getValue()},setValue:function(C){this.topControl.setValue(C)},initEvents:function(){var D=this;if(this.field){var C=this.getValue();B(this.field).submit(C,function(E){return D.onSubmit(E)})}},onSubmit:function(C){if(this.submitHandler){return this.submitHandler(C)}},registerSubmitHandler:function(C){if(A.isFunction(C)){this.submitHandler=C}},renderValidationState:function(){this.topControl.renderValidationState()},disable:function(){this.topControl.disable()},enable:function(){this.topControl.enable()},focus:function(){this.topControl.focus()},destroy:function(){this.getEl().remove()},show:function(){this.getEl().css({display:""})},hide:function(){this.getEl().css({display:"none"})},clear:function(C){this.topControl.clear(C)},isEmpty:function(){return this.topControl.isEmpty()},getTemplate:function(){return this.template},setTemplate:function(C){if(A.isFunction(C)){C=C()}C=B.trim(C);this.template=C}})})(jQuery);(function(B){var A=B.alpaca;A.Fields.AnyField=A.ControlField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();this.controlFieldTemplate=this.view.getTemplate("controlFieldAny")},renderField:function(C){if(this.controlFieldTemplate){this.field=B.tmpl(this.controlFieldTemplate,{id:this.getId(),options:this.options});this.injectField(this.field)}if(C){C()}},postRender:function(){this.base()},getValue:function(){return this.field.val()},setValue:function(C){if(A.isEmpty(C)){this.field.val("")}else{this.field.val(C)}this.base(C)},handleValidate:function(){var C=this.base();return C},disable:function(){this.field.disabled=true},enable:function(){this.field.disabled=false},focus:function(){this.field.focus()},getSchemaOfSchema:function(){return A.merge(this.base(),{properties:{}})},getOptionsForSchema:function(){return A.merge(this.base(),{fields:{}})},getSchemaOfOptions:function(){return A.merge(this.base(),{properties:{}})},getOptionsForOptions:function(){return A.merge(this.base(),{fields:{}})},getTitle:function(){return"Any Field"},getDescription:function(){return"Any field."},getType:function(){return"any"},getFieldType:function(){return"any"}});A.registerTemplate("controlFieldAny",'<input type="text" id="${id}" size="40" {{if options.readonly}}readonly="readonly"{{/if}} {{if options.name}}name="${options.name}"{{/if}} {{each(i,v) options.data}}data-${i}="${v}"{{/each}}/>');A.registerFieldClass("any",A.Fields.AnyField);A.registerDefaultSchemaFieldMapping("any","any")})(jQuery);(function(B){var A=B.alpaca;A.Fields.TextField=A.ControlField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();if(!this.options.size){this.options.size=40}this.controlFieldTemplate=this.view.getTemplate("controlFieldText")},renderField:function(C){if(this.controlFieldTemplate){this.field=B.tmpl(this.controlFieldTemplate,{id:this.getId(),options:this.options});this.injectField(this.field)}if(C){C()}},postRender:function(){this.base();if(this.field&&this.options.mask&&this.options.maskString){this.field.mask(this.options.maskString)}if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-text")}},getValue:function(){return this.field.val()},setValue:function(C){if(A.isEmpty(C)){this.field.val("")}else{this.field.val(C)}this.base(C)},handleValidate:function(){var E=this.base();var D=this.validation;var C=this._validatePattern();D.invalidPattern={message:C?"":A.substituteTokens(this.view.getMessage("invalidPattern"),[this.schema.pattern]),status:C};C=this._validateMaxLength();D.stringTooLong={message:C?"":A.substituteTokens(this.view.getMessage("stringTooLong"),[this.schema.maxLength]),status:C};C=this._validateMinLength();D.stringTooShort={message:C?"":A.substituteTokens(this.view.getMessage("stringTooShort"),[this.schema.minLength]),status:C};return E&&D.invalidPattern["status"]&&D.stringTooLong["status"]&&D.stringTooShort["status"]},_validatePattern:function(){if(this.schema.pattern){var C=this.getValue();if(!A.isValEmpty(C)&&!C.match(this.schema.pattern)){return false}}return true},_validateMinLength:function(){if(!A.isEmpty(this.schema.minLength)){var C=this.getValue();if(!A.isEmpty(C)){if(C.length<this.schema.minLength){return false}}}return true},_validateMaxLength:function(){if(!A.isEmpty(this.schema.maxLength)){var C=this.getValue();if(!A.isEmpty(C)){if(C.length>this.schema.maxLength){return false}}}return true},disable:function(){this.field.disabled=true},enable:function(){this.field.disabled=false},focus:function(){this.field.focus()},getSchemaOfSchema:function(){return A.merge(this.base(),{properties:{minLength:{title:"Minimal Length",description:"Property value minimal length",type:"number"},maxLength:{title:"Maximum Length",description:"Property value maximum length",type:"number"},pattern:{title:"Pattern",description:"Property value pattern in regular expression",type:"string"}}})},getOptionsForSchema:function(){return A.merge(this.base(),{fields:{minLength:{type:"integer"},maxLength:{type:"integer"},pattern:{type:"text"}}})},getSchemaOfOptions:function(){return A.merge(this.base(),{properties:{size:{title:"Field Size",description:"Field size",type:"number","default":40},mask:{title:"Mask",description:"Enable field mask if true",type:"boolean"},maskString:{title:"Mask Expression",description:"Expression for field mask",type:"string"}}})},getOptionsForOptions:function(){return A.merge(this.base(),{fields:{size:{type:"integer"},mask:{helper:"Enable field mask if checked",rightLabel:"Enable field mask?",type:"checkbox"},maskString:{helper:"a - an alpha character;9 - a numeric character;* - an alphanumeric character",type:"text"}}})},getTitle:function(){return"Single-Line Text"},getDescription:function(){return"Text field for single-line text."},getType:function(){return"string"},getFieldType:function(){return"text"}});A.registerTemplate("controlFieldText",'<input type="text" id="${id}" {{if options.size}}size="${options.size}"{{/if}} {{if options.readonly}}readonly="readonly"{{/if}} {{if options.name}}name="${options.name}"{{/if}} {{each(i,v) options.data}}data-${i}="${v}"{{/each}}/>');A.registerMessages({invalidPattern:"This field should have pattern {0}",stringTooShort:"This field should contain at least {0} numbers or characters",stringTooLong:"This field should contain at most {0} numbers or characters"});A.registerFieldClass("text",A.Fields.TextField);A.registerDefaultSchemaFieldMapping("string","text")})(jQuery);(function(B){var A=B.alpaca;A.Fields.NumberField=A.Fields.TextField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},getValue:function(){var C=this.field.val();if(A.isValEmpty(C)){return""}else{return parseFloat(C)}},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-number")}},handleValidate:function(){var E=this.base();var D=this.validation;var C=this._validateNumber();D.stringNotANumber={message:C?"":this.view.getMessage("stringNotANumber"),status:C};C=this._validateDivisibleBy();D.stringDivisibleBy={message:C?"":A.substituteTokens(this.view.getMessage("stringDivisibleBy"),[this.schema.divisibleBy]),status:C};C=this._validateMaximum();D.stringValueTooLarge={message:"",status:C};if(!C){if(this.schema.exclusiveMaximum){D.stringValueTooLarge["message"]=A.substituteTokens(this.view.getMessage("stringValueTooLargeExclusive"),[this.schema.maximum])}else{D.stringValueTooLarge["message"]=A.substituteTokens(this.view.getMessage("stringValueTooLarge"),[this.schema.maximum])}}C=this._validateMinimum();D.stringValueTooSmall={message:"",status:C};if(!C){if(this.schema.exclusiveMinimum){D.stringValueTooSmall["message"]=A.substituteTokens(this.view.getMessage("stringValueTooSmallExclusive"),[this.schema.minimum])}else{D.stringValueTooSmall["message"]=A.substituteTokens(this.view.getMessage("stringValueTooSmall"),[this.schema.minimum])}}return E&&D.stringNotANumber["status"]&&D.stringDivisibleBy["status"]&&D.stringValueTooLarge["status"]&&D.stringValueTooSmall["status"]},_validateNumber:function(){var C=this.field.val();if(A.isValEmpty(C)){return true}var D=this.getValue();if(isNaN(D)){return false}if(!C.match(A.regexps.number)){return false}return true},_validateDivisibleBy:function(){var C=this.getValue();if(!A.isEmpty(this.schema.divisibleBy)){if(!(C%this.schema.divisibleBy==0)){return false}}return true},_validateMaximum:function(){var C=this.getValue();if(!A.isEmpty(this.schema.maximum)){if(C>this.schema.maximum){return false}if(!A.isEmpty(this.schema.exclusiveMaximum)){if(C==this.schema.maximum&&this.schema.exclusiveMaximum){return false}}}return true},_validateMinimum:function(){var C=this.getValue();if(!A.isEmpty(this.schema.minimum)){if(C<this.schema.minimum){return false}if(!A.isEmpty(this.schema.exclusiveMinimum)){if(C==this.schema.minimum&&this.schema.exclusiveMinimum){return false}}}return true},getSchemaOfSchema:function(){return A.merge(this.base(),{properties:{minimum:{title:"Minimum",description:"Minimum value of the property",type:"number"},maximum:{title:"Maximum",description:"Maximum value of the property",type:"number"},exclusiveMinimum:{title:"Exclusive Minimum",description:"Field value can not equal the number defined by the minimum attribute",type:"boolean","default":false},exclusiveMaximum:{title:"Exclusive Maximum",description:"Field value can not equal the number defined by the maxinum attribute",type:"boolean","default":false}}})},getOptionsForSchema:function(){return A.merge(this.base(),{fields:{minimum:{title:"Minimum",description:"Minimum value of the property",type:"number"},maximum:{title:"Maximum",description:"Maximum value of the property",type:"number"},exclusiveMinimum:{rightLabel:"Exclusive minimum ?",helper:"Field value must be greater than but not equal to this number if checked",type:"checkbox"},exclusiveMaximum:{rightLabel:"Exclusive Maximum ?",helper:"Field value must be less than but not equal to this number if checked",type:"checkbox"}}})},getTitle:function(){return"Number Field"},getDescription:function(){return"Field for float numbers."},getType:function(){return"number"},getFieldType:function(){return"number"}});A.registerMessages({stringValueTooSmall:"The minimum value for this field is {0}",stringValueTooLarge:"The maximum value for this field is {0}",stringValueTooSmallExclusive:"Value of this field must be greater than {0}",stringValueTooLargeExclusive:"Value of this field must be less than {0}",stringDivisibleBy:"The value must be divisible by {0}",stringNotANumber:"This value is not a number."});A.registerFieldClass("number",A.Fields.NumberField);A.registerDefaultSchemaFieldMapping("number","number")})(jQuery);(function(B){var A=B.alpaca;A.Fields.IntegerField=A.Fields.NumberField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},getValue:function(){var C=this.field.val();if(A.isValEmpty(C)){return""}else{return parseInt(C)}},onChange:function(C){this.base();if(this.slider){this.slider.slider("value",this.getValue())}},postRender:function(){this.base();var C=this;if(this.options.slider){if(!A.isEmpty(this.schema.maximum)&&!A.isEmpty(this.schema.minimum)){this.field.after('<div id="slider"></div>');this.slider=B("#slider",this.field.parent()).slider({value:this.getValue(),min:this.schema.minimum,max:this.schema.maximum,slide:function(D,E){C.setValue(E.value);C.renderValidationState()}})}}if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-integer")}},handleValidate:function(){var D=this.base();var C=this.validation;if(!C.stringNotANumber["status"]){C.stringNotANumber["message"]=this.view.getMessage("stringNotAnInteger")}return D},_validateNumber:function(){var C=this.field.val();if(A.isValEmpty(C)){return true}var D=this.getValue();if(isNaN(D)){return false}if(!C.match(A.regexps.integer)){return false}return true},getSchemaOfSchema:function(){return A.merge(this.base(),{properties:{minimum:{title:"Minimum",description:"Minimum value of the property",type:"integer"},maximum:{title:"Maximum",description:"Maximum value of the property",type:"integer"},divisibleBy:{title:"Divisible By",description:"Property value must be divisible by this number",type:"integer"}}})},getOptionsForSchema:function(){return A.merge(this.base(),{fields:{minimum:{helper:"Minimum value of the field",type:"integer"},maximum:{helper:"Maximum value of the field",type:"integer"},divisibleBy:{helper:"Property value must be divisible by this number",type:"integer"}}})},getSchemaOfOptions:function(){return A.merge(this.base(),{properties:{slider:{title:"Slider",description:"Generate slider control if true",type:"boolean","default":false}}})},getOptionsForOptions:function(){return A.merge(this.base(),{fields:{slider:{rightLabel:"Slider control ?",helper:"Generate slider control if selected",type:"checkbox"}}})},getTitle:function(){return"Integer Field"},getDescription:function(){return"Integer Field."},getType:function(){return"integer"},getFieldType:function(){return"integer"}});A.registerMessages({stringNotAnInteger:"This value is not an integer."});A.registerFieldClass("integer",A.Fields.IntegerField);A.registerDefaultSchemaFieldMapping("integer","integer")})(jQuery);(function(B){var A=B.alpaca;A.Fields.TextAreaField=A.Fields.TextField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();if(!this.options.rows){this.options.rows=5}if(!this.options.cols){this.options.cols=40}this.controlFieldTemplate=this.view.getTemplate("controlFieldTextarea")},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-textarea")}},setValue:function(C){B(this.field).val(C);this.base(C)},getValue:function(){return B(this.field).val()},getSchemaOfOptions:function(){return A.merge(this.base(),{properties:{rows:{title:"Rows",description:"Number of rows",type:"number","default":5},cols:{title:"Columns",description:"Number of columns",type:"number","default":40}}})},getOptionsForOptions:function(){return A.merge(this.base(),{fields:{rows:{type:"integer"},cols:{type:"integer"}}})},getTitle:function(){return"Multi-Line Text"},getDescription:function(){return"Textare field for multiple line text."},getFieldType:function(){return"textarea"}});A.registerTemplate("controlFieldTextarea",'<textarea id="${id}" {{if options.rows}}rows="${options.rows}"{{/if}} {{if options.cols}}cols="${options.cols}"{{/if}} {{if options.readonly}}readonly="readonly"{{/if}} {{if options.formName}}name="${options.formName}"{{/if}} {{each options.data}}data-${fieldId}="${value}"{{/each}}/>');A.registerFieldClass("textarea",A.Fields.TextAreaField)})(jQuery);(function(B){var A=B.alpaca;A.Fields.WysiwygField=A.Fields.TextAreaField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();this.isWyswygLoaded=false},postRender:function(){this.base();var C=this.options.wysiwyg?this.options.wysiwyg:{};if(this.field.wysiwyg){if(this.options.onDemand&&!this.isWyswygLoaded){this.field.hover(function(){B(this).wysiwyg(C);this.isWyswygLoaded=true})}else{this.field.wysiwyg(C);this.isWyswygLoaded=true}}if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-wysiwyg")}},getTitle:function(){return"Wysiwyg Editor"},getDescription:function(){return"Wysiwyd editor for multi-line text."},getFieldType:function(){return"wysiwyg"}});A.registerFieldClass("wysiwyg",A.Fields.WysiwygField)})(jQuery);(function(B){var A=B.alpaca;A.Fields.FileField=A.Fields.TextField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();this.controlFieldTemplate=this.view.getTemplate("controlFieldFile")},setValue:function(D){var C=this.field;this.field=B(".alpaca-filefield-control",this.fieldContainer);this.base(D);this.field=C},postRender:function(){if(this.field&&!A.isEmpty(this.options.styled)&&this.options.styled){this.field.customFileInput()}this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-file")}},getSchemaOfOptions:function(){return A.merge(this.base(),{properties:{styled:{title:"Custom Style",description:"Apply custom style if true.",type:"boolean","default":false}}})},getOptionsForOptions:function(){return A.merge(this.base(),{fields:{styled:{rightLabel:"Custom Style ?",helper:"Apply custom style if true.",type:"checkbox"}}})},getTitle:function(){return"File Field"},getDescription:function(){return"Field for uploading files."},getFieldType:function(){return"file"}});A.registerTemplate("controlFieldFile",'<input type="file" id="${id}" {{if options.size}}size="${options.size}"{{/if}} {{if options.readonly}}readonly="readonly"{{/if}} {{if options.name}}name="${options.name}"{{/if}} {{each(i,v) options.data}}data-${i}="${v}"{{/each}}/>');A.registerFieldClass("file",A.Fields.FileField)})(jQuery);(function(B){var A=B.alpaca;A.Fields.CheckBoxField=A.ControlField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();if(!this.options.rightLabel){this.options.rightLabel=""}},onClick:function(C){this.renderValidationState()},renderField:function(C){var D=this.view.getTemplate("controlFieldCheckbox");if(D){this.field=B.tmpl(D,{id:this.getId(),options:this.options});this.injectField(this.field);this.field=B('input[id="'+this.getId()+'"]',this.field)}if(C){C()}},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-checkbox")}},getValue:function(){return this.field.attr("checked")?true:false},setValue:function(C){if(A.isString(C)){C=C==="true"}if(A.isBoolean(C)){if(C){this.field.attr({checked:true})}else{this.field.attr({checked:false})}}this.base(C)},disable:function(){this.field.disabled=true},enable:function(){this.field.disabled=false},getSchemaOfOptions:function(){return A.merge(this.base(),{properties:{rightLabel:{title:"Option Label",description:"Option label",type:"string"}}})},getOptionsForOptions:function(){return A.merge(this.base(),{fields:{rightLabel:{type:"text"}}})},getTitle:function(){return"Checkbox Field"},getDescription:function(){return"Checkbox Field."},getType:function(){return"boolean"},getFieldType:function(){return"checkbox"}});A.registerTemplate("controlFieldCheckbox",'<span><input type="checkbox" id="${id}" {{if options.readonly}}readonly="readonly"{{/if}} {{if options.name}}name="${options.name}"{{/if}} {{each(i,v) options.data}}data-${i}="${v}"{{/each}}/>{{if options.rightLabel}}<label for="${id}">${options.rightLabel}</label>{{/if}}</span>');A.registerFieldClass("checkbox",A.Fields.CheckBoxField);A.registerDefaultSchemaFieldMapping("boolean","checkbox")})(jQuery);(function(B){var A=B.alpaca;A.Fields.ListField=A.ControlField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){var C=this;C.base();C.selectOptions=[];if(C.getEnum()){B.each(C.getEnum(),function(D,E){var F=E;if(C.options.optionLabels&&C.options.optionLabels[D]){F=C.options.optionLabels[D]}C.selectOptions.push({value:E,text:F})})}},getEnum:function(){if(this.schema&&this.schema["enum"]){return this.schema["enum"]}},getValue:function(C){var D=this;if(A.isArray(C)){B.each(C,function(E,F){B.each(D.selectOptions,function(H,G){if(G.value==F){C[E]=G.value}})})}else{B.each(this.selectOptions,function(F,E){if(E.value==C){C=E.value}})}return C},renderField:function(E){var F=this;if(this.options.dataSource){if(A.isFunction(this.options.dataSource)){this.options.dataSource(this,function(){F._renderField(E)})}else{if(A.isUri(this.options.dataSource)){B.ajax({url:this.options.dataSource,type:"get",dataType:"json",success:function(H){var G=H;if(F.options.dsTransformer&&A.isFunction(F.options.dsTransformer)){G=F.options.dsTransformer(G)}if(G){if(A.isArray(G)){B.each(G,function(I,J){F.selectOptions.push({value:J,text:J})})}if(A.isObject(G)){B.each(G,function(I,J){F.selectOptions.push({value:I,text:J})})}}F._renderField(E)},error:function(G,I,H){F.errorCallback({message:"Unable to load data from uri : "+uri,stage:"DATASOURCE_LOADING_ERROR",details:{jqXHR:G,textStatus:I,errorThrown:H}})}})}else{var D=this.options.dataSource;if(F.options.dsTransformer&&A.isFunction(F.options.dsTransformer)){D=F.options.dsTransformer(D)}if(D){if(A.isArray(D)){B.each(D,function(G,H){F.selectOptions.push({value:H,text:H})})}if(A.isObject(D)){for(var C in D){F.selectOptions.push({value:C,text:D[C]})}}F._renderField(E)}}}}else{this._renderField(E)}},getSchemaOfSchema:function(){return A.merge(this.base(),{properties:{"enum":{title:"Enumeration",description:"List of field value options",type:"array",required:true}}})},getSchemaOfOptions:function(){return A.merge(this.base(),{properties:{optionLabels:{title:"Option Labels",description:"Lables for options",type:"array"},dataSource:{title:"Option Datasource",description:"Datasource for generating options",type:"string"}}})},getOptionsForOptions:function(){return A.merge(this.base(),{fields:{optionLabels:{itemLabel:"Label",type:"array"},dataSource:{type:"text"}}})}})})(jQuery);(function(B){var A=B.alpaca;A.Fields.SelectField=A.Fields.ListField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},getValue:function(){if(this.field){return this.base(this.field.val())}},setValue:function(C){if(A.isArray(C)){if(!A.compareArrayContent(C,this.getValue())){if(C!=null&&this.field){this.field.val(C)}this.base(C)}}else{if(C!=this.getValue()){if(C!=null&&this.field){this.field.val(C)}this.base(C)}}},_renderField:function(C){var D;if(this.options.multiple&&A.isArray(this.data)){D=this.view.getTemplate("controlFieldSelectMultiple")}else{D=this.view.getTemplate("controlFieldSelect")}if(D){this.field=B.tmpl(D,{id:this.getId(),options:this.options,required:this.schema.required,selectOptions:this.selectOptions,data:this.data});this.injectField(this.field)}if(C){C()}},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-select")}},onChange:function(C){this.base(C);var D=this;A.later(25,this,function(){var E=D.getValue();D.setValue(E);D.renderValidationState()})},getSchemaOfOptions:function(){return A.merge(this.base(),{properties:{multiple:{title:"Mulitple Selection",description:"Allow multiple selection if true",type:"boolean","default":false},size:{title:"Displayed Options",description:"Number of options to be shown",type:"number"}}})},getOptionsForOptions:function(){return A.merge(this.base(),{fields:{multiple:{rightLabel:"Allow mulitple selection ?",helper:"Allow multiple selection if checked",type:"checkbox"},size:{type:"integer"}}})},getTitle:function(){return"Dropdown Select"},getDescription:function(){return"Dropdown select field."},getFieldType:function(){return"select"}});A.registerTemplate("controlFieldSelect",'<select id="${id}" {{if options.readonly}}readonly="readonly"{{/if}} {{if options.multiple}}multiple{{/if}} {{if options.size}}size="${options.size}"{{/if}} {{if options.name}}name="${options.name}"{{/if}}>{{if !required}}<option value="">None</option>{{/if}}{{each(i,value) selectOptions}}<option value="${value}" {{if value == data}}selected="selected"{{/if}}>${text}</option>{{/each}}</select>');A.registerTemplate("controlFieldSelectMultiple",'<select id="${id}" {{if options.readonly}}readonly="readonly"{{/if}} {{if options.multiple}}multiple="multiple"{{/if}} {{if options.size}}size="${options.size}"{{/if}} {{if options.name}}name="${options.name}"{{/if}}>{{if !required}}<option value="">None</option>{{/if}}{{each(i,value) selectOptions}}<option value="${value}" {{each(j,val) data}}{{if value == val}}selected="selected"{{/if}}{{/each}}>${text}</option>{{/each}}</select>');A.registerFieldClass("select",A.Fields.SelectField)})(jQuery);(function(B){var A=B.alpaca;A.Fields.RadioField=A.Fields.ListField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();if(this.options.name){this.name=this.options.name}else{this.name=this.getId()+"-name"}},getValue:function(){var C=this.base(B("input:radio[name="+this.name+"]:checked",this.field).val());B.each(this.selectOptions,function(){if(String(this["value"])==C){C=this["value"]}});return C},setValue:function(C){if(C!=this.getValue()){B.each(B("input:radio[name="+this.name+"]",this.field),function(){if(B(this).val()==C){B(this).attr("checked","checked")}else{B(this).removeAttr("checked")}});if(B("input:radio:checked",this.field).length==0){B("input:radio:first",this.field).attr("checked","checked")}this.base(C)}},_renderField:function(C){var D=this.view.getTemplate("controlFieldRadio");if(D){this.field=B.tmpl(D,{id:this.getId(),options:this.options,selectOptions:this.selectOptions,required:this.schema.required,name:this.name,data:this.data});if(B("input:radio:checked",this.field).length==0){B("input:radio:first",this.field).attr("checked","checked")}this.injectField(this.field)}if(C){C()}},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-radio")}},onClick:function(C){this.base(C);var D=this;A.later(25,this,function(){var E=D.getValue();D.setValue(E);D.renderValidationState()})},getSchemaOfOptions:function(){return A.merge(this.base(),{properties:{name:{title:"Field name",description:"Field name",type:"string",readonly:true}}})},getTitle:function(){return"Radio Group Field"},getDescription:function(){return"Radio Group Field."},getFieldType:function(){return"radio"}});A.registerTemplate("controlFieldRadio",'<div id="${id}" class="alpaca-controlfield-radio">{{if !required}}<input type="radio" {{if options.readonly}}readonly="readonly"{{/if}} name="${name}" value=""/><span class="alpaca-controlfield-radio-label">None</span>{{/if}}{{each selectOptions}}<input type="radio" {{if options.readonly}}readonly="readonly"{{/if}} name="${name}" value="${value}" {{if value == data}}checked="checked"{{/if}}/><span class="alpaca-controlfield-radio-label">${text}</span>{{/each}}</div>');A.registerFieldClass("radio",A.Fields.RadioField)})(jQuery);(function(B){var A=B.alpaca;A.Fields.ButtonField=A.ControlField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();if(this.options&&this.options.form){this.form=this.options.form;delete this.options.form}if(this.options&&this.options.buttonType){this.buttonType=this.options.buttonType}else{this.buttonType="button"}if(this.options&&this.options.label){this.label=this.options.label}this.buttonStyle=A.isEmpty(this.view.buttonStyle)?"button":this.view.buttonStyle},renderField:function(C){B(this.fieldContainer).addClass("alpaca-controlfield-button");var D=this.view.getTemplate("controlFieldButton");if(D){this.field=B.tmpl(D,{id:this.getId(),type:this.buttonType,value:this.data,label:this.label,options:this.options});this.field.addClass("alpaca-form-button");if(this.buttonStyle=="button"){this.button=this.field.button({text:true})}this.injectField(this.field)}if(C){C()}},getValue:function(){return B(this.field).val()},setValue:function(C){if(C){B(this.field).val(C)}else{B(this.field).val("")}this.base(C)},disable:function(){this.field.disabled=true},enable:function(){this.field.disabled=false},focus:function(){this.field.focus()},onClick:function(C){},getTitle:function(){return"Button Field"},getDescription:function(){return"Common Button Field."},getType:function(){return"any"}});A.registerTemplate("controlFieldButton",'<button type="${type}" id="${id}" {{if options.readonly}}readonly="readonly"{{/if}} {{if options.formName}}name="${options.formName}"{{/if}} {{if value}}value="${value}"{{/if}} {{each(i,v) options.data}}data-${i}="${v}"{{/each}}>{{if label}}${label}{{else}}{{if value}}${value}{{/if}}{{/if}}</button>');A.registerFieldClass("button",A.Fields.ButtonField)})(jQuery);(function(B){var A=B.alpaca;A.Fields.ObjectField=A.ContainerField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();if(A.isEmpty(this.data)){return }if(!A.isObject(this.data)){if(!A.isString(this.data)){return }else{try{this.data=B.parseJSON(this.data);if(!A.isObject(this.data)){return }}catch(C){return }}}},setValue:function(F){if(!F||!A.isObject(F)){return }for(var C in this.childrenById){var G=this.childrenById[C].propertyId;var E=A.traverseObject(F,G);if(!A.isEmpty(E)){var D=this.childrenById[C];D.setValue(E)}}},getValue:function(){var I={};for(var E=0;E<this.children.length;E++){var H=this.children[E].propertyId;var G=this.children[E].getValue();var F=this.childrenByPropertyId[H];var D=F.schema.dependencies;if(D){if(A.isString(D)){if(this.getDependencyStatus(H,D)){I[H]=G}}else{if(A.isArray(D)){var C=true;var J=this;B.each(D,function(K,L){C=C&&J.getDependencyStatus(H,L)});if(C){I[H]=G}}}}else{I[H]=G}}return I},postRender:function(){this.base();if(this.isTopLevel()){if(this.view){this.wizardConfigs=this.view.getWizard();var C=this.view.getLayout().template;if(this.wizardConfigs&&this.wizardConfigs.renderWizard){if(C){this.wizard()}else{this.autoWizard()}}}}},getIndex:function(E){if(A.isEmpty(E)){return -1}for(var D=0;D<this.children.length;D++){var C=this.children[D].propertyId;if(C==E){return D}}return -1},addItem:function(H,D,G,F){var I=this;var E;if(I.schema&&I.schema.properties&&I.schema.properties[H]){E=I.schema.properties[H]}var C=I.renderItemContainer(F,this,H);C.alpaca({data:G,options:D,schema:E,view:this.view.viewObject.id?this.view.viewObject.id:this.view.viewObject,connector:this.connector,notTopLevel:true,render:function(K){K.parent=I;K.propertyId=H;if(I.path!="/"){K.path=I.path+"/"+H}else{K.path=I.path+H}K.render();C.attr("id",K.getId()+"-item-container");C.attr("alpaca-id",K.getId());if(A.isEmpty(F)){I.addChild(K)}else{var J=I.getIndex(F);if(J!=-1){I.addChild(K,J+1)}else{I.addChild(K)}}if(F){I.renderValidationState()}}})},renderItems:function(){var I=this;var E=I.data;if(I.schema&&I.schema.properties){E=I.schema.properties}for(var H in E){var G={};if(I.options&&I.options.fields&&I.options.fields[H]){G=I.options.fields[H]}var D=null;if(I.data){D=I.data[H]}I.addItem(H,G,D)}for(var H in E){if(I.schema&&I.schema.properties&&I.schema.properties[H]){var F=I.schema.properties[H];var C=F.dependencies;if(C){if(A.isString(C)){this.enableDependency(H,C)}else{if(A.isArray(C)){B.each(C,function(J,K){I.enableDependency(H,K)})}}}}}this.renderValidationState()},getDependencyStatus:function(F,E){var D=this.childrenByPropertyId[E]&&!A.isValEmpty(this.childrenByPropertyId[E].data);var C=this.childrenByPropertyId[F].options.dependencies;if(C){if(C[E]!=null&&A.isFunction(C[E])){D=C[E].call(this,this.childrenByPropertyId[E].data)}else{if(D){if(A.isArray(C[E])){if(C[E]&&B.inArray(this.childrenByPropertyId[E].data,C[E])==-1){D=false}}else{if(C[E]!=null&&C[E]!=this.childrenByPropertyId[E].data){D=false}}}}}return D},renderDependency:function(F){var E=this.childrenByPropertyId[F];var D=E.schema.dependencies;if(D){if(A.isString(D)){if(this.getDependencyStatus(F,D)){E.show()}else{E.hide()}}else{if(A.isArray(D)){var C=true;var G=this;B.each(D,function(H,I){C=C&&G.getDependencyStatus(F,I)});if(C){E.show()}else{E.hide()}}}}},enableDependency:function(D,C){if(this.childrenByPropertyId[D]){this.renderDependency(D);var E=this;if(this.childrenByPropertyId[C]){this.childrenByPropertyId[C].getEl().bind("fieldupdate",function(F){E.renderDependency(D)})}}},wizard:function(){var F=this.outerEl;var D=B(".alpaca-wizard-step",F);var G=D.size();this.totalSteps=G;var H=this;var E=[];if(this.wizardConfigs.stepTitles){E=this.wizardConfigs.stepTitles}else{D.each(function(J){var I={title:"",description:""};if(B(".alpaca-wizard-step-title",this)){I.title=B(".alpaca-wizard-step-title",this).html();B(".alpaca-wizard-step-title",this).hide()}if(B(".alpaca-wizard-step-description",this)){I.description=B(".alpaca-wizard-step-description",this).html();B(".alpaca-wizard-step-description",this).hide()}E.push(I)})}var C=this._renderWizardStatusBar(E);if(C){B(F).before(C)}D.each(function(K){var O="step"+K;var L=H.view.getTemplate("wizardStep");if(L){var J=B.tmpl(L,{});J.attr("id",O);B(this).wrap(J)}var N=O+"-nav-bar";var I=H.view.getTemplate("wizardNavBar");if(I){var M=B.tmpl(I,{});M.attr("id",N);M.addClass("alpaca-wizard-nav-bar");B(this).append(M)}if(K==0){H._createNextButton(K);H._selectStep(K)}else{if(K==G-1){B("#step"+K).hide();H._createPrevButton(K)}else{B("#step"+K).hide();H._createPrevButton(K);H._createNextButton(K)}}B("#step"+K+"-nav-bar").buttonset()})},autoWizard:function(){var D=this.wizardConfigs.steps;if(!D){D=1}this.totalSteps=D;var F=this.wizardConfigs.bindings;if(!F){F={}}for(var J in this.childrenByPropertyId){if(!F.hasOwnProperty(J)){F[J]=1}}this.stepBindings=F;for(var I=0;I<D;I++){var G=I+1;var O=[];for(var J in F){if(F[J]==G){if(this.childrenByPropertyId&&this.childrenByPropertyId[J]){O.push("#"+this.childrenByPropertyId[J].container.attr("id"))}}}var H="step"+I;var L=this.view.getTemplate("wizardStep");if(L){var K=B.tmpl(L,{});K.attr("id",H);B(O.join(",")).wrapAll(K)}var M=H+"-nav-bar";var E=this.view.getTemplate("wizardNavBar");if(E){var C=B.tmpl(E,{});C.attr("id",M);C.addClass("alpaca-wizard-nav-bar");B("#"+H,this.outerEl).append(C)}}var N=this._renderWizardStatusBar(this.wizardConfigs.stepTitles);if(N){N.prependTo(this.fieldContainer)}for(var I=0;I<D;I++){if(I==0){this._createNextButton(I);this._selectStep(I)}else{if(I==D-1){B("#step"+I).hide();this._createPrevButton(I)}else{B("#step"+I).hide();this._createPrevButton(I);this._createNextButton(I)}}B("#step"+I+"-nav-bar").buttonset()}},_renderWizardStatusBar:function(D){var E=this.wizardConfigs.statusBar;if(E&&D){var F=this.view.getTemplate("wizardStatusBar");if(F){var C=B.tmpl(F,{id:this.getId()+"-wizard-status-bar",titles:D});C.addClass("alpaca-wizard-status-bar ui-widget-header ui-corner-all");return C}}},_createPrevButton:function(D){var G="step"+D;var F=this;var C=this.view.getTemplate("wizardPreButton");if(C){var E=B.tmpl(C,{});E.attr("id",G+"-button-pre");if(E.button){E.button({text:true,icons:{primary:"ui-icon-triangle-1-w"}})}E.click(function(){B("#"+G).hide();B("#step"+(D-1)).show();F._selectStep(D-1);return false});B("#"+G+"-nav-bar").append(E)}},_createNextButton:function(D){var G="step"+D;var F=this;var E=this.view.getTemplate("wizardNextButton");if(E){var C=B.tmpl(E,{});C.attr("id",G+"-button-next");if(C.button){C.button({text:true,icons:{secondary:"ui-icon-triangle-1-e"}})}C.click(function(){var H=true;if(F.view&&F.wizardConfigs&&F.wizardConfigs.validation){B.each(F.stepBindings,function(J,I){if(I==D+1&&H){H=F.childrenByPropertyId[J].validate()}})}if(H){B("#"+G).hide();B("#step"+(D+1)).show();F._selectStep(D+1)}return false});B("#"+G+"-nav-bar").append(C)}},_selectStep:function(C){B("#"+this.getId()+"-wizard-status-bar li").removeClass("current current-has-next ui-state-highlight ui-corner-all");B("#stepDesc"+C).addClass("current ui-state-highlight ui-corner-all");if(C<this.totalSteps-1){B("#stepDesc"+C).addClass("current-has-next")}},getSchemaOfSchema:function(){var E={properties:{properties:{title:"Field Properties",description:"List of Field Properties",type:"object"}}};var C=E.properties.properties;C.properties={};if(this.children){for(var D=0;D<this.children.length;D++){var F=this.children[D].propertyId;C.properties[F]=this.children[D].getSchemaOfSchema();C.properties[F].title=F+" :: "+C.properties[F].title}}return A.merge(this.base(),E)},getSchemaOfOptions:function(){var F=A.merge(this.base(),{properties:{}});var E={properties:{properties:{title:"Field Option Properties",description:"List of field option properties",type:"object"}}};var C=E.properties.properties;C.properties={};if(this.children){for(var D=0;D<this.children.length;D++){var G=this.children[D].propertyId;C.properties[G]=this.children[D].getSchemaOfOptions();C.properties[G].title=G+" :: "+C.properties[G].title}}return A.merge(F,E)},getTitle:function(){return"Composite Field"},getDescription:function(){return"Composite field for containing other fields"},getType:function(){return"object"},getFieldType:function(){return"object"}});A.registerFieldClass("object",A.Fields.ObjectField);A.registerDefaultSchemaFieldMapping("object","object")})(jQuery);(function(B){var A=B.alpaca;A.Fields.ArrayField=A.ContainerField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();if(A.isEmpty(this.data)){return }if(!A.isArray(this.data)){if(!A.isString(this.data)){return }else{try{this.data=B.parseJSON(this.data);if(!A.isArray(this.data)){return }}catch(C){this.data=[this.data]}}}this.options.toolbarStyle=A.isEmpty(this.view.toolbarStyle)?"button":this.view.toolbarStyle;if(this.schema.items&&this.schema.uniqueItems){A.mergeObject(this.options,{forceRevalidation:true})}},setValue:function(E){if(!E||!A.isArray(E)){return }for(var D=0;D<this.children.length;D++){var C=this.children[D];if(E.length<D){C.setValue(E[D])}}},getValue:function(){var E=[];for(var D=0;D<this.children.length;D++){var C=this.children[D].getValue();E.push(C)}return E},getSize:function(){return this.children.length},moveItem:function(C,D){var E=this;if(this.childrenById[C]){B.each(this.children,function(G,L){if(L.getId()==C){var J;if(D==true){J=G-1;if(J<0){J=E.children.length-1}}else{J=G+1;if(J>=E.children.length){J=0}}if(E.children[J]){var F=E.children[J].getId();var K=B("#"+C+"-item-container");var I=B("#"+F+"-item-container");E.reRenderItem(E.children[G],I);E.reRenderItem(E.children[J],K);var H=E.children[G];E.children[G]=E.children[J];E.children[J]=H;return false}}})}},removeItem:function(C){if(this._validateEqualMinItems()){this.children=B.grep(this.children,function(E,D){return(E.getId()!=C)});delete this.childrenById[C];B("#"+C+"-item-container",this.outerEl).remove();this.renderValidationState();this.updateToolbarItemsStatus()}},updateToolbarItemsStatus:function(){var C=this;if(C._validateEqualMaxItems()){B(".alpaca-fieldset-array-item-toolbar-add",this.outerEl).each(function(D){if(C.options.toolbarStyle=="button"&&B(this).button){B(this).button("enable")}else{B(this).removeClass("alpaca-fieldset-array-item-toolbar-disabled")}})}else{B(".alpaca-fieldset-array-item-toolbar-add",this.outerEl).each(function(D){if(C.options.toolbarStyle=="button"&&B(this).button){B(this).button("disable")}else{B(this).addClass("alpaca-fieldset-array-item-toolbar-disabled")}})}if(C._validateEqualMinItems()){B(".alpaca-fieldset-array-item-toolbar-remove",this.outerEl).each(function(D){if(C.options.toolbarStyle=="button"&&B(this).button){B(this).button("enable")}else{B(this).removeClass("alpaca-fieldset-array-item-toolbar-disabled")}})}else{B(".alpaca-fieldset-array-item-toolbar-remove",this.outerEl).each(function(D){if(C.options.toolbarStyle=="button"&&B(this).button){B(this).button("disable")}else{B(this).addClass("alpaca-fieldset-array-item-toolbar-disabled")}})}if(this.getSize()==0){this.renderArrayToolbar(this.outerEl)}else{if(this.arrayToolbar){this.arrayToolbar.remove()}}B(".alpaca-item-label-counter",this.outerEl).each(function(D){B(this).html(D+1)})},renderToolbar:function(F){var J=this;var D=F.attr("alpaca-id");var E=this.childrenById[D];var K=this.view.getTemplate("arrayItemToolbar");if(K){var G=B.tmpl(K,{id:D});if(G.attr("id")==null){G.attr("id",D+"-item-toolbar")}var L=B(".alpaca-fieldset-array-item-toolbar-add",G);if(L.button){L.button({text:false,icons:{primary:"ui-icon-circle-plus"}})}L.click(function(){var M=E.getValue();var N=J.addItem(F.index()+1,null,A.isValEmpty(M)?null:E.getValue(),D);J.enrichElements(N);return false});var I=B(".alpaca-fieldset-array-item-toolbar-remove",G);if(I.button){I.button({text:false,icons:{primary:"ui-icon-circle-minus"}})}I.click(function(){J.removeItem(D)});var H=B(".alpaca-fieldset-array-item-toolbar-up",G);if(H.button){H.button({text:false,icons:{primary:"ui-icon-circle-arrow-n"}})}H.click(function(){J.moveItem(D,true)});var C=B(".alpaca-fieldset-array-item-toolbar-down",G);if(C.button){C.button({text:false,icons:{primary:"ui-icon-circle-arrow-s"}})}C.click(function(){J.moveItem(D,false)});if(this.options.toolbarSticky){G.prependTo(F)}else{G.hide().prependTo(F);F.hover(function(){B(".alpaca-fieldset-array-item-toolbar",this).show()},function(){B(".alpaca-fieldset-array-item-toolbar",this).hide()})}}},renderArrayToolbar:function(C){var G=this;var F=C.attr("alpaca-id");var D=this.view.getTemplate("arrayToolbar");if(D){var E=B.tmpl(D,{id:F});if(E.attr("id")==null){E.attr("id",F+"-array-toolbar")}if(this.options.toolbarStyle=="link"){B(".alpaca-fieldset-array-toolbar-add",E).click(function(){var H=G.addItem(0,null,"",F);G.enrichElements(H)})}else{B(".alpaca-fieldset-array-toolbar-add",E).button({icons:{primary:"ui-icon-circle-plus"}}).click(function(){G.addItem(0,null,"",F);return false}).wrap("<small></small>")}E.appendTo(C);this.arrayToolbar=E}},reRenderItem:function(D,C){D.container=C;D.render();C.attr("id",D.getId()+"-item-container");C.attr("alpaca-id",D.getId());B(".alpaca-fieldset-array-item-toolbar",C).remove();this.renderToolbar(C);this.enrichElements(C)},addItem:function(D,E,H,G){var I=this;if(I._validateEqualMaxItems()){var F;if(I.schema&&I.schema.items){F=I.schema.items}if(E==null&&I.options&&I.options.fields&&I.options.fields.item){E=I.options.fields.item}var C=I.renderItemContainer(G);C.alpaca({data:H,options:E,schema:F,view:this.view.viewObject.id?this.view.viewObject.id:this.view.viewObject,connector:this.connector,notTopLevel:true,render:function(K){K.parent=I;K.path=I.path+"["+D+"]";K.render();C.attr("id",K.getId()+"-item-container");C.attr("alpaca-id",K.getId());if(I.options&&I.options.itemLabel){var L=I.view.getTemplate("itemLabel");var J=B.tmpl(L,{options:I.options,index:D?D+1:1,id:I.id});J.prependTo(C)}I.addChild(K,D);I.renderToolbar(C);I.renderValidationState()}});this.updateToolbarItemsStatus(this.outerEl);return C}},enrichElements:function(C){if(C){if(C.find('[data-role="fieldcontain"]').fieldcontain){C.find('[data-role="fieldcontain"]').fieldcontain();C.find('[data-role="fieldcontain"]').find("[type='radio'], [type='checkbox']").checkboxradio();C.find('[data-role="fieldcontain"]').find("button, [data-role='button'], [type='button'], [type='submit'], [type='reset'], [type='image']").not(".ui-nojs").button();C.find('[data-role="fieldcontain"]').find("input, textarea").not("[type='radio'], [type='checkbox'], button, [type='button'], [type='submit'], [type='reset'], [type='image']").textinput();C.find('[data-role="fieldcontain"]').find("input, select").filter("[data-role='slider'], [data-type='range']").slider();C.find('[data-role="fieldcontain"]').find("select:not([data-role='slider'])").selectmenu();C.find('[data-role="button"]').buttonMarkup()}}},renderItems:function(){var C=this;if(this.data){B.each(this.data,function(D,F){var E;if(C.options&&C.options.fields&&C.options.fields.item){E=C.options.fields.item}C.addItem(D,E,F)})}this.updateToolbarItemsStatus()},_validateEqualMaxItems:function(){if(this.schema.items&&this.schema.items.maxItems){if(this.getSize()>=this.schema.items.maxItems){return false}}return true},_validateEqualMinItems:function(){if(this.schema.items&&this.schema.items.minItems){if(this.getSize()<=this.schema.items.minItems){return false}}return true},_validateMinItems:function(){if(this.schema.items&&this.schema.items.minItems){if(this.getSize()<this.schema.items.minItems){return false}}return true},_validateMaxItems:function(){if(this.schema.items&&this.schema.items.maxItems){if(this.getSize()>this.schema.items.maxItems){return false}}return true},_validateUniqueItems:function(){if(this.schema.items&&this.schema.uniqueItems){var E={};for(var D=0,C=this.children.length;D<C;++D){if(!E.hasOwnProperty(this.children[D])){E[this.children[D]]=true}else{return false}}}return true},handleValidate:function(){var E=this.base();var D=this.validation;var C=this._validateUniqueItems();D.valueNotUnique={message:C?"":this.view.getMessage("valueNotUnique"),status:C};C=this._validateMaxItems();D.tooManyItems={message:C?"":A.substituteTokens(this.view.getMessage("tooManyItems"),[this.schema.items.maxItems]),status:C};C=this._validateMinItems();D.notEnoughItems={message:C?"":A.substituteTokens(this.view.getMessage("notEnoughItems"),[this.schema.items.minItems]),status:C};return E&&D.valueNotUnique["status"]&&D.tooManyItems["status"]&&D.notEnoughItems["status"]},getSchemaOfSchema:function(){var C={properties:{items:{title:"Array Items",description:"Schema of array items",type:"object",properties:{minItems:{title:"Minimum Items",description:"Minimum number of items",type:"number"},maxItems:{title:"Maximum Items",description:"Maximum number of items",type:"number"},uniqueItems:{title:"Items Unique",description:"Item values should be unique if true",type:"boolean","default":false}}}}};if(this.children&&this.children[0]){A.merge(C.properties.items.properties,this.children[0].getSchemaOfSchema())}return A.merge(this.base(),C)},getOptionsForSchema:function(){return A.merge(this.base(),{fields:{items:{type:"object",fields:{minItems:{type:"integer"},maxItems:{type:"integer"},uniqueItems:{type:"checkbox"}}}}})},getSchemaOfOptions:function(){var C={properties:{items:{title:"Array Items",description:"Schema of array items",type:"object",properties:{toolbarSticky:{title:"Sticky Toolbar",description:"Toolbar will be aways on if true",type:"boolean","default":false}}}}};if(this.children&&this.children[0]){A.merge(C.properties.items.properties,this.children[0].getSchemaOfSchema())}return A.merge(this.base(),C)},getOptionsForOptions:function(){return A.merge(this.base(),{fields:{items:{type:"object",fields:{toolbarSticky:{type:"checkbox"}}}}})},getTitle:function(){return"Array Field"},getDescription:function(){return"Array Field."},getType:function(){return"array"},getFieldType:function(){return"array"}});A.registerTemplate("itemLabel",'{{if options.itemLabel}}<div class="alpaca-controlfield-label"><div>${options.itemLabel}{{if index}} <span class="alpaca-item-label-counter">${index}</span>{{/if}}</div></div>{{/if}}');A.registerTemplate("arrayToolbar",'<span class="ui-widget ui-corner-all alpaca-fieldset-array-toolbar"><button class="alpaca-fieldset-array-toolbar-icon alpaca-fieldset-array-toolbar-add">Add Item</button></span>');A.registerTemplate("arrayItemToolbar",'<div class="ui-widget-header ui-corner-all alpaca-fieldset-array-item-toolbar"><button class="alpaca-fieldset-array-item-toolbar-icon alpaca-fieldset-array-item-toolbar-add">Add Item</button><button class="alpaca-fieldset-array-item-toolbar-icon alpaca-fieldset-array-item-toolbar-remove">Remove Item</button><button class="alpaca-fieldset-array-item-toolbar-icon alpaca-fieldset-array-item-toolbar-up">Move Up</button><button class="alpaca-fieldset-array-item-toolbar-icon alpaca-fieldset-array-item-toolbar-down">Move Down</button></div>');A.registerMessages({notEnoughItems:"The minimum number of items is {0}",tooManyItems:"The maximum number of items is {0}",valueNotUnique:"Values are not unique",notAnArray:"This value is not an Array"});A.registerFieldClass("array",A.Fields.ArrayField);A.registerDefaultSchemaFieldMapping("array","array")})(jQuery);(function(B){var A=B.alpaca;A.Fields.UpperCaseField=A.Fields.TextField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-uppercase")}},setValue:function(C){var D=C.toUpperCase();if(D!=this.getValue()){this.base(D)}},onKeyPress:function(C){this.base(C);var D=this;A.later(25,this,function(){var E=D.getValue();D.setValue(E)})},getTitle:function(){return"Uppercase Text"},getDescription:function(){return"Text Field for uppercase text."},getFieldType:function(){return"uppercase"}});A.registerFieldClass("uppercase",A.Fields.UpperCaseField);A.registerDefaultFormatFieldMapping("uppercase","uppercase")})(jQuery);(function(B){var A=B.alpaca;A.Fields.LowerCaseField=A.Fields.TextField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-lowercase")}},setValue:function(D){var C=D.toLowerCase();if(C!=this.getValue()){this.base(C)}},onKeyPress:function(C){this.base(C);var D=this;A.later(25,this,function(){var E=D.getValue();D.setValue(E)})},getTitle:function(){return"Lowercase Text"},getDescription:function(){return"Text Field for lowercase text."},getFieldType:function(){return"lowercase"}});A.registerFieldClass("lowercase",A.Fields.LowerCaseField);A.registerDefaultFormatFieldMapping("lowercase","lowercase")})(jQuery);(function(B){var A=B.alpaca;A.Fields.PersonalNameField=A.Fields.TextField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-personalname")}},setValue:function(D){var E="";for(var C=0;C<D.length;C++){if(C==0){E+=D.charAt(C).toUpperCase()}else{if(D.charAt(C-1)==" "||D.charAt(C-1)=="-"||D.charAt(C-1)=="'"){E+=D.charAt(C).toUpperCase()}else{E+=D.charAt(C)}}}if(E!=this.getValue()){this.base(E)}},onKeyPress:function(C){this.base(C);var D=this;A.later(25,this,function(){var E=D.getValue();D.setValue(E)})},getTitle:function(){return"Personal Name"},getDescription:function(){return"Text Field for personal name with captical letter for first letter & after hyphen, space or apostrophe."},getFieldType:function(){return"personalname"}});A.registerFieldClass("personalname",A.Fields.PersonalNameField)})(jQuery);(function(B){var A=B.alpaca;A.Fields.IPv4Field=A.Fields.TextField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();if(!this.schema.pattern){this.schema.pattern=A.regexps.ipv4}},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-ipv4")}},handleValidate:function(){var D=this.base();var C=this.validation;if(!C.invalidPattern["status"]){C.invalidPattern["message"]=this.view.getMessage("invalidIPv4")}return D},getSchemaOfSchema:function(){var C=(this.schema&&this.schema.pattern)?this.schema.pattern:A.regexps.ipv4;return A.merge(this.base(),{properties:{pattern:{title:"Pattern",description:"Field Pattern in Regular Expression",type:"string","default":C,readonly:true},format:{title:"Format",description:"Property data format",type:"string","enum":["ip-address"],"default":"ip-address",readonly:true}}})},getOptionsForSchema:function(){return A.merge(this.base(),{fields:{format:{type:"text"}}})},getTitle:function(){return"IP Address Field"},getDescription:function(){return"IP Address Field."},getFieldType:function(){return"ipv4"}});A.registerMessages({invalidIPv4:"Invalid IPv4 address, e.g. 192.168.0.1"});A.registerFieldClass("ipv4",A.Fields.IPv4Field);A.registerDefaultFormatFieldMapping("ip-address","ipv4")})(jQuery);(function(B){var A=B.alpaca;A.Fields.DateField=A.Fields.TextField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();if(!this.options.dateFormat){this.options.dateFormat=A.defaultDateFormat}if(!this.options.dateFormatRegex){this.options.dateFormatRegex=A.regexps.date}},postRender:function(){this.base();if(this.field.datepicker){this.field.datepicker({dateFormat:this.options.dateFormat});if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-date")}}},onChange:function(C){this.base();this.renderValidationState()},handleValidate:function(){var E=this.base();var D=this.validation;var C=this._validateDateFormat();D.invalidDate={message:C?"":A.substituteTokens(this.view.getMessage("invalidDate"),[this.options.dateFormat]),status:C};return E&&D.invalidDate["status"]},_validateDateFormat:function(){var C=this.field.val();if(B.datepicker){try{B.datepicker.parseDate(this.options.dateFormat,C);return true}catch(D){return false}}else{return C.match(this.options.dateFormatRegex)}},setValue:function(C){if(C==""){this.base(C);return }this.base(C)},getSchemaOfSchema:function(){return A.merge(this.base(),{properties:{format:{title:"Format",description:"Property data format",type:"string","default":"date","enum":["date"],readonly:true}}})},getOptionsForSchema:function(){return A.merge(this.base(),{fields:{format:{type:"text"}}})},getSchemaOfOptions:function(){return A.merge(this.base(),{properties:{dateFormat:{title:"Date Format",description:"Date format",type:"string","default":A.defaultDateFormat},dateFormatRegex:{title:"Format Regular Expression",description:"Regular expression for validation date format",type:"string","default":A.regexps.date}}})},getOptionsForOptions:function(){return A.merge(this.base(),{fields:{dateFormat:{type:"text"},dateFormatRegex:{type:"text"}}})},getTitle:function(){return"Date Field"},getDescription:function(){return"Date Field."},getFieldType:function(){return"date"}});A.registerMessages({invalidDate:"Invalid date for format {0}"});A.registerFieldClass("date",A.Fields.DateField);A.registerDefaultFormatFieldMapping("date","date")})(jQuery);(function(B){var A=B.alpaca;A.Fields.PasswordField=A.Fields.TextField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();if(!this.schema.pattern){this.schema.pattern=A.regexps.password}this.controlFieldTemplate=this.view.getTemplate("controlFieldPassword")},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-password")}},handleValidate:function(){var D=this.base();var C=this.validation;if(!C.invalidPattern["status"]){C.invalidPattern["message"]=this.view.getMessage("invalidPassword")}return D},getSchemaOfSchema:function(){var C=(this.schema&&this.schema.pattern)?this.schema.pattern:/^[0-9a-zA-Z\x20-\x7E]*$/;return A.merge(this.base(),{properties:{pattern:{title:"Pattern",description:"Field Pattern in Regular Expression",type:"string","default":this.schema.pattern,"enum":[C],readonly:true},format:{title:"Format",description:"Property data format",type:"string","default":"password","enum":["password"],readonly:true}}})},getOptionsForSchema:function(){return A.merge(this.base(),{fields:{format:{type:"text"}}})},getTitle:function(){return"Password Field"},getDescription:function(){return"Password Field."},getFieldType:function(){return"password"}});A.registerTemplate("controlFieldPassword",'<input type="password" id="${id}" {{if options.size}}size="${options.size}"{{/if}} {{if options.readonly}}readonly="readonly"{{/if}} {{if options.formName}}name="${options.formName}"{{/if}} {{each(i,v) options.data}}data-${i}="${v}"{{/each}}/>');A.registerMessages({invalidPassword:"Invalid Password"});A.registerFieldClass("password",A.Fields.PasswordField);A.registerDefaultFormatFieldMapping("password","password")})(jQuery);(function(B){var A=B.alpaca;A.Fields.EmailField=A.Fields.TextField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();if(!this.schema.pattern){this.schema.pattern=A.regexps.email}},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-email")}},handleValidate:function(){var D=this.base();var C=this.validation;if(!C.invalidPattern["status"]){C.invalidPattern["message"]=this.view.getMessage("invalidEmail")}return D},getSchemaOfSchema:function(){var C=(this.schema&&this.schema.pattern)?this.schema.pattern:A.regexps.email;return A.merge(this.base(),{properties:{pattern:{title:"Pattern",description:"Field Pattern in Regular Expression",type:"string","default":C,"enum":[C],readonly:true},format:{title:"Format",description:"Property data format",type:"string","default":"email","enum":["email"],readonly:true}}})},getOptionsForSchema:function(){return A.merge(this.base(),{fields:{format:{type:"text"}}})},getTitle:function(){return"Email Field"},getDescription:function(){return"Email Field."},getFieldType:function(){return"email"}});A.registerMessages({invalidEmail:"Invalid Email address e.g. admin@gitanasoftware.com"});A.registerFieldClass("email",A.Fields.EmailField);A.registerDefaultFormatFieldMapping("email","email")})(jQuery);(function(B){var A=B.alpaca;A.Fields.PhoneField=A.Fields.TextField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();if(!this.schema.pattern){this.schema.pattern=A.regexps.phone}if(A.isEmpty(this.options.mask)){this.options.mask=true}if(A.isEmpty(this.options.maskString)){this.options.maskString="(999) 999-9999"}},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-phone")}},handleValidate:function(){var D=this.base();var C=this.validation;if(!C.invalidPattern["status"]){C.invalidPattern["message"]=this.view.getMessage("invalidPhone")}return D},getSchemaOfSchema:function(){var C=(this.schema&&this.schema.pattern)?this.schema.pattern:A.regexps.phone;return A.merge(this.base(),{properties:{pattern:{title:"Pattern",description:"Field Pattern in Regular Expression",type:"string","default":C,"enum":[C],readonly:true},format:{title:"Format",description:"Property data format",type:"string","default":"phone","enum":["phone"],readonly:true}}})},getOptionsForSchema:function(){return A.merge(this.base(),{fields:{format:{type:"text"}}})},getSchemaOfOptions:function(){return A.merge(this.base(),{properties:{mask:{title:"Field Mask Option",description:"Enable field mask if true",type:"boolean","default":true},maskString:{title:"Field Mask String",description:"Expression for field mask",type:"string","default":"(999) 999-9999"}}})},getTitle:function(){return"Phone Field"},getDescription:function(){return"Phone Field."},getFieldType:function(){return"phone"}});A.registerMessages({invalidPhone:"Invalid Phone Number, e.g. (123) 456-9999"});A.registerFieldClass("phone",A.Fields.PhoneField);A.registerDefaultFormatFieldMapping("phone","phone")})(jQuery);(function(B){var A=B.alpaca;A.Fields.JSONField=A.Fields.TextAreaField.extend({constructor:function(F,J,H,I,E,D,G){this.base(F,J,H,I,E,D,G)},setValue:function(D){if(A.isObject(D)){D=JSON.stringify(D,null," ")}this.base(D)},getValue:function(){var D=this.base();if(D&&A.isString(D)){D=JSON.parse(D)}return D},handleValidate:function(){var F=this.base();var E=this.validation;var D=this._validateJSON();E.stringNotAJSON={message:D.status?"":this.view.getMessage("stringNotAJSON")+" "+D.message,status:D.status};return F&&E.stringNotAJSON["status"]},_validateJSON:function(){var D=this.field.val();if(A.isValEmpty(D)){return{status:true}}try{var F=JSON.parse(D);this.setValue(JSON.stringify(F,null," "));return{status:true}}catch(E){return{status:false,message:E.message}}},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-json")}var D=this;this.field.bind("keypress",function(E){if(E.which==34){D.field.insertAtCaret('"')}if(E.which==123){D.field.insertAtCaret("}")}if(E.which==91){D.field.insertAtCaret("]")}});this.field.bind("keypress","Ctrl+l",function(){D.getEl().removeClass("alpaca-field-focused");D.renderValidationState()});this.field.attr("title","Type Ctrl+L to format and validate the JSON string.")},getTitle:function(){return"JSON Editor"},getDescription:function(){return"Editor for JSON objects with basic validation and formatting."},getFieldType:function(){return"json"}});A.registerMessages({stringNotAJSON:"This value is not a valid JSON string."});A.registerFieldClass("json",A.Fields.JSONField);B.fn.insertAtCaret=function(D){return this.each(function(){if(document.selection){this.focus();sel=document.selection.createRange();sel.text=D;this.focus()}else{if(this.selectionStart||this.selectionStart=="0"){var F=this.selectionStart;var E=this.selectionEnd;var G=this.scrollTop;this.value=this.value.substring(0,F)+D+this.value.substring(E,this.value.length);this.focus();this.selectionStart=F;this.selectionEnd=F;this.scrollTop=G}else{this.value+=D;this.focus()}}})};jQuery.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}};function C(E){if(typeof E.data!=="string"){return }var D=E.handler,F=E.data.toLowerCase().split(" ");E.handler=function(M){if(this!==M.target&&(/textarea|select/i.test(M.target.nodeName)||M.target.type==="text")){return }var I=M.type!=="keypress"&&jQuery.hotkeys.specialKeys[M.which],N=String.fromCharCode(M.which).toLowerCase(),K,L="",H={};if(M.altKey&&I!=="alt"){L+="alt+"}if(M.ctrlKey&&I!=="ctrl"){L+="ctrl+"}if(M.metaKey&&!M.ctrlKey&&I!=="meta"){L+="meta+"}if(M.shiftKey&&I!=="shift"){L+="shift+"}if(I){H[L+I]=true}else{H[L+N]=true;H[L+jQuery.hotkeys.shiftNums[N]]=true;if(L==="shift+"){H[jQuery.hotkeys.shiftNums[N]]=true}}for(var J=0,G=F.length;J<G;J++){if(H[F[J]]){return D.apply(this,arguments)}}}}jQuery.each(["keydown","keyup","keypress"],function(){jQuery.event.special[this]={add:C}})})(jQuery);(function(B){var A=B.alpaca;A.Fields.MapField=A.Fields.ArrayField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){if(A.isEmpty(this.data)){return }if(!A.isArray(this.data)){if(A.isObject(this.data)){var C=[];B.each(this.data,function(D,E){var F=A.cloneObject(E);F._key=D;C.push(F)});this.data=C}}A.mergeObject(this.options,{forceRevalidation:true});this.base()},getValue:function(){var F={};for(var E=0;E<this.children.length;E++){var C=this.children[E].getValue();var D=C._key;if(D){delete C._key;F[D]=C}}return F},handleValidate:function(){var E=this.base();var D=this.validation;var C=this._validateKey();D.keyNotUnique={message:C.status?"":this.view.getMessage("keyNotUnique"),status:C.status};return E&&D.keyNotUnique["status"]},_validateKey:function(){var C=0;B.each(this.getValue(),function(){C++});if(C!=this.children.length){return{status:false}}else{return{status:true}}},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-map")}},getTitle:function(){return"Map Field"},getDescription:function(){return"Field for objects with key/value pairs that share the same schema for values."},getFieldType:function(){return"map"}});A.registerFieldClass("map",A.Fields.MapField);A.registerMessages({keyNotUnique:"Keys of map field are not unique."})})(jQuery);(function(B){var A=B.alpaca;A.Fields.TagField=A.Fields.LowerCaseField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();if(!this.options.separator){this.options.separator=","}},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-tag")}},getValue:function(){var C=this.base();if(C==""){return[]}return C.split(this.options.separator)},setValue:function(C){if(C==""){return }this.base(C.join(this.options.separator))},onBlur:function(E){this.base(E);var C=this.getValue();var D=[];B.each(C,function(G,F){if(F.trim()!=""){D.push(F.trim())}});this.setValue(D)},getSchemaOfOptions:function(){return A.merge(this.base(),{properties:{separator:{title:"Separator",description:"Separator used to split tags.",type:"string","default":","}}})},getOptionsForOptions:function(){return A.merge(this.base(),{fields:{separator:{type:"text"}}})},getTitle:function(){return"Tag Field"},getDescription:function(){return"Text field for entering list of tags separated by delimiter."},getFieldType:function(){return"tag"}});A.registerFieldClass("tag",A.Fields.TagField)})(jQuery);(function(B){var A=B.alpaca;A.Fields.TimeField=A.Fields.TextField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();if(!this.options.timeFormat){this.options.timeFormat="hh:mm:ss"}if(!this.options.timeFormatRegex){this.options.timeFormatRegex=/^(([0-1][0-9])|([2][0-3])):([0-5][0-9]):([0-5][0-9])$/}if(A.isEmpty(this.options.mask)){this.options.mask=true}if(A.isEmpty(this.options.maskString)){this.options.maskString="99:99:99"}},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-time")}},onChange:function(C){this.base();this.renderValidationState()},handleValidate:function(){var E=this.base();var D=this.validation;var C=this._validateTimeFormat();D.invalidTime={message:C?"":A.substituteTokens(this.view.getMessage("invalidTime"),[this.options.timeFormat]),status:C};return E&&D.invalidTime["status"]},_validateTimeFormat:function(){var C=this.field.val();if(!this.schema.required&&(A.isValEmpty(C)||C=="__:__:__")){return true}return C.match(this.options.timeFormatRegex)},setValue:function(C){if(C==""){this.base(C);return }this.base(C)},getSchemaOfSchema:function(){return A.merge(this.base(),{properties:{format:{title:"Format",description:"Property data format",type:"string","default":"time","enum":["time"],readonly:true}}})},getOptionsForSchema:function(){return A.merge(this.base(),{fields:{format:{type:"text"}}})},getSchemaOfOptions:function(){return A.merge(this.base(),{properties:{timeFormat:{title:"Time Format",description:"Time format",type:"string","default":"hh:mm:ss"},timeFormatRegex:{title:"Format Regular Expression",description:"Regular expression for validation time format",type:"string","default":/^(([0-1][0-9])|([2][0-3])):([0-5][0-9]):([0-5][0-9])$/},mask:{"default":true},maskString:{"default":"99:99:99"}}})},getOptionsForOptions:function(){return A.merge(this.base(),{fields:{timeFormat:{type:"text"},timeFormatRegex:{type:"text"}}})},getTitle:function(){return"Time Field"},getDescription:function(){return"Field for time."},getFieldType:function(){return"time"}});A.registerMessages({invalidTime:"Invalid time for format {0}"});A.registerFieldClass("time",A.Fields.TimeField);A.registerDefaultFormatFieldMapping("time","time")})(jQuery);(function(B){var A=B.alpaca;A.Fields.AddressField=A.Fields.ObjectField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();this.schema={title:"Home Address",type:"object",properties:{street:{title:"Street",type:"array",items:{type:"string",maxLength:30,minItems:0,maxItems:3}},city:{title:"City",type:"string"},state:{title:"State",type:"string","enum":["AL","AK","AS","AZ","AR","CA","CO","CT","DE","DC","FM","FL","GA","GU","HI","ID","IL","IN","IA","KS","KY","LA","ME","MH","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","MP","OH","OK","OR","PW","PA","PR","RI","SC","SD","TN","TX","UT","VT","VI","VA","WA","WV","WI","WY"]},zip:{title:"Zip Code",type:"string",pattern:/^(\d{5}(-\d{4})?)?$/}}};A.merge(this.options,{fields:{zip:{mask:true,maskString:"99999",size:5},state:{optionLabels:["ALABAMA","ALASKA","AMERICANSAMOA","ARIZONA","ARKANSAS","CALIFORNIA","COLORADO","CONNECTICUT","DELAWARE","DISTRICTOFCOLUMBIA","FEDERATEDSTATESOFMICRONESIA","FLORIDA","GEORGIA","GUAM","HAWAII","IDAHO","ILLINOIS","INDIANA","IOWA","KANSAS","KENTUCKY","LOUISIANA","MAINE","MARSHALLISLANDS","MARYLAND","MASSACHUSETTS","MICHIGAN","MINNESOTA","MISSISSIPPI","MISSOURI","MONTANA","NEBRASKA","NEVADA","NEWHAMPSHIRE","NEWJERSEY","NEWMEXICO","NEWYORK","NORTHCAROLINA","NORTHDAKOTA","NORTHERNMARIANAISLANDS","OHIO","OKLAHOMA","OREGON","PALAU","PENNSYLVANIA","PUERTORICO","RHODEISLAND","SOUTHCAROLINA","SOUTHDAKOTA","TENNESSEE","TEXAS","UTAH","VERMONT","VIRGINISLANDS","VIRGINIA","WASHINGTON","WESTVIRGINIA","WISCONSIN","WYOMING"]}}});if(A.isEmpty(this.options.addressValidation)){this.options.addressValidation=true}},getAddress:function(){var D=this.getValue();if(this.view.type=="view"){D=this.data}var C="";if(D){if(D.street){B.each(D.street,function(E,F){C+=F+" "})}if(D.city){C+=D.city+" "}if(D.state){C+=D.state+" "}if(D.zip){C+=D.zip}}return C},renderField:function(C){this.base();var D=this;B(this.fieldContainer).addClass("alpaca-addressfield");if(this.options.addressValidation){B('<div style="clear:both;"></div>').appendTo(this.fieldContainer);B('<div class="alpaca-form-button">Google Map</div>').appendTo(this.fieldContainer).button({text:true}).click(function(){if(google&&google.maps){var F=new google.maps.Geocoder();var E=D.getAddress();if(F){F.geocode({address:E},function(J,H){if(H==google.maps.GeocoderStatus.OK){var I=D.getId()+"-map-canvas";if(B("#"+I).length==0){B("<div id='"+I+"' class='alpaca-controlfield-address-mapcanvas'></div>").appendTo(D.fieldContainer)}var K=new google.maps.Map(document.getElementById(D.getId()+"-map-canvas"),{zoom:10,center:J[0].geometry.location,mapTypeId:google.maps.MapTypeId.ROADMAP});var G=new google.maps.Marker({map:K,position:J[0].geometry.location})}else{D.displayMessage("Geocoding failed: "+H)}})}}else{D.displayMessage("Google Map API is not installed.")}}).wrap("<small/>")}if(C){C()}},isContainer:function(){return false},getSchemaOfOptions:function(){return A.merge(this.base(),{properties:{validateAddress:{title:"Address Validation",description:"Enable address validation if true",type:"boolean","default":true}}})},getOptionsForOptions:function(){return A.merge(this.base(),{fields:{validateAddress:{helper:"Address validation if checked",rightLabel:"Enable Google Map for address validation?",type:"checkbox"}}})},getTitle:function(){return"Address"},getDescription:function(){return"Standard US Address with Street, City, State and Zip. Also comes with support for Google map."},getType:function(){return"any"},getFieldType:function(){return"address"}});A.registerFieldClass("address",A.Fields.AddressField)})(jQuery);(function(B){var A=B.alpaca;A.Fields.PrintButtonField=A.Fields.ButtonField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();if(!this.data){this.data=this.view.getMessage("print")}},onClick:function(C){this.form.topControl.print()},postRender:function(){this.base();this.field.addClass("alpaca-form-button-print");if(this.field.button){this.field.button({text:true,icons:{primary:"ui-icon-print"}})}},getTitle:function(){return"Alpaca Screen Print Button"},getDescription:function(){return"Alpaca button for screen printing."}});A.registerMessages({print:"Print Screen"});A.registerFieldClass("printbutton",A.Fields.PrintButtonField)})(jQuery);(function(B){var A=B.alpaca;A.Fields.ReloadButtonField=A.Fields.ButtonField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();if(!this.data){this.data=this.view.getMessage("reload")}},onClick:function(C){this.form.topControl.reload()},postRender:function(){this.base();this.field.addClass("alpaca-form-button-reload");if(this.field.button){this.field.button({text:true,icons:{primary:"ui-icon-refresh"}})}},getTitle:function(){return"Alpaca Reload Button"},getDescription:function(){return"Alpaca button for reloading data."}});A.registerMessages({reload:"Reload"});A.registerFieldClass("reloadbutton",A.Fields.ReloadButtonField)})(jQuery);(function(B){var A=B.alpaca;A.Fields.SwitchViewButtonField=A.Fields.ButtonField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();if(!this.data){this.data=this.view.getMessage("switchView")}},switcherPaneShow:function(){var C=this;this.switcherPane.css({}).slideDown(50)},switcherPaneHide:function(){this.switcherPane.slideUp(50,function(){})},onClick:function(E){var H=this.form.topControl.view.viewObject;if(A.isEmpty(this.viewList)){if(A.isEmpty(A.views[H.id])){if(A.isEmpty(H.id)){H.id=A.generateViewId()}if(A.isEmpty(H.description)){H.title=this.view.getMessage("currentView")}A.registerView(H)}var D=[];for(var C in A.views){D.push({id:C,desc:A.views[C].title})}this.viewList=D}var G='<div class="ui-widget ui-widget-content ui-corner-all alpaca-form-button-view-switcher"><div class="ui-state-highlight"><ul>';B.each(this.viewList,function(I,J){G+='<li><a href="#" id="'+J.id+'"';if(J.id==H.id||J.id==H){G+=' class="current"'}G+=">"+J.desc+"</a></li>"});G+="</url></div></div>";this.switcherPane=B(G);var F=this;this.switcherPane.find("a").click(function(){var I=B(this).attr("id");F.form.topControl.initializing=true;F.form.topControl.render(I);F.switcherPaneHide();return false});this.switcherPane.click(function(){if(F.switcherPane.is(":visible")){F.switcherPaneHide()}});this.fieldContainer.append(this.switcherPane.hide());this.switcherPaneShow()},postRender:function(){this.base();this.field.addClass("alpaca-form-button-switchview");this.button=this.field.button({text:true,icons:{primary:"ui-icon-shuffle"}})},getTitle:function(){return"Alpaca Switch View Button"},getDescription:function(){return"Alpaca button for switching views."}});A.registerMessages({switchView:"Switch View",currentView:"Current Custom View"});A.registerFieldClass("switchviewbutton",A.Fields.SwitchViewButtonField)})(jQuery);(function(B){var A=B.alpaca;A.Fields.SaveButtonField=A.Fields.ButtonField.extend({constructor:function(E,I,G,H,D,C,F){this.base(E,I,G,H,D,C,F)},setup:function(){this.base();this.buttonType="button";if(!this.data){this.data=this.view.getMessage("save")}},onClick:function(F){var G=this;var E=this.form.topControl;var D=E.getValue();if(A.isEmpty(E.data)){E.data={}}A.mergeObject(E.data,D);var C=E.connector;C.saveData({data:E.data,schema:E.schema},function(H){A.merge(E.data,H);if(G.success&&A.isFunction(G.success)){G.success(E.data)}else{alert("Data Saved!")}},function(H){if(G.error&&A.isFunction(G.error)){G.error(H)}else{alert(H)}})},postRender:function(){this.base();this.field.addClass("alpaca-form-button-save");this.field.button({text:true,icons:{primary:"ui-icon-disk"}})},getTitle:function(){return"Save Button"},getDescription:function(){return"Button for storing data."}});A.registerMessages({save:"Save"});A.registerFieldClass("savebutton",A.Fields.SaveButtonField)})(jQuery);(function(B){var A=B.alpaca;A.registerView({id:"VIEW::WEB_EDIT",messages:{zh_CN:{required:"&#27492;&#22495;&#24517;&#39035;",invalid:"&#27492;&#22495;&#19981;&#21512;&#26684;",months:["&#19968;&#26376;","&#20108;&#26376;","&#19977;&#26376;","&#22235;&#26376;","&#20116;&#26376;","&#20845;&#26376;","&#19971;&#26376;","&#20843;&#26376;","&#20061;&#26376;","&#21313;&#26376;","&#21313;&#19968;&#26376;","&#21313;&#20108;&#26376;"],timeUnits:{SECOND:"&#31186;",MINUTE:"&#20998;",HOUR:"&#26102;",DAY:"&#26085;",MONTH:"&#26376;",YEAR:"&#24180;"},notOptional:"&#27492;&#22495;&#38750;&#20219;&#36873;",disallowValue:"&#38750;&#27861;&#36755;&#20837;&#21253;&#25324; {0}.",invalidValueOfEnum:"&#20801;&#35768;&#36755;&#20837;&#21253;&#25324; {0}.",notEnoughItems:"&#26368;&#23567;&#20010;&#25968; {0}",tooManyItems:"&#26368;&#22823;&#20010;&#25968; {0}",valueNotUnique:"&#36755;&#20837;&#20540;&#19981;&#29420;&#29305;",notAnArray:"&#19981;&#26159;&#25968;&#32452;",invalidDate:"&#26085;&#26399;&#26684;&#24335;&#22240;&#35813;&#26159; {0}",invalidEmail:"&#20234;&#22969;&#20799;&#26684;&#24335;&#19981;&#23545;, ex: admin@gitanasoftware.com",stringNotAnInteger:"&#19981;&#26159;&#25972;&#25968;.",invalidIPv4:"&#19981;&#26159;&#21512;&#27861;IP&#22320;&#22336;, ex: 192.168.0.1",stringValueTooSmall:"&#26368;&#23567;&#20540;&#26159; {0}",stringValueTooLarge:"&#26368;&#22823;&#20540;&#26159; {0}",stringValueTooSmallExclusive:"&#20540;&#24517;&#39035;&#22823;&#20110; {0}",stringValueTooLargeExclusive:"&#20540;&#24517;&#39035;&#23567;&#20110; {0}",stringDivisibleBy:"&#20540;&#24517;&#39035;&#33021;&#34987; {0} &#25972;&#38500;",stringNotANumber:"&#19981;&#26159;&#25968;&#23383;.",invalidPassword:"&#38750;&#27861;&#23494;&#30721;",invalidPhone:"&#38750;&#27861;&#30005;&#35805;&#21495;&#30721;, ex: (123) 456-9999",invalidPattern:"&#27492;&#22495;&#39035;&#26377;&#26684;&#24335; {0}",stringTooShort:"&#27492;&#22495;&#33267;&#23569;&#38271;&#24230; {0}",stringTooLong:"&#27492;&#22495;&#26368;&#22810;&#38271;&#24230; {0}"},es_ES:{required:"Este campo es required",invalid:"Este campo es invlido",months:["Enero","Febrero","Marzo","Abril","Puede","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],timeUnits:{SECOND:"segundos",MINUTE:"minutos",HOUR:"horas",DAY:"das",MONTH:"meses",YEAR:"aos"},notOptional:"Este campo no es opcional.",disallowValue:"{0} son los valores rechazados.",invalidValueOfEnum:"Este campo debe tener uno de los valores adentro {0}.",notEnoughItems:"El nmero mnimo de artculos es {0}",tooManyItems:"El nmero mximo de artculos es {0}",valueNotUnique:"Los valores no son nicos",notAnArray:"Este valor no es un arsenal",invalidDate:"Fecha invlida para el formato {0}",invalidEmail:"Email address invlido, ex: admin@gitanasoftware.com",stringNotAnInteger:"Este valor no es un nmero entero.",invalidIPv4:"Direcci&#243;n invlida IPv4, ex: 192.168.0.1",stringValueTooSmall:"El valor mnimo para este campo es {0}",stringValueTooLarge:"El valor mximo para este campo es {0}",stringValueTooSmallExclusive:"El valor de este campo debe ser mayor que {0}",stringValueTooLargeExclusive:"El valor de este campo debe ser menos que {0}",stringDivisibleBy:"El valor debe ser divisible cerca {0}",stringNotANumber:"Este valor no es un nmero.",invalidPassword:"Contrasea invlida",invalidPhone:"Nmero de telfono invlido, ex: (123) 456-9999",invalidPattern:"Este campo debe tener patr&#243;n {0}",stringTooShort:"Este campo debe contener por lo menos {0} nmeros o caracteres",stringTooLong:"Este campo debe contener a lo ms {0} nmeros o caracteres"}}})})(jQuery);(function(B){var A=B.alpaca;A.Connector=Base.extend({constructor:function(D,C){this.id=D;this.configs=C},connect:function(D,C){if(D&&A.isFunction(D)){D()}},loadTemplate:function(E,D,C){if(!A.isEmpty(E)){if(A.isUri(E)){this.loadUri(E,false,function(F){if(D&&A.isFunction(D)){D(F)}},function(F){if(C&&A.isFunction(C)){C(F)}})}else{D(E)}}else{C({message:"Empty data source.",reason:"TEMPLATE_LOADING_ERROR"})}},loadData:function(H,D,E){var G=H.data;var F=H.schema;var C=function(){return !A.isEmpty(G)&&A.isUri(G)&&(!(F&&F.format&&F.format=="uri"))};if(C()){this.loadJson(G,function(I){H.data=I;D(H)},E)}else{D(H)}},loadSchema:function(G,C,D){var F=G.schema;var E=function(){return !A.isEmpty(F)&&A.isUri(F)};if(E()){this.loadJson(F,function(H){G.schema=H;C(G)},D)}else{C(G)}},loadOptions:function(G,C,D){var E=G.options;var F=function(){return !A.isEmpty(E)&&A.isUri(E)};if(F()){this.loadJson(E,function(H){G.options=H;C(G)},D)}else{C(G)}},loadView:function(G,C,E){var D=G.view;var F=function(){return !A.isEmpty(D)&&A.isUri(D)};if(F()){this.loadJson(D,function(H){G.view=H;C(G)},E)}else{C(G)}},loadAll:function(C,J,I){var D=0;var G=C.data;var L=C.options;var F=C.schema;var K=C.view;var E=function(M){D++;if(D==4){if(J&&A.isFunction(J)){J(M.data,M.options,M.schema,M.view)}}};var H=function(M){if(I&&A.isFunction(I)){I(M)}};this.loadData(C,E,H);this.loadSchema(C,E,H);this.loadOptions(C,E,H);this.loadView(C,E,H)},saveData:function(D,E,C){},loadJson:function(D,E,C){this.loadUri(D,true,E,C)},loadUri:function(E,C,G,D){var F={url:E,type:"get",success:function(H){if(G&&A.isFunction(G)){G(H)}},error:function(H,J,I){if(D&&A.isFunction(D)){D({message:"Unable to load data from uri : "+E,stage:"DATA_LOADING_ERROR",details:{jqXHR:H,textStatus:J,errorThrown:I}})}}};if(C){F.dataType="json"}else{F.dataType="text"}B.ajax(F)}});A.registerConnectorClass("default",A.Connector)})(jQuery);(function(B){var A=B.alpaca;A.Connectors.SimpleConnector=A.Connector.extend({constructor:function(D,C){this.base(D,C);this.root=this.configs.root?this.configs.root:"/";if(!A.endsWith(this.root,"/")){this.root=this.root+"/"}this.prefixMappings={data:this.root+"data",schema:this.root+"schema",options:this.root+"forms",view:this.root+"views",template:this.root+"templates"};this.postfixMappings={data:".json",schema:".json",options:".json",view:".json",template:".tmpl"}},connect:function(D,C){this.base(D,C)},loadData:function(I,D,E){var J=this;var H=this.base;var G=I.data;var C=function(){return !A.isEmpty(G)&&A.isString(G)&&!A.isUri(G)};if(C()){var F=this.prefixMappings.data+"/"+G+this.postfixMappings.data;this.loadUri(F,true,function(K){I.data=K;D(I)},function(K){H(I,function(L){D(L)},function(L){E(L)})})}else{this.base(I,function(K){D(K)},function(K){E(K)})}},loadView:function(I,C,E){var J=this;var H=this.base;var D=I.view;var G=function(){return !A.isEmpty(D)&&A.isString(D)&&!A.isUri(D)&&!A.isValidViewId(D)};if(G()){var F=this.prefixMappings.view+"/"+this.originalDataSource.schema+"-"+this.originalDataSource.options+"-"+D+this.postfixMappings.view;this.loadUri(F,true,function(K){I.view=K;J.loadData(I,C,E)},function(K){H(I,function(L){J.loadData(L,C,E)},function(L){J.loadData(I,C,E)})})}else{this.base(I,function(K){J.loadData(K,C,E)},function(K){J.loadData(I,C,E)})}},loadOptions:function(I,C,D){var J=this;var H=this.base;var E=I.options;var G=function(){return !A.isEmpty(E)&&A.isString(E)&&!A.isUri(E)};if(G()){var F=this.prefixMappings.options+"/"+this.originalDataSource.schema+"-"+E+this.postfixMappings.options;this.loadUri(F,true,function(K){I.options=K;J.loadView(I,C,D)},function(K){H(I,function(L){J.loadView(L,C,D)},function(L){J.loadView(I,C,D)})})}else{this.base(I,function(K){J.loadView(K,C,D)},function(K){J.loadView(I,C,D)})}},loadSchema:function(I,C,D){var J=this;var H=this.base;var G=I.schema;var E=function(){return !A.isEmpty(G)&&A.isString(G)&&!A.isUri(G)};if(E()){var F=this.prefixMappings.schema+"/"+G+this.postfixMappings.schema;this.loadUri(F,true,function(K){I.schema=K;J.loadOptions(I,C,D)},function(K){H(I,function(L){J.loadOptions(L,C,D)},function(L){J.loadOptions(I,C,D)})})}else{this.base(I,function(K){J.loadOptions(K,C,D)},function(K){J.loadOptions(I,C,D)})}},loadAll:function(C,J,I){var D=0;var G=C.data;var L=C.options;var F=C.schema;var K=C.view;this.originalDataSource=A.cloneObject(C);var E=function(M){if(J&&A.isFunction(J)){J(M.data,M.options,M.schema,M.view)}};var H=function(M){if(I&&A.isFunction(I)){I(M)}};this.loadSchema(C,E,H)},loadTemplate:function(G,F,D){var H=this;var E=this.base;if(A.isString(G)&&!A.isUri(G)&&!A.isValidViewId(G)&&G.match(/^[a-zA-Z0-9_\s-]+$/)){var C=G=this.prefixMappings.template+"/"+G+this.postfixMappings.template;H.loadUri(C,false,function(I){G=I;E(G,F,D)},function(I){E(G,F,D)})}else{E(G,F,D)}}});A.registerConnectorClass("simple",A.Connectors.SimpleConnector)})(jQuery);(function(B){var A=B.alpaca;A.Connectors.GitanaConnector=A.Connector.extend({constructor:function(D,C){this.base(D,C);this.gitanaNodes={};this.gitanaContext=C.gitanaContext},connect:function(D,C){this.base(D,C)},saveData:function(I,H,F){var J=this;var G=I.data;var C=function(K){if(J.isInvalidTicketError(K)){J.gitanaContext.init().then(function(){J.saveData(I,H,F)})}else{if(F&&A.isFunction(F)){F({message:"Gitana Connector Error : "+K.message,reason:"GITANA_SAVE_ERROR",details:{error:K}})}}};var D=this.getGitanaNode(G);if(!A.isEmpty(D)){A.mergeObject(D.object,G);D.trap(function(K){C(K)}).update().reload().then(function(){J.gitanaNodes[D.getId()]=this;I.data=this.object;if(H){H(this.object)}})}else{var E=I.schema;if(!A.isEmpty(E)&&!A.isEmpty(E._qname)){G._type=E._qname}this.gitanaContext.then(function(){this.branch().trap(function(K){C(K)}).createNode(G).then(function(){J.gitanaNodes[D.getId()]=this;I.data=this.object;if(H){H(this.object)}})})}},loadData:function(I,D,E){var J=this;var H=this.base;var G=I.data;var F=this.branch;var C=function(){return !A.isEmpty(G)&&A.isString(G)&&!A.isUri(G)&&(J.isValidGitanaId(G)||J.isValidQName(G))};if(C()){this.gitanaContext.then(function(){this.branch().trap(function(K){E(K)}).readNode(G).then(function(){J.gitanaNodes[this.getId()]=this;I.data=this.object;I.data.attachments={};this.listAttachments().each(function(){I.data.attachments[this.getId()]=this.getDownloadUri()}).then(function(){D(I)})})})}else{this.base(I,function(K){D(K)},function(K){E(K)})}},loadView:function(I,C,E){var J=this;var H=this.base;var D=I.view;var G=this.branch;var F=function(){return !A.isEmpty(D)&&A.isString(D)&&!A.isUri(D)&&!A.isValidViewId(D)};if(F()){this.loadData(I,C,E)}else{this.base(I,function(K){J.loadData(K,C,E)},function(K){E(K)})}},loadOptions:function(C,E,G){var H=this;var D=this.base;var F=C.schemaNode;var K=C.options;var J=this.branch;var I=function(){return !A.isEmpty(F)&&!A.isEmpty(K)&&A.isString(K)&&!A.isUri(K)};if(I()){if(F){F.trap(function(L){G(L)}).readForm(K).then(function(){C.optionsNode=this;C.options=this.object;H.gitanaNodes[this.getId()]=this;H.loadView(C,E,G)})}else{D(C,function(L){H.loadView(L,E,G)},function(L){G(L)})}}else{this.base(C,function(L){H.loadView(L,E,G)},function(L){G(L)})}},loadSchema:function(I,C,D){var J=this;var H=this.base;var G=I.schema;var F=this.branch;var E=function(){return !A.isEmpty(G)&&A.isString(G)&&!A.isUri(G)&&(J.isValidGitanaId(G)||J.isValidQName(G))};if(E()){this.gitanaContext.then(function(){this.branch().trap(function(K){D(K)}).readDefinition(G).then(function(){I.schemaNode=this;I.schema=this.object;J.gitanaNodes[this.getId()]=this;J.loadOptions(I,C,D)})})}else{this.base(I,function(K){J.loadOptions(K,C,D)},function(K){D(K)})}},loadAll:function(G,F,E){var H=this;var C=function(I){if(F&&A.isFunction(F)){F(I.data,I.options,I.schema,I.view)}};var D=function(I){if(H.isInvalidTicketError(I)){H.gitanaContext.init().then(function(){H.loadAll(G,F,E)})}else{if(E&&A.isFunction(E)){E({message:"Gitana Connector Error : "+I.message,reason:"GITANA_LOAD_ERROR",details:{error:I}})}}};this.loadSchema(G,C,D)},loadTemplate:function(E,D,C){this.base(E,D,C)},isValidQName:function(C){return !A.isEmpty(C)&&A.isString(C)&&C.match(/^[0-9a-zA-Z-_]+:[0-9a-zA-Z-_]+$/)},isValidGitanaId:function(C){return !A.isEmpty(C)&&A.isString(C)&&C.match(/^[0-9a-z]{32}$/)},isInvalidTicketError:function(C){return C.http&&C.http.status&&C.http.status==403&&C.http.reason=="INVALID_TICKET"},getGitanaNode:function(C){if(this.gitanaNodes&&C&&this.gitanaNodes[C._doc]){return this.gitanaNodes[C._doc]}}});A.registerConnectorClass("gitana",A.Connectors.GitanaConnector)})(jQuery);
